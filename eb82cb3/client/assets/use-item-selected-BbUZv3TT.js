import{c as W,b as pt,v as Te,d as is,i as ns,j as _e}from"./create-logger-DNtzi1_a.js";import{n as Oi,i as Fi,m as qe,k as lt,S as Y,c as mt,a as Mi}from"./amp-client-C2ZZL0mA.js";import{r as U}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{u as $t,b as N,c as at,o as F,s as I,i as be,v as et,a as me,x as ct,w as ae,n as $,j as ze,g as Q,D as Cs,f as pe,E as zi,B as ji,h as Os,F as Li,Z as as,N as rs,l as j,y as Je,H as Vt,r as $e,d as qi}from"./http-error-DJhpcL-Y.js";import{n as ne}from"./chunk-VCYTMP4D-Dtug6Gx1.js";import{p as J}from"./slugify-CmQ1Aov3.js";import{e as ue,d as os,a as $i,u as Vi,b as ls}from"./create-analytics-DYSkN0SF.js";import{I as Ui}from"./text-CLqYBJ6O.js";var Fs={done:!1,hasNext:!1},Bi=t=>({hasNext:!0,next:t,done:!1});function cs(t,...e){let s=t,i=e.map(n=>"lazy"in n?Hi(n):void 0),a=0;for(;a<e.length;){if(i[a]===void 0||!Wi(s)){let l=e[a];s=l(s),a+=1;continue}let n=[];for(let l=a;l<e.length;l++){let c=i[l];if(c===void 0||(n.push(c),c.isSingle))break}let o=[];for(let l of s)if(Ms(l,o,n))break;let{isSingle:r}=n.at(-1);s=r?o[0]:o,a+=n.length}return s}function Ms(t,e,s){if(s.length===0)return e.push(t),!1;let i=t,a=Fs,n=!1;for(let[o,r]of s.entries()){let{index:l,items:c}=r;if(c.push(i),a=r(i,l,c),r.index+=1,a.hasNext){if(a.hasMany??!1){for(let u of a.next)if(Ms(u,e,s.slice(o+1)))return!0;return n}i=a.next}if(!a.hasNext)break;a.done&&(n=!0)}return a.hasNext&&e.push(i),n}function Hi(t){let{lazy:e,lazyArgs:s}=t,i=e(...s);return Object.assign(i,{isSingle:e.single??!1,index:0,items:[]})}function Wi(t){return typeof t=="string"||typeof t=="object"&&t!==null&&Symbol.iterator in t}function Gi(t,e){let s=e.length-t.length;if(s===1){let[i,...a]=e;return cs(i,{lazy:t,lazyArgs:a})}if(s===0){let i={lazy:t,lazyArgs:e};return Object.assign(a=>cs(a,i),i)}throw new Error("Wrong number of arguments")}function He(...t){return $t(Di,t)}function Di(t){let e=[...t];for(let s=0;s<t.length;s++){let i=s+Math.floor(Math.random()*(t.length-s)),a=e[i];e[i]=e[s],e[s]=a}return e}function Xi(t){let e=!1,s;return()=>(e||(s=t(),e=!0),s)}function zs(...t){return $t(Qi,t)}var Qi=(t,e)=>({...t,...e});function Yi(t){return!!t}function Ki(t){return typeof t=="object"&&t!==null}function ds(t){return t!==void 0}function Et(t){return Array.isArray(t)}var js=Symbol("funnel/voidReducer"),Ji=()=>js;function Ls(t,{triggerAt:e="end",minQuietPeriodMs:s,maxBurstDurationMs:i,minGapMs:a,reducer:n=Ji}){let o,r,l,c,u=()=>{let m=l;m!==void 0&&(l=void 0,m===js?t():t(m),a!==void 0&&(r=setTimeout(y,a)))},y=()=>{clearTimeout(r),r=void 0,o===void 0&&u()},g=()=>{clearTimeout(o),o=void 0,c=void 0,r===void 0&&u()};return{call:(...m)=>{let d=o===void 0&&r===void 0;if((e!=="start"||d)&&(l=n(l,...m)),!(o===void 0&&!d)){if(s!==void 0||i!==void 0||a===void 0){clearTimeout(o);let p=Date.now();c??=p;let f=i===void 0?s??0:Math.min(s??i,i-(p-c));o=setTimeout(g,f)}e!=="end"&&d&&u()}},cancel:()=>{clearTimeout(o),o=void 0,c=void 0,clearTimeout(r),r=void 0,l=void 0},flush:()=>{g(),y()},get isIdle(){return o===void 0&&r===void 0}}}function de(...t){return $t(Ut,t)}function Ut(t,e=[],s=[]){if(typeof t=="function")return t;if(typeof t!="object"||t===null)return structuredClone(t);let i=Object.getPrototypeOf(t);if(!Array.isArray(t)&&i!==null&&i!==Object.prototype)return structuredClone(t);let a=e.indexOf(t);return a!==-1?s[a]:(e.push(t),Array.isArray(t)?en(t,e,s):Zi(t,e,s))}function Zi(t,e,s){let i={};s.push(i);for(let[a,n]of Object.entries(t))i[a]=Ut(n,e,s);return i}function en(t,e,s){let i=[];s.push(i);for(let[a,n]of t.entries())i[a]=Ut(n,e,s);return i}function us(...t){return Gi(tn,t)}function tn(t){if(t.length===0)return Bi;let e=new Map;for(let s of t)e.set(s,(e.get(s)??0)+1);return s=>{let i=e.get(s);return i===void 0||i===0?{done:!1,hasNext:!0,next:s}:(e.set(s,i-1),Fs)}}const sn=t=>t==="1YYN"?"1-Y-":"1-N-";function nn(t,e=1e4){const s=Date.now();let i;function a(n,o){if(t()){window.cancelAnimationFrame(i),n();return}if(Date.now()-s>=e){window.cancelAnimationFrame(i),o(new Error("Timeout exceeded."));return}i=window.requestAnimationFrame(()=>a(n,o))}return new Promise(a)}function an(t,{timing:e,waitMs:s,maxWaitMs:i}){if(i!==void 0&&s!==void 0&&i<s)throw new Error(`debounce: maxWaitMs (${i.toString()}) cannot be less than waitMs (${s.toString()})`);let a;const n=Ls(o=>{a=t(...o)},{reducer:(o,...r)=>r,minQuietPeriodMs:s??i??0,...i!==void 0&&{maxBurstDurationMs:i},triggerAt:"end"});return{call:(...o)=>(n.call(...o),a),flush:()=>(n.flush(),a),cancel:()=>{n.cancel()},get isPending(){return!n.isIdle},get cachedValue(){return a}}}function qs(t){return W(t)}function Ee(t){const e=new Map(Object.entries(t));return qs({clear(){e.clear()},deserialize(){return Object.fromEntries(e)},get(i){return e.get(i)},has(i){return!!e.get(i)},remove(i){e.delete(i)},serialize(i){e.clear();const a=Object.entries(i);for(const[n,o]of a)e.set(n,o)},seed:t,set(i,a){e.set(i,a)},size(){return e.size}})}class rn extends Error{data;constructor(e,s){super(e),this.data=s,this.message=e,this.name="StorageError"}}function ke({deserializer:t=JSON.parse,logger:e=pt(),serializer:s=JSON.stringify,seed:i,prefix:a="",type:n}){const o=N(globalThis?.document),r=4096,c={cookie:{clear(){for(const g of Object.keys(i))at.remove(a+g)},get(g){const m=at.get(a+g);if(!(m===void 0||m==="undefined"))return t(m)},remove(g){at.remove(a+g)},set(g,m){const d=s(m),{size:p}=new Blob([d]);if(p>r)throw new rn(`The cookie with the key of "${g}" is too large. It has a byte size of "${p}" - the limit is "${r}".`,{key:g,value:m,size:p});(a+g).trim?.()==="iheart-user"&&console.log("setting iheart-user:",d),at.set(a+g,d)}},local:{clear(){for(const g of Object.keys(i))window.localStorage.removeItem(a+g)},get(g){const m=window.localStorage.getItem(a+g);if(!(N(m)||m==="undefined"))return t(m)},remove(g){window.localStorage.removeItem(a+g)},set(g,m){window.localStorage.setItem(a+g,s(m))}},session:{clear(){for(const g of Object.keys(i))window.sessionStorage.removeItem(a+g)},get(g){const m=window.sessionStorage.getItem(a+g);if(!(N(m)||m==="undefined"))return t(m)},remove(g){window.sessionStorage.removeItem(a+g)},set(g,m){window.sessionStorage.setItem(a+g,s(m))}}}[n],u=qs({clear(){c.clear()},deserialize(){return Object.keys(i).reduce((g,m)=>{try{return{...g,[m]:c.get(m)}}catch(d){throw e.error(`Failed to deserialize "${m}".`,d),d}},{})},get(g){try{return c.get(g)}catch(m){throw e.error(`Failed to get "${g}".`,m),m}},has(g){try{return!!c.get(g)}catch(m){throw e.error(`Failed to check the existence of "${g}".`,m),m}},remove(g){try{c.remove(g)}catch(m){throw e.error(`Failed to remove "${g}".`,m),m}},seed:i,serialize(g){for(const[m,d]of Object.entries(g))try{c.set(m,d)}catch(p){throw e.error(`Failed to serialize "${m}".`,p),p}},set(g,m){try{c.set(g,m)}catch(d){throw e.error(`Failed to set "${g}".`,d),d}},size(){return Object.keys(i).length}}),y=Ee(i);if(y.subscribe({clear:u.clear,deserialize:u.deserialize,get:(g,m)=>u.get(m),has:(g,m)=>u.has(m),remove:(g,m)=>u.remove(m),serialize:(g,m)=>u.serialize(m),set:(g,m,d)=>u.set(m,d),size:u.size}),o)y.disable();else{const m=Object.entries(u.deserialize()).reduce((d,[p,f])=>({...d,[p]:f??i[p]}),{});y.serialize(m)}return{...y,prefix:a}}function $s(t,e=0,{leading:s=!0,trailing:i=!0}={}){const{call:a,isIdle:n,...o}=Ls(r=>{!s&&!i||t(...r)},{reducer:(r,...l)=>l,minQuietPeriodMs:e,maxBurstDurationMs:e,...i?s?{triggerAt:"both"}:{triggerAt:"end"}:{triggerAt:"start"}});return Object.assign(a,o)}const{parse:on,stringify:ln}=JSON,cn=String,dn="string",un="object",pn=(t,e)=>e,ps=(t,e,s)=>{const i=cn(e.push(s)-1);return t.set(s,i),i},mn=(t,e,s)=>{const i=pn,a=new Map,n=[],o=[];let r=+ps(a,n,i.call({"":t},"",t)),l=!r;for(;r<n.length;)l=!0,o[r]=ln(n[r++],c,s);return"["+o.join(",")+"]";function c(u,y){if(l)return l=!l,y;const g=i.call(this,u,y);switch(typeof g){case un:if(g===null)return g;case dn:return a.get(g)||ps(a,n,g)}return g}},rt=t=>on(mn(t)),fn={"3g2":"video/3gpp2","3gp":"video/3gpp","3gpp":"video/3gpp","3mf":"model/3mf",aac:"audio/aac",ac:"application/pkix-attr-cert",adp:"audio/adpcm",adts:"audio/aac",ai:"application/postscript",aml:"application/automationml-aml+xml",amlx:"application/automationml-amlx+zip",amr:"audio/amr",apng:"image/apng",appcache:"text/cache-manifest",appinstaller:"application/appinstaller",appx:"application/appx",appxbundle:"application/appxbundle",asc:"application/pgp-keys",atom:"application/atom+xml",atomcat:"application/atomcat+xml",atomdeleted:"application/atomdeleted+xml",atomsvc:"application/atomsvc+xml",au:"audio/basic",avci:"image/avci",avcs:"image/avcs",avif:"image/avif",aw:"application/applixware",bdoc:"application/bdoc",bin:"application/octet-stream",bmp:"image/bmp",bpk:"application/octet-stream",btf:"image/prs.btif",btif:"image/prs.btif",buffer:"application/octet-stream",ccxml:"application/ccxml+xml",cdfx:"application/cdfx+xml",cdmia:"application/cdmi-capability",cdmic:"application/cdmi-container",cdmid:"application/cdmi-domain",cdmio:"application/cdmi-object",cdmiq:"application/cdmi-queue",cer:"application/pkix-cert",cgm:"image/cgm",cjs:"application/node",class:"application/java-vm",coffee:"text/coffeescript",conf:"text/plain",cpl:"application/cpl+xml",cpt:"application/mac-compactpro",crl:"application/pkix-crl",css:"text/css",csv:"text/csv",cu:"application/cu-seeme",cwl:"application/cwl",cww:"application/prs.cww",davmount:"application/davmount+xml",dbk:"application/docbook+xml",deb:"application/octet-stream",def:"text/plain",deploy:"application/octet-stream",dib:"image/bmp","disposition-notification":"message/disposition-notification",dist:"application/octet-stream",distz:"application/octet-stream",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",dot:"application/msword",dpx:"image/dpx",drle:"image/dicom-rle",dsc:"text/prs.lines.tag",dssc:"application/dssc+der",dtd:"application/xml-dtd",dump:"application/octet-stream",dwd:"application/atsc-dwd+xml",ear:"application/java-archive",ecma:"application/ecmascript",elc:"application/octet-stream",emf:"image/emf",eml:"message/rfc822",emma:"application/emma+xml",emotionml:"application/emotionml+xml",eps:"application/postscript",epub:"application/epub+zip",exe:"application/octet-stream",exi:"application/exi",exp:"application/express",exr:"image/aces",ez:"application/andrew-inset",fdf:"application/fdf",fdt:"application/fdt+xml",fits:"image/fits",g3:"image/g3fax",gbr:"application/rpki-ghostbusters",geojson:"application/geo+json",gif:"image/gif",glb:"model/gltf-binary",gltf:"model/gltf+json",gml:"application/gml+xml",gpx:"application/gpx+xml",gram:"application/srgs",grxml:"application/srgs+xml",gxf:"application/gxf",gz:"application/gzip",h261:"video/h261",h263:"video/h263",h264:"video/h264",heic:"image/heic",heics:"image/heic-sequence",heif:"image/heif",heifs:"image/heif-sequence",hej2:"image/hej2k",held:"application/atsc-held+xml",hjson:"application/hjson",hlp:"application/winhlp",hqx:"application/mac-binhex40",hsj2:"image/hsj2",htm:"text/html",html:"text/html",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",img:"application/octet-stream",in:"text/plain",ini:"text/plain",ink:"application/inkml+xml",inkml:"application/inkml+xml",ipfix:"application/ipfix",iso:"application/octet-stream",its:"application/its+xml",jade:"text/jade",jar:"application/java-archive",jhc:"image/jphc",jls:"image/jls",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpf:"image/jpx",jpg:"image/jpeg",jpg2:"image/jp2",jpgm:"image/jpm",jpgv:"video/jpeg",jph:"image/jph",jpm:"image/jpm",jpx:"image/jpx",js:"text/javascript",json:"application/json",json5:"application/json5",jsonld:"application/ld+json",jsonml:"application/jsonml+json",jsx:"text/jsx",jt:"model/jt",jxl:"image/jxl",jxr:"image/jxr",jxra:"image/jxra",jxrs:"image/jxrs",jxs:"image/jxs",jxsc:"image/jxsc",jxsi:"image/jxsi",jxss:"image/jxss",kar:"audio/midi",ktx:"image/ktx",ktx2:"image/ktx2",less:"text/less",lgr:"application/lgr+xml",list:"text/plain",litcoffee:"text/coffeescript",log:"text/plain",lostxml:"application/lost+xml",lrf:"application/octet-stream",m1v:"video/mpeg",m21:"application/mp21",m2a:"audio/mpeg",m2t:"video/mp2t",m2ts:"video/mp2t",m2v:"video/mpeg",m3a:"audio/mpeg",m4a:"audio/mp4",m4p:"application/mp4",m4s:"video/iso.segment",ma:"application/mathematica",mads:"application/mads+xml",maei:"application/mmt-aei+xml",man:"text/troff",manifest:"text/cache-manifest",map:"application/json",mar:"application/octet-stream",markdown:"text/markdown",mathml:"application/mathml+xml",mb:"application/mathematica",mbox:"application/mbox",md:"text/markdown",mdx:"text/mdx",me:"text/troff",mesh:"model/mesh",meta4:"application/metalink4+xml",metalink:"application/metalink+xml",mets:"application/mets+xml",mft:"application/rpki-manifest",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mj2:"video/mj2",mjp2:"video/mj2",mjs:"text/javascript",mml:"text/mathml",mods:"application/mods+xml",mov:"video/quicktime",mp2:"audio/mpeg",mp21:"application/mp21",mp2a:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mp4a:"audio/mp4",mp4s:"application/mp4",mp4v:"video/mp4",mpd:"application/dash+xml",mpe:"video/mpeg",mpeg:"video/mpeg",mpf:"application/media-policy-dataset+xml",mpg:"video/mpeg",mpg4:"video/mp4",mpga:"audio/mpeg",mpp:"application/dash-patch+xml",mrc:"application/marc",mrcx:"application/marcxml+xml",ms:"text/troff",mscml:"application/mediaservercontrol+xml",msh:"model/mesh",msi:"application/octet-stream",msix:"application/msix",msixbundle:"application/msixbundle",msm:"application/octet-stream",msp:"application/octet-stream",mtl:"model/mtl",mts:"video/mp2t",musd:"application/mmt-usd+xml",mxf:"application/mxf",mxmf:"audio/mobile-xmf",mxml:"application/xv+xml",n3:"text/n3",nb:"application/mathematica",nq:"application/n-quads",nt:"application/n-triples",obj:"model/obj",oda:"application/oda",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",omdoc:"application/omdoc+xml",onepkg:"application/onenote",onetmp:"application/onenote",onetoc:"application/onenote",onetoc2:"application/onenote",opf:"application/oebps-package+xml",opus:"audio/ogg",otf:"font/otf",owl:"application/rdf+xml",oxps:"application/oxps",p10:"application/pkcs10",p7c:"application/pkcs7-mime",p7m:"application/pkcs7-mime",p7s:"application/pkcs7-signature",p8:"application/pkcs8",pdf:"application/pdf",pfr:"application/font-tdpfr",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pki:"application/pkixcmp",pkipath:"application/pkix-pkipath",pls:"application/pls+xml",png:"image/png",prc:"model/prc",prf:"application/pics-rules",provx:"application/provenance+xml",ps:"application/postscript",pskcxml:"application/pskc+xml",pti:"image/prs.pti",qt:"video/quicktime",raml:"application/raml+yaml",rapd:"application/route-apd+xml",rdf:"application/rdf+xml",relo:"application/p2p-overlay+xml",rif:"application/reginfo+xml",rl:"application/resource-lists+xml",rld:"application/resource-lists-diff+xml",rmi:"audio/midi",rnc:"application/relax-ng-compact-syntax",rng:"application/xml",roa:"application/rpki-roa",roff:"text/troff",rq:"application/sparql-query",rs:"application/rls-services+xml",rsat:"application/atsc-rsat+xml",rsd:"application/rsd+xml",rsheet:"application/urc-ressheet+xml",rss:"application/rss+xml",rtf:"text/rtf",rtx:"text/richtext",rusd:"application/route-usd+xml",s3m:"audio/s3m",sbml:"application/sbml+xml",scq:"application/scvp-cv-request",scs:"application/scvp-cv-response",sdp:"application/sdp",senmlx:"application/senml+xml",sensmlx:"application/sensml+xml",ser:"application/java-serialized-object",setpay:"application/set-payment-initiation",setreg:"application/set-registration-initiation",sgi:"image/sgi",sgm:"text/sgml",sgml:"text/sgml",shex:"text/shex",shf:"application/shf+xml",shtml:"text/html",sieve:"application/sieve",sig:"application/pgp-signature",sil:"audio/silk",silo:"model/mesh",siv:"application/sieve",slim:"text/slim",slm:"text/slim",sls:"application/route-s-tsid+xml",smi:"application/smil+xml",smil:"application/smil+xml",snd:"audio/basic",so:"application/octet-stream",spdx:"text/spdx",spp:"application/scvp-vp-response",spq:"application/scvp-vp-request",spx:"audio/ogg",sql:"application/sql",sru:"application/sru+xml",srx:"application/sparql-results+xml",ssdl:"application/ssdl+xml",ssml:"application/ssml+xml",stk:"application/hyperstudio",stl:"model/stl",stpx:"model/step+xml",stpxz:"model/step-xml+zip",stpz:"model/step+zip",styl:"text/stylus",stylus:"text/stylus",svg:"image/svg+xml",svgz:"image/svg+xml",swidtag:"application/swid+xml",t:"text/troff",t38:"image/t38",td:"application/urc-targetdesc+xml",tei:"application/tei+xml",teicorpus:"application/tei+xml",text:"text/plain",tfi:"application/thraud+xml",tfx:"image/tiff-fx",tif:"image/tiff",tiff:"image/tiff",toml:"application/toml",tr:"text/troff",trig:"application/trig",ts:"video/mp2t",tsd:"application/timestamped-data",tsv:"text/tab-separated-values",ttc:"font/collection",ttf:"font/ttf",ttl:"text/turtle",ttml:"application/ttml+xml",txt:"text/plain",u3d:"model/u3d",u8dsn:"message/global-delivery-status",u8hdr:"message/global-headers",u8mdn:"message/global-disposition-notification",u8msg:"message/global",ubj:"application/ubjson",uri:"text/uri-list",uris:"text/uri-list",urls:"text/uri-list",vcard:"text/vcard",vrml:"model/vrml",vtt:"text/vtt",vxml:"application/voicexml+xml",war:"application/java-archive",wasm:"application/wasm",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webmanifest:"application/manifest+json",webp:"image/webp",wgsl:"text/wgsl",wgt:"application/widget",wif:"application/watcherinfo+xml",wmf:"image/wmf",woff:"font/woff",woff2:"font/woff2",wrl:"model/vrml",wsdl:"application/wsdl+xml",wspolicy:"application/wspolicy+xml",x3d:"model/x3d+xml",x3db:"model/x3d+fastinfoset",x3dbz:"model/x3d+binary",x3dv:"model/x3d-vrml",x3dvz:"model/x3d+vrml",x3dz:"model/x3d+xml",xaml:"application/xaml+xml",xav:"application/xcap-att+xml",xca:"application/xcap-caps+xml",xcs:"application/calendar+xml",xdf:"application/xcap-diff+xml",xdssc:"application/dssc+xml",xel:"application/xcap-el+xml",xenc:"application/xenc+xml",xer:"application/patch-ops-error+xml",xfdf:"application/xfdf",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xhvml:"application/xv+xml",xlf:"application/xliff+xml",xm:"audio/xm",xml:"text/xml",xns:"application/xcap-ns+xml",xop:"application/xop+xml",xpl:"application/xproc+xml",xsd:"application/xml",xsf:"application/prs.xsf+xml",xsl:"application/xml",xslt:"application/xml",xspf:"application/xspf+xml",xvm:"application/xv+xml",xvml:"application/xv+xml",yaml:"text/yaml",yang:"application/yang",yin:"application/yin+xml",yml:"text/yaml",zip:"application/zip"};function ms(t){let e=(""+t).trim().toLowerCase(),s=e.lastIndexOf(".");return fn[~s?e.substring(++s):e]}var he=(t=>(t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.M="m",t.S="s",t.Space=" ",t.O="o",t))(he||{}),D=(t=>(t.Ad="ad",t.Episode="episode",t.Gracenote="gracenote",t.InStream="in-stream",t.Station="station",t.Track="track",t))(D||{}),ve=(t=>(t.AAC="aac",t.HLS="hls",t.MP3="mp3",t))(ve||{}),C=(t=>(t.Episode="episode",t.Stream="stream",t.Track="track",t.Event="event",t))(C||{}),je=(t=>(t[t.No=0]="No",t[t.Yes=1]="Yes",t[t.One=2]="One",t))(je||{}),_=(t=>(t.Album="album",t.Artist="artist",t.Favorites="favorites",t.Live="live",t.Playlist="playlist",t.PlaylistRadio="playlist-radio",t.Podcast="podcast",t.Scan="scan",t.TopSongs="top-songs",t))(_||{}),Vs=(t=>(t.Artist="artist",t.Favorites="favorites",t.Live="live",t.PlaylistRadio="playlist-radio",t.Podcast="podcast",t.Scan="scan",t))(Vs||{}),ft=(t=>(t[t.Slow=.5]="Slow",t[t.Normal=1]="Normal",t[t.Fast=1.25]="Fast",t[t.Faster=1.5]="Faster",t[t.Fastest=2]="Fastest",t))(ft||{}),O=(t=>(t.Buffering="buffering",t.Idle="idle",t.Paused="paused",t.Playing="playing",t.Restart="restart",t))(O||{}),Bt=(t=>(t.Adswizz="ad-providers/adswizz",t.Triton="ad-providers/triton",t))(Bt||{}),X=(t=>(t.Midroll="midroll",t.Preroll="preroll",t.Instream="instream",t))(X||{}),Le=(t=>(t.Request="request",t.Complete="complete",t.Error="error",t))(Le||{}),Se=(t=>(t.Custom="custom",t.Live="live",t))(Se||{}),R=(t=>(t.Buffering="buffering",t.Idle="idle",t.Paused="paused",t.Playing="playing",t.Streaming="streaming",t.Done="done",t))(R||{});const Ae=F({code:I().optional(),data:be([et(I(),ct()),me(ct())]).optional(),message:I(),name:I()}),Us=ae(Se),Bs=ae(X),hn=ae(Le),gn=ae(R);ae(Bt);const yn=F({ccrcontent2:I().optional(),ccrformat:I().optional(),ccrmarket:I().optional(),ccrpos:I().optional(),cust_params:et(Cs()).optional(),deviceType:be([Q("mobile"),Q("desktop")]).optional(),env:I().optional(),iu:I().optional(),locale:I().optional(),playedfrom:I().optional(),profileId:ze.string().optional(),rdp:I().optional(),url:I().optional(),us_privacy:I().optional(),visitNum:$().optional(),description_url:I().optional()}),vn=F({"aw_0_1st.ihmgenre":I().optional(),"aw_0_1st.playlistid":I().optional(),"aw_0_1st.playlisttype":I().optional(),ccrcontent3:I().optional(),cust_params:et(Cs()).optional(),deviceType:be([Q("mobile"),Q("desktop")]).optional(),env:I().optional(),iu:I().optional(),locale:I().optional(),playedFrom:I().optional(),profileId:ze.string().optional(),rdp:I().optional(),seed:ze.string().optional(),us_privacy:I().optional(),visitNum:$().optional(),description_url:I().optional()}),Hs=F({"aw_0_1st.playerId":I().optional(),"aw_0_1st.skey":I().optional(),"device-language":I().optional(),"device-osv":I().optional(),"iheart-encr":I().optional(),"site-url":I().url().optional(),callLetters:I().optional(),clientType:I().optional(),devicename:I().optional(),dist:I().optional(),dnt:ct().optional(),host:I().optional(),locale:I().optional(),modTime:$().optional(),partnertok:I().optional(),profileid:ze.string().optional(),sessionstart:pe().optional(),streamid:ze.string().optional(),terminalid:$().optional(),territory:I().optional(),ua:I().optional(),us_privacy:I().optional(),zip:ze.string().optional()}).passthrough(),Ws=F({partnerTokens:F({coppa:I(),nonCoppa:I()})}),Gs=F({InStream:Hs,PreRoll:yn,Extra:Ws}),wn=Hs.merge(F({ihmgenre:I().optional(),playlistid:I().optional(),playlisttype:I().optional(),sessionid:I().optional(),streamid:I().optional(),tags:I().optional()})),Ds=F({InStream:wn,PreRoll:vn,Extra:Ws}),Xs=I().url(),Ue={Static:"STATIC",HTML:"HTML",IFrame:"IFRAME"},bn=I().transform(t=>t.toUpperCase()),Qs=zi(()=>F({apiFramework:I().optional(),content:I().optional(),size:F({width:$().nonnegative(),height:$().nonnegative()}).optional(),fluidSize:pe().optional(),resourceType:bn,contentType:I().nullable().optional(),sequenceNumber:$().nonnegative().optional(),mainAdSequenceNumber:$().optional(),adSlotId:$().or(I()).nullable().optional(),backupCompanions:me(Qs),height:$().nonnegative().optional(),width:$().nonnegative().optional(),clickThroughUrl:I().nullable().optional()})),Ys=me(Qs).nullable(),Sn=F({adIndex:$().default(1).optional(),companions:Ys,format:Us,tag:Xs,totalAds:$().default(1).optional(),type:Bs});ae(he);const Ht=ae(ve),xn=ae(C),Ks=F({description:I().optional(),image:I().url().optional(),subtitle:I().optional(),title:I().optional()}),Ce=ji(et(I(),ct()),Ks),Wt=me(F({file:I().url(),type:Ht})),Tt=(t,e)=>{const i=t.replaceAll("\\","").replaceAll('"',"").split(" ");if(i.length<=1)return e.addIssue({code:as.custom,message:".split(' ') only produced one element"}),rs;const a={song_spot:"",TPID:-1};for(const n of i){const[o,r]=n.split("=");if(o==="song_spot")a.song_spot=r;else if(o==="TPID"){const l=Number(r);if(Number.isNaN(l)||l<=0)return e.addIssue({code:as.custom,message:"TPID is NaN or <= 0"}),rs;a.TPID=l}}return a},_n=Os("metadataType",[F({metadataType:Q("id3"),metadata:be([F({title:I()}),F({artist:I().transform(t=>Oi(t.toLowerCase()))}),F({TXXX:F({URL:I().transform(Tt)})}),F({COMM:I().or(F({ENG:I()}))}),F({WXXX:F({URL:I().transform(Tt)}),url:I().transform(Tt)})])}),F({metadataType:Q("discontinuity"),metadata:F({PTS:$(),discontinuitySequence:$(),end:$(),start:$(),tag:I()})})]),Tn=F({file:I().url(),preload:I().optional(),starttime:ze.number().optional(),type:Ht.optional()}),fs=F({sources:Wt}),kn=F({response:F({url:I().url(),code:$(),text:I()})}),Js=F({format:Ht.optional(),id:be([$().nonnegative(),I()]),meta:Ce,reporting:I().optional(),starttime:$().nonnegative().optional(),duration:$().nonnegative().optional(),type:xn,url:I().url(),sources:Wt.optional()}),In=me(Js);ae(D);const Zs=Os("type",[F({type:Q("ad"),data:Ce}),F({type:Q("episode"),data:Ce}),F({type:Q("gracenote"),data:Ce}),F({type:Q("in-stream"),data:Ce}),F({type:Q("station"),data:Ce}),F({type:Q("track"),data:Ce})]).nullable(),An=ae(je),ei=ae(ft),Nt=$().nonnegative().default(0),Pn=ae(O),ti=F({duration:Nt,position:Nt}).strict(),En=ae(_),Nn=ae(Vs),dt=F({context:F({pageName:I(),playedFrom:$().nonnegative(),sectionName:I().optional(),eventLocation:I().optional(),queryId:I().optional()}),id:be([$().nonnegative(),I(),me($().nonnegative())]),seed:be([$().nonnegative(),I()]).optional(),type:En,name:I().nullable().optional(),meta:Ks.optional(),targeting:Gs.or(Ds),providerId:$().nullable().optional(),artistId:$().optional(),isFirstEpisode:pe().optional(),isLastEpisode:pe().optional()}).nullable(),Rn=F({format:Us,station:dt,tag:Xs,timestamp:$().nonnegative(),type:Bs,status:hn});F({current:Sn.optional(),companionClickThroughs:me(I().or(Li())),dfpInstanceId:$().nullable().optional(),enabled:pe(),env:I().nullable().optional(),errors:me(Ae),history:me(Rn),sessionid:I().uuid().nullable(),sessionstart:pe().nullable(),skipNext:pe(),status:gn,subscriptionType:I().optional().default("free"),targeting:Gs.or(Ds),type:be([Q("audio"),Q("video"),Q("unknown"),Q("script")]),anID:$().nullable().optional()});const si=$().gte(0).lte(100),Cn=F({station:dt,item:Js,timestamp:$().nonnegative()}),On=me(Cn),ii=F({id:I().uuid(),message:I(),kind:be([Q("neutral"),Q("info"),Q("success"),Q("warning")]).optional().default("info")});F({messages:me(ii)});function Fn(t){return F(t)}function Mn(t){return Fn({errors:me(Ae),featureFlags:et(I(),be([pe(),$()])).optional(),history:On,index:$().nonnegative(),isScanning:pe(),metadata:Zs,muted:pe(),queue:In,repeat:An,retry:pe(),shuffled:pe(),skips:$().nonnegative(),speed:ei,station:t,status:Pn,time:ti,volume:si,pageName:I().optional().nullable(),lsid:I().optional()})}class De extends globalThis.Error{meta;code;data;message;name;constructor({code:e,data:s,message:i="",meta:a,name:n="ExtendedError"}){super(i),Object.setPrototypeOf(this,De.prototype),Object.defineProperties(this,{message:{enumerable:!0,writable:!0},code:{enumerable:!0,writable:!0},data:{enumerable:!0,writable:!0},meta:{enumerable:!0,writable:!0}}),this.code=e,this.data=s,this.message=i,this.name=n,this.meta=a}}var L=(t=>(t.AdBlocker="AdBlocker",t.AdsMetadata="AdsMetadata",t.AutoplayBlocked="AutoplayBlocked",t.ApiError="ApiError",t.ApiNoMoreSongs="ApiNoMoreSongs",t.CriticalError="CriticalError",t.Generic="Generic",t.InternalPlayerError="InternalPlayerError",t.InternalPlayerErrorDuringScan="InternalPlayerErrorDuringScan",t.InternalPlayerErrorFatal="InternalPlayerErrorFatal",t.InvalidMetadata="InvalidMetadata",t.InvalidPageKey="InvalidPageKey",t.InvalidPlayerState="InvalidPlayerState",t.InvalidSeekType="InvalidSeekType",t.InvalidSeekValue="InvalidSeekValue",t.InvalidSpeed="InvalidSpeed",t.InvalidSpeedType="InvalidSpeedType",t.InvalidStation="InvalidStation",t.InvalidTime="InvalidTime",t.InvalidVolume="InvalidVolume",t.Midroll="Midroll",t.MissingStreams="MissingStreams",t.NetworkError="NetworkError",t.PlayAttemptFailed="PlayAttemptFailed",t.Preroll="Preroll",t.RestrictedDuringAdBreak="RestrictedDuringAdBreak",t.SkipLimit="SkipLimit",t.Targeting="Targeting",t.UnsupportedMethod="UnsupportedMethod",t.NoAvailableSongs="NoAvailableSongs",t))(L||{}),We=(t=>(t.AdBlocker="It looks like you have an ad blocker configured, please disable it before streaming",t.AdsMetadata="Could not set player metadata for playback ad",t.ApiError="There was an error fetching the streams",t.ApiNoMoreSongs="Sorry, this station has run out of songs to play.",t.AutoplayBlocked="Attempted to autoplay, but something went wrong.",t.CriticalError="There was a critical error loading the player, please try refreshing the browser",t.Generic="Uh oh! Something went wrong :(",t.InternalPlayerError="Uh oh! An internal player error occurred.",t.InternalPlayerErrorDuringScan="",t.InternalPlayerErrorFatal="We're having problems playing this station right now",t.InvalidMetadata="Metadata follows the incorrect shape",t.InvalidPageKey="Missing or invalid page key.",t.InvalidPlayerState="The shape of player state is invalid.",t.InvalidSeekType="Seeking during a stream is not possible.",t.InvalidSeekValue="Must take a positive integer value.",t.InvalidSpeed='"speed" must be a number between 0.25 and 4.',t.InvalidSpeedType="Player speed can only be updated for episodes.",t.InvalidStation='"station" is "null". You must load a station into playback first before triggering this method.',t.InvalidTime="Position and duration must be a number greater than 0.",t.InvalidVolume="Volume must be a number between 0 and 100.",t.Midroll="Attempted to play a midroll ad, but something went wrong.",t.MissingStreams="There were no streams returned for this station.",t.NetworkError="Uh oh! A network error occurred :(",t.PlayAttemptFailed="Attempted to play, but something went wrong.",t.Preroll="Attempted to play a preroll ad, but something went wrong.",t.ResolvedStreams="Could not resolve any streams for this station.",t.RestrictedDuringAdBreak="This method is restricted for ad breaks.",t.SkipLimit="The user has reached their skip limit.",t.Targeting="Attempted to set targeting parameters for playback ad, but something went wrong",t.UnsupportedMethod="This method is not supported for this station type.",t.ValidStreams="There were no valid streams available for this station.",t.NoAvailableSongs="No available songs to play",t))(We||{});const x=W({Code:L,new(t){const e=new De({...t,message:t.message??x[t.code]?.message,name:"Playback.Error"});return Object.defineProperty(e,"message",{enumerable:!0}),Ae.parse(e)},AdBlocker:{code:"AdBlocker",message:"It looks like you have an ad blocker configured, please disable it before streaming"},AdsMetadata:{code:"AdsMetadata",message:"Could not set player metadata for playback ad"},ApiError:{code:"ApiError",message:"There was an error fetching the streams"},ApiNoMoreSongs:{code:"ApiNoMoreSongs",message:"Sorry, this station has run out of songs to play."},AutoplayBlocked:{code:"AutoplayBlocked",message:"Attempted to autoplay, but something went wrong."},CriticalError:{code:"CriticalError",message:"There was a critical error loading the player, please try refreshing the browser"},Generic:{code:"Generic",message:"Uh oh! Something went wrong :("},InternalPlayerError:{code:"InternalPlayerError",message:"Uh oh! An internal player error occurred."},InternalPlayerErrorDuringScan:{code:"InternalPlayerErrorDuringScan",message:"Uh oh! An internal player error occurred."},InternalPlayerErrorFatal:{code:"InternalPlayerErrorFatal",message:"We're having problems playing this station right now"},InvalidMetadata:{code:"InvalidMetadata",message:"Metadata follows the incorrect shape",validate(t){try{return Zs.parse(t)}catch{throw x.new({code:"InvalidMetadata",data:t,message:"Metadata follows the incorrect shape"})}}},InvalidPageKey:{code:"InvalidPageKey",message:"Missing or invalid page key."},InvalidPlayerState:{code:"InvalidPlayerState",message:"The shape of player state is invalid.",validate(t){try{return Mn(dt.unwrap()).parse(t)}catch(e){throw x.new({code:"InvalidPlayerState",data:{state:t,error:Fi(e)?e.issues:e},message:"The shape of player state is invalid."})}}},InvalidSeekType:{code:"InvalidSeekType",message:"Seeking during a stream is not possible.",validate(t){if(t===C.Stream)throw x.new({code:"InvalidSeekType",data:{type:t},message:"Seeking during a stream is not possible."})}},InvalidSeekValue:{code:"InvalidSeekValue",message:"Must take a positive integer value.",validate(t){try{return Nt.parse(t)}catch{throw x.new({code:"InvalidSeekValue",data:{seconds:t},message:"Must take a positive integer value."})}}},InvalidSpeed:{code:"InvalidSpeed",message:'"speed" must be a number between 0.25 and 4.',validate(t){try{return ei.parse(t)}catch{throw x.new({code:"InvalidSpeed",data:{speed:t},message:'"speed" must be a number between 0.25 and 4.'})}}},InvalidSpeedType:{code:"InvalidSpeedType",message:"Player speed can only be updated for episodes.",validate(t){if(t!==C.Episode)throw x.new({code:"InvalidSpeedType",data:{type:t},message:"Player speed can only be updated for episodes."})}},InvalidStation:{code:"InvalidStation",message:'"station" is "null". You must load a station into playback first before triggering this method.',validate(t){try{return dt.unwrap().parse(t)}catch{throw x.new({code:"InvalidStation",data:{station:t},message:'"station" is "null". You must load a station into playback first before triggering this method.'})}}},InvalidTime:{code:"InvalidTime",message:"Position and duration must be a number greater than 0.",validate(t){try{return ti.parse(t)}catch{throw x.new({code:"InvalidTime",data:{time:t},message:"Position and duration must be a number greater than 0."})}}},InvalidVolume:{code:"InvalidVolume",message:"Volume must be a number between 0 and 100.",validate(t){try{return si.parse(t)}catch{throw x.new({code:"InvalidVolume",data:{volume:t},message:"Volume must be a number between 0 and 100."})}}},Midroll:{code:"Midroll",message:"Attempted to play a midroll ad, but something went wrong."},MissingStreams:{code:"MissingStreams",message:"There were no streams returned for this station."},NetworkError:{code:"NetworkError",message:"Uh oh! A network error occurred :("},PlayAttemptFailed:{code:"PlayAttemptFailed",message:"Attempted to play, but something went wrong."},Preroll:{code:"Preroll",message:"Attempted to play a preroll ad, but something went wrong."},NoAvailableSongs:{code:"NoAvailableSongs",message:"No available songs to play"},RestrictedDuringAdBreak:{code:"RestrictedDuringAdBreak",message:"This method is restricted for ad breaks.",validate(t,e){if(t)throw x.new({code:"RestrictedDuringAdBreak",message:"This method is restricted for ad breaks.",...e?{meta:e}:{}})}},SkipLimit:{code:"SkipLimit",message:"The user has reached their skip limit.",validate(t){if(t<0)throw x.new({code:"SkipLimit",data:{skips:t},message:"The user has reached their skip limit."})}},Targeting:{code:"Targeting",message:"Attempted to set targeting parameters for playback ad, but something went wrong"},UnsupportedMethod:{code:"UnsupportedMethod",message:"This method is not supported for this station type.",validate(t){if(t===void 0)throw x.new({code:"UnsupportedMethod",message:"This method is not supported for this station type."});return t}}}),kt={retryOptions:{220001:3,221e3:3,224e3:1,224001:3,224002:3,224003:1,23e4:3,230001:3,230002:1,232e3:3,232001:3,232002:1,232006:3,232011:1,232012:1,232400:3,232401:3,232404:3,232500:3,232501:3,232503:3,232600:1,232631:1,232632:1,233e3:1,233001:3,233006:1,233011:1,233012:1,233400:1,233401:1,233403:1,233404:1,233500:1,233501:1,233503:1,233600:1,233650:1,234001:3,234002:3,239e3:1},clearIntervalAfterFatal:qe("30s"),specialHandlers:{}};class zn{#s;#e;#t;#a;#o;#i;#r;constructor(e){const s=e?.retryOptions??kt.retryOptions,i=e?.clearIntervalAfterFatal??kt.clearIntervalAfterFatal??qe("30s"),a=zs(kt.specialHandlers,e?.specialHandlers)??{};this.#e=Object.entries(s).reduce((n,[o,r])=>n.set(Number(o),r),new Map),this.#s=new Map,this.#a=i,this.#i=new Set,this.#r=void 0,this.#t=a,this.#o=e.defaultHandler}shouldRetry(e){return this.#e.has(e)}retry(e,s){let i;this.#s.has(e)?i=(this.#s.get(e)??0)+1:i=1,this.#s.set(e,i);const a=this.#e.get(e);if(j(a)){const n=i>a;return n&&this.fatal(e,s),!n}return!0}clear(e){this.#s.delete(e),this.#i.delete(e)}clearAll(){this.#s.clear(),this.#i.clear()}count(e){return this.#s.get(e)}fatal(e,s){this.#i.add(e),this.#r=Date.now(),(this.#t[e]??this.#o)(this,s),setTimeout(()=>{this.clear(e)},this.#a)}get isFatal(){return this.#i.size>0}get timeRemaining(){return this.isFatal?(this.#r??0)+this.#a-Date.now():0}timeRemainingFormatted(){const s=new Date(Date.UTC(0,0,0,0,0,0,this.timeRemaining)).getUTCSeconds();return s>1?`${s} seconds`:`${s} second`}}const ni="https://securepubads.g.doubleclick.net/gampad/ads",jn="https://crdl.tritondigital.com/api/ads/delivery",ai={ad_type:"audio_video",ciu_szs:"300x250",env:"instream",gdfp_req:"1",impl:"s",output:"vast",plcmt:"1",sz:"640x480",unviewed_position_start:"1",url:"referrer_url"};qe("15m");qe("10m");const Ln=qe("10m"),qn="companion-click-through-url",$n="MARK_AS_PLAYED_ACTION",kl="MARK_AS_UNPLAYED_ACTION",ri=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Vn=ri+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Un="["+ri+"]["+Vn+"]*",Bn=new RegExp("^"+Un+"$");function oi(t,e){const s=[];let i=e.exec(t);for(;i;){const a=[];a.startIndex=e.lastIndex-i[0].length;const n=i.length;for(let o=0;o<n;o++)a.push(i[o]);s.push(a),i=e.exec(t)}return s}const Gt=function(t){const e=Bn.exec(t);return!(e===null||typeof e>"u")};function Hn(t){return typeof t<"u"}const Wn={allowBooleanAttributes:!1,unpairedTags:[]};function Gn(t,e){e=Object.assign({},Wn,e);const s=[];let i=!1,a=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let n=0;n<t.length;n++)if(t[n]==="<"&&t[n+1]==="?"){if(n+=2,n=gs(t,n),n.err)return n}else if(t[n]==="<"){let o=n;if(n++,t[n]==="!"){n=ys(t,n);continue}else{let r=!1;t[n]==="/"&&(r=!0,n++);let l="";for(;n<t.length&&t[n]!==">"&&t[n]!==" "&&t[n]!=="	"&&t[n]!==`
`&&t[n]!=="\r";n++)l+=t[n];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),n--),!ea(l)){let y;return l.trim().length===0?y="Invalid space after '<'.":y="Tag '"+l+"' is an invalid name.",G("InvalidTag",y,te(t,n))}const c=Qn(t,n);if(c===!1)return G("InvalidAttr","Attributes for '"+l+"' have open quote.",te(t,n));let u=c.value;if(n=c.index,u[u.length-1]==="/"){const y=n-u.length;u=u.substring(0,u.length-1);const g=vs(u,e);if(g===!0)i=!0;else return G(g.err.code,g.err.msg,te(t,y+g.err.line))}else if(r)if(c.tagClosed){if(u.trim().length>0)return G("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",te(t,o));if(s.length===0)return G("InvalidTag","Closing tag '"+l+"' has not been opened.",te(t,o));{const y=s.pop();if(l!==y.tagName){let g=te(t,y.tagStartPos);return G("InvalidTag","Expected closing tag '"+y.tagName+"' (opened in line "+g.line+", col "+g.col+") instead of closing tag '"+l+"'.",te(t,o))}s.length==0&&(a=!0)}}else return G("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",te(t,n));else{const y=vs(u,e);if(y!==!0)return G(y.err.code,y.err.msg,te(t,n-u.length+y.err.line));if(a===!0)return G("InvalidXml","Multiple possible root nodes found.",te(t,n));e.unpairedTags.indexOf(l)!==-1||s.push({tagName:l,tagStartPos:o}),i=!0}for(n++;n<t.length;n++)if(t[n]==="<")if(t[n+1]==="!"){n++,n=ys(t,n);continue}else if(t[n+1]==="?"){if(n=gs(t,++n),n.err)return n}else break;else if(t[n]==="&"){const y=Jn(t,n);if(y==-1)return G("InvalidChar","char '&' is not expected.",te(t,n));n=y}else if(a===!0&&!hs(t[n]))return G("InvalidXml","Extra text at the end",te(t,n));t[n]==="<"&&n--}}else{if(hs(t[n]))continue;return G("InvalidChar","char '"+t[n]+"' is not expected.",te(t,n))}if(i){if(s.length==1)return G("InvalidTag","Unclosed tag '"+s[0].tagName+"'.",te(t,s[0].tagStartPos));if(s.length>0)return G("InvalidXml","Invalid '"+JSON.stringify(s.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return G("InvalidXml","Start tag expected.",1);return!0}function hs(t){return t===" "||t==="	"||t===`
`||t==="\r"}function gs(t,e){const s=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const i=t.substr(s,e-s);if(e>5&&i==="xml")return G("InvalidXml","XML declaration allowed only at the start of the document.",te(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function ys(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let s=1;for(e+=8;e<t.length;e++)if(t[e]==="<")s++;else if(t[e]===">"&&(s--,s===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const Dn='"',Xn="'";function Qn(t,e){let s="",i="",a=!1;for(;e<t.length;e++){if(t[e]===Dn||t[e]===Xn)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){a=!0;break}s+=t[e]}return i!==""?!1:{value:s,index:e,tagClosed:a}}const Yn=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function vs(t,e){const s=oi(t,Yn),i={};for(let a=0;a<s.length;a++){if(s[a][1].length===0)return G("InvalidAttr","Attribute '"+s[a][2]+"' has no space in starting.",Ye(s[a]));if(s[a][3]!==void 0&&s[a][4]===void 0)return G("InvalidAttr","Attribute '"+s[a][2]+"' is without value.",Ye(s[a]));if(s[a][3]===void 0&&!e.allowBooleanAttributes)return G("InvalidAttr","boolean attribute '"+s[a][2]+"' is not allowed.",Ye(s[a]));const n=s[a][2];if(!Zn(n))return G("InvalidAttr","Attribute '"+n+"' is an invalid name.",Ye(s[a]));if(!i.hasOwnProperty(n))i[n]=1;else return G("InvalidAttr","Attribute '"+n+"' is repeated.",Ye(s[a]))}return!0}function Kn(t,e){let s=/\d/;for(t[e]==="x"&&(e++,s=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(s))break}return-1}function Jn(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,Kn(t,e);let s=0;for(;e<t.length;e++,s++)if(!(t[e].match(/\w/)&&s<20)){if(t[e]===";")break;return-1}return e}function G(t,e,s){return{err:{code:t,msg:e,line:s.line||s,col:s.col}}}function Zn(t){return Gt(t)}function ea(t){return Gt(t)}function te(t,e){const s=t.substring(0,e).split(/\r?\n/);return{line:s.length,col:s[s.length-1].length+1}}function Ye(t){return t.startIndex+t[1].length}const ta={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,s){return t},captureMetaData:!1},sa=function(t){return Object.assign({},ta,t)};let ut;typeof Symbol!="function"?ut="@@xmlMetadata":ut=Symbol("XML Node Metadata");class Oe{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,s){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:s})}addChild(e,s){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),s!==void 0&&(this.child[this.child.length-1][ut]={startIndex:s})}static getMetaDataSymbol(){return ut}}function ia(t,e){const s={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let i=1,a=!1,n=!1,o="";for(;e<t.length;e++)if(t[e]==="<"&&!n){if(a&&Fe(t,"!ENTITY",e)){e+=7;let r,l;[r,l,e]=na(t,e+1),l.indexOf("&")===-1&&(s[r]={regx:RegExp(`&${r};`,"g"),val:l})}else if(a&&Fe(t,"!ELEMENT",e)){e+=8;const{index:r}=ra(t,e+1);e=r}else if(a&&Fe(t,"!ATTLIST",e))e+=8;else if(a&&Fe(t,"!NOTATION",e)){e+=9;const{index:r}=aa(t,e+1);e=r}else if(Fe(t,"!--",e))n=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(t[e]===">"){if(n?t[e-1]==="-"&&t[e-2]==="-"&&(n=!1,i--):i--,i===0)break}else t[e]==="["?a=!0:o+=t[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:s,i:e}}const Pe=(t,e)=>{for(;e<t.length&&/\s/.test(t[e]);)e++;return e};function na(t,e){e=Pe(t,e);let s="";for(;e<t.length&&!/\s/.test(t[e])&&t[e]!=='"'&&t[e]!=="'";)s+=t[e],e++;if(Dt(s),e=Pe(t,e),t.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(t[e]==="%")throw new Error("Parameter entities are not supported");let i="";return[e,i]=ot(t,e,"entity"),e--,[s,i,e]}function aa(t,e){e=Pe(t,e);let s="";for(;e<t.length&&!/\s/.test(t[e]);)s+=t[e],e++;Dt(s),e=Pe(t,e);const i=t.substring(e,e+6).toUpperCase();if(i!=="SYSTEM"&&i!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${i}"`);e+=i.length,e=Pe(t,e);let a=null,n=null;if(i==="PUBLIC")[e,a]=ot(t,e,"publicIdentifier"),e=Pe(t,e),(t[e]==='"'||t[e]==="'")&&([e,n]=ot(t,e,"systemIdentifier"));else if(i==="SYSTEM"&&([e,n]=ot(t,e,"systemIdentifier"),!n))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:s,publicIdentifier:a,systemIdentifier:n,index:--e}}function ot(t,e,s){let i="";const a=t[e];if(a!=='"'&&a!=="'")throw new Error(`Expected quoted string, found "${a}"`);for(e++;e<t.length&&t[e]!==a;)i+=t[e],e++;if(t[e]!==a)throw new Error(`Unterminated ${s} value`);return e++,[e,i]}function ra(t,e){e=Pe(t,e);let s="";for(;e<t.length&&!/\s/.test(t[e]);)s+=t[e],e++;if(!Dt(s))throw new Error(`Invalid element name: "${s}"`);e=Pe(t,e);let i="";if(t[e]==="E"&&Fe(t,"MPTY",e))e+=4;else if(t[e]==="A"&&Fe(t,"NY",e))e+=2;else if(t[e]==="("){for(e++;e<t.length&&t[e]!==")";)i+=t[e],e++;if(t[e]!==")")throw new Error("Unterminated content model")}else throw new Error(`Invalid Element Expression, found "${t[e]}"`);return{elementName:s,contentModel:i.trim(),index:e}}function Fe(t,e,s){for(let i=0;i<e.length;i++)if(e[i]!==t[s+i+1])return!1;return!0}function Dt(t){if(Gt(t))return t;throw new Error(`Invalid entity name ${t}`)}const oa=/^[-+]?0x[a-fA-F0-9]+$/,la=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,ca={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function da(t,e={}){if(e=Object.assign({},ca,e),!t||typeof t!="string")return t;let s=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(s))return t;if(t==="0")return 0;if(e.hex&&oa.test(s))return fa(s,16);if(s.search(/.+[eE].+/)!==-1)return pa(t,s,e);{const i=la.exec(s);if(i){const a=i[1]||"",n=i[2];let o=ma(i[3]);const r=a?t[n.length+1]===".":t[n.length]===".";if(!e.leadingZeros&&(n.length>1||n.length===1&&!r))return t;{const l=Number(s),c=String(l);if(l===0)return l;if(c.search(/[eE]/)!==-1)return e.eNotation?l:t;if(s.indexOf(".")!==-1)return c==="0"||c===o||c===`${a}${o}`?l:t;let u=n?o:s;return n?u===c||a+u===c?l:t:u===c||u===a+c?l:t}}else return t}}const ua=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function pa(t,e,s){if(!s.eNotation)return t;const i=e.match(ua);if(i){let a=i[1]||"";const n=i[3].indexOf("e")===-1?"E":"e",o=i[2],r=a?t[o.length+1]===n:t[o.length]===n;return o.length>1&&r?t:o.length===1&&(i[3].startsWith(`.${n}`)||i[3][0]===n)?Number(e):s.leadingZeros&&!r?(e=(i[1]||"")+i[3],Number(e)):t}else return t}function ma(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substring(0,t.length-1))),t}function fa(t,e){if(parseInt)return parseInt(t,e);if(Number.parseInt)return Number.parseInt(t,e);if(window&&window.parseInt)return window.parseInt(t,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function ha(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(const s of t)if(typeof s=="string"&&e===s||s instanceof RegExp&&s.test(e))return!0}:()=>!1}class ga{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(s,i)=>String.fromCodePoint(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(s,i)=>String.fromCodePoint(Number.parseInt(i,16))}},this.addExternalEntities=ya,this.parseXml=xa,this.parseTextData=va,this.resolveNameSpace=wa,this.buildAttributesMap=Sa,this.isItStopNode=Ia,this.replaceEntitiesValue=Ta,this.readStopNodeData=Pa,this.saveTextToParentTag=ka,this.addChild=_a,this.ignoreAttributesFn=ha(this.options.ignoreAttributes)}}function ya(t){const e=Object.keys(t);for(let s=0;s<e.length;s++){const i=e[s];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function va(t,e,s,i,a,n,o){if(t!==void 0&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){o||(t=this.replaceEntitiesValue(t));const r=this.options.tagValueProcessor(e,t,s,a,n);return r==null?t:typeof r!=typeof t||r!==t?r:this.options.trimValues?Ct(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?Ct(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function wa(t){if(this.options.removeNSPrefix){const e=t.split(":"),s=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=s+e[1])}return t}const ba=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Sa(t,e,s){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){const i=oi(t,ba),a=i.length,n={};for(let o=0;o<a;o++){const r=this.resolveNameSpace(i[o][1]);if(this.ignoreAttributesFn(r,e))continue;let l=i[o][4],c=this.options.attributeNamePrefix+r;if(r.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const u=this.options.attributeValueProcessor(r,l,e);u==null?n[c]=l:typeof u!=typeof l||u!==l?n[c]=u:n[c]=Ct(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[c]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=n,o}return n}}const xa=function(t){t=t.replace(/\r\n?/g,`
`);const e=new Oe("!xml");let s=e,i="",a="";for(let n=0;n<t.length;n++)if(t[n]==="<")if(t[n+1]==="/"){const r=Me(t,">",n,"Closing Tag is not closed.");let l=t.substring(n+2,r).trim();if(this.options.removeNSPrefix){const y=l.indexOf(":");y!==-1&&(l=l.substr(y+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),s&&(i=this.saveTextToParentTag(i,s,a));const c=a.substring(a.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${l}>`);let u=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(u=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):u=a.lastIndexOf("."),a=a.substring(0,u),s=this.tagsNodeStack.pop(),i="",n=r}else if(t[n+1]==="?"){let r=Rt(t,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,s,a),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const l=new Oe(r.tagName);l.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(l[":@"]=this.buildAttributesMap(r.tagExp,a,r.tagName)),this.addChild(s,l,a,n)}n=r.closeIndex+1}else if(t.substr(n+1,3)==="!--"){const r=Me(t,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const l=t.substring(n+4,r-2);i=this.saveTextToParentTag(i,s,a),s.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}n=r}else if(t.substr(n+1,2)==="!D"){const r=ia(t,n);this.docTypeEntities=r.entities,n=r.i}else if(t.substr(n+1,2)==="!["){const r=Me(t,"]]>",n,"CDATA is not closed.")-2,l=t.substring(n+9,r);i=this.saveTextToParentTag(i,s,a);let c=this.parseTextData(l,s.tagname,a,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?s.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]):s.add(this.options.textNodeName,c),n=r+2}else{let r=Rt(t,n,this.options.removeNSPrefix),l=r.tagName;const c=r.rawTagName;let u=r.tagExp,y=r.attrExpPresent,g=r.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),s&&i&&s.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,s,a,!1));const m=s;m&&this.options.unpairedTags.indexOf(m.tagname)!==-1&&(s=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),l!==e.tagname&&(a+=a?"."+l:l);const d=n;if(this.isItStopNode(this.options.stopNodes,a,l)){let p="";if(u.length>0&&u.lastIndexOf("/")===u.length-1)l[l.length-1]==="/"?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),u=l):u=u.substr(0,u.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)n=r.closeIndex;else{const v=this.readStopNodeData(t,c,g+1);if(!v)throw new Error(`Unexpected end of ${c}`);n=v.i,p=v.tagContent}const f=new Oe(l);l!==u&&y&&(f[":@"]=this.buildAttributesMap(u,a,l)),p&&(p=this.parseTextData(p,l,a,!0,y,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),f.add(this.options.textNodeName,p),this.addChild(s,f,a,d)}else{if(u.length>0&&u.lastIndexOf("/")===u.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),u=l):u=u.substr(0,u.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const p=new Oe(l);l!==u&&y&&(p[":@"]=this.buildAttributesMap(u,a,l)),this.addChild(s,p,a,d),a=a.substr(0,a.lastIndexOf("."))}else{const p=new Oe(l);this.tagsNodeStack.push(s),l!==u&&y&&(p[":@"]=this.buildAttributesMap(u,a,l)),this.addChild(s,p,a,d),s=p}i="",n=g}}else i+=t[n];return e.child};function _a(t,e,s,i){this.options.captureMetaData||(i=void 0);const a=this.options.updateTag(e.tagname,s,e[":@"]);a===!1||(typeof a=="string"&&(e.tagname=a),t.addChild(e,i))}const Ta=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){const s=this.docTypeEntities[e];t=t.replace(s.regx,s.val)}for(let e in this.lastEntities){const s=this.lastEntities[e];t=t.replace(s.regex,s.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const s=this.htmlEntities[e];t=t.replace(s.regex,s.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function ka(t,e,s,i){return t&&(i===void 0&&(i=e.child.length===0),t=this.parseTextData(t,e.tagname,s,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function Ia(t,e,s){const i="*."+s;for(const a in t){const n=t[a];if(i===n||e===n)return!0}return!1}function Aa(t,e,s=">"){let i,a="";for(let n=e;n<t.length;n++){let o=t[n];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===s[0])if(s[1]){if(t[n+1]===s[1])return{data:a,index:n}}else return{data:a,index:n};else o==="	"&&(o=" ");a+=o}}function Me(t,e,s,i){const a=t.indexOf(e,s);if(a===-1)throw new Error(i);return a+e.length-1}function Rt(t,e,s,i=">"){const a=Aa(t,e+1,i);if(!a)return;let n=a.data;const o=a.index,r=n.search(/\s/);let l=n,c=!0;r!==-1&&(l=n.substring(0,r),n=n.substring(r+1).trimStart());const u=l;if(s){const y=l.indexOf(":");y!==-1&&(l=l.substr(y+1),c=l!==a.data.substr(y+1))}return{tagName:l,tagExp:n,closeIndex:o,attrExpPresent:c,rawTagName:u}}function Pa(t,e,s){const i=s;let a=1;for(;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){const n=Me(t,">",s,`${e} is not closed`);if(t.substring(s+2,n).trim()===e&&(a--,a===0))return{tagContent:t.substring(i,s),i:n};s=n}else if(t[s+1]==="?")s=Me(t,"?>",s+1,"StopNode is not closed.");else if(t.substr(s+1,3)==="!--")s=Me(t,"-->",s+3,"StopNode is not closed.");else if(t.substr(s+1,2)==="![")s=Me(t,"]]>",s,"StopNode is not closed.")-2;else{const n=Rt(t,s,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&a++,s=n.closeIndex)}}function Ct(t,e,s){if(e&&typeof t=="string"){const i=t.trim();return i==="true"?!0:i==="false"?!1:da(t,s)}else return Hn(t)?t:""}const It=Oe.getMetaDataSymbol();function Ea(t,e){return li(t,e)}function li(t,e,s){let i;const a={};for(let n=0;n<t.length;n++){const o=t[n],r=Na(o);let l="";if(s===void 0?l=r:l=s+"."+r,r===e.textNodeName)i===void 0?i=o[r]:i+=""+o[r];else{if(r===void 0)continue;if(o[r]){let c=li(o[r],e,l);const u=Ca(c,e);o[It]!==void 0&&(c[It]=o[It]),o[":@"]?Ra(c,o[":@"],l,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),a[r]!==void 0&&a.hasOwnProperty(r)?(Array.isArray(a[r])||(a[r]=[a[r]]),a[r].push(c)):e.isArray(r,l,u)?a[r]=[c]:a[r]=c}}}return typeof i=="string"?i.length>0&&(a[e.textNodeName]=i):i!==void 0&&(a[e.textNodeName]=i),a}function Na(t){const e=Object.keys(t);for(let s=0;s<e.length;s++){const i=e[s];if(i!==":@")return i}}function Ra(t,e,s,i){if(e){const a=Object.keys(e),n=a.length;for(let o=0;o<n;o++){const r=a[o];i.isArray(r,s+"."+r,!0,!0)?t[r]=[e[r]]:t[r]=e[r]}}}function Ca(t,e){const{textNodeName:s}=e,i=Object.keys(t).length;return!!(i===0||i===1&&(t[s]||typeof t[s]=="boolean"||t[s]===0))}class Oa{constructor(e){this.externalEntities={},this.options=sa(e)}parse(e,s){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(s){s===!0&&(s={});const n=Gn(e,s);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const i=new ga(this.options);i.addExternalEntities(this.externalEntities);const a=i.parseXml(e);return this.options.preserveOrder||a===void 0?a:Ea(a,this.options)}addEntity(e,s){if(s.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(s==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=s}static getMetaDataSymbol(){return Oe.getMetaDataSymbol()}}const ee=pt({namespace:"@iheartradio/web.playback",pretty:!0,enabled:!1}),ci=(t=pt({enabled:!0,namespace:"@iheartradio/web.utilities:safe-timeout"}))=>{if(!globalThis.window)return t.warn("Don't use createSafeTimeout on the server! Returning an emitter with no-ops"),W({clear(i){return t.warn("Don't use createSafeTimeout on the server"),!1},clearAll(){t.warn("Don't use createSafeTimeout on the server")},set(i,a,n){return t.warn("Don't use createSafeTimeout on the server"),{timerId:-1,cancel:()=>!1}},setLogger(i){t.warn("Don't use createSafeTimeout on the server")},size(){return-1}});const e=new Map;let s=t;return W({clear(i){const a=Symbol.for(i);return e.has(a)||t.warn(`Attempting to clear timeout: ${i} that has not been previously set`),globalThis.window.clearTimeout(e.get(a)),e.delete(a)},clearAll(){s.warn("Clearing ALL timeouts, be sure you want to do this");for(const[i,a]of e.entries())globalThis.window.clearTimeout(a),e.delete(i)},set(i,a,n){const o=Symbol.for(i);e.has(o)&&(s.warn(`Timeout "${i}" already exists! Clearing and resetting...`),globalThis.window.clearTimeout(e.get(o)),e.delete(o));const r=globalThis.window.setTimeout(()=>{a(),e.delete(o)},n);return e.set(o,r),{timerId:r,cancel:()=>(globalThis.window.clearTimeout(r),e.delete(o))}},setLogger(i){s=i},size(){return e.size}})};class di{constructor(){this._sequence=null}get sequence(){return this._sequence}set sequence(e){this._sequence=e}}class Xt{constructor(){this._contents=[]}get length(){return this._contents.length}add(e){this._contents.push(e),this._contents.sort((s,i)=>(s.sequence||0)-(i.sequence||0))}remove(e){let s=this._contents.indexOf(e);for(;s>=0;)this._contents.splice(s,1),s=this._contents.indexOf(e,s)}get(e){return this._contents[e]}clear(){this._contents.length=0}[Symbol.iterator](){const e=this;let s=0;return{next(){return s<e.length?{value:e.get(s++),done:!1}:{value:void 0,done:!0}}}}toArray(){return this._contents.slice()}get $type(){return"SortedList"}}class ui extends di{constructor(){super(),this._id=null,this._conditionalAd=!1,this._adSystem=null,this._impressions=[],this._pricing=null,this._errors=[],this._viewableImpression=null,this._verifications=[],this._extensions=[],this._creatives=new Xt}get id(){return this._id}set id(e){this._id=e}get conditionalAd(){return this._conditionalAd}set conditionalAd(e){this._conditionalAd=e}get adSystem(){return this._adSystem}set adSystem(e){this._adSystem=e}get impressions(){return this._impressions}get pricing(){return this._pricing}set pricing(e){this._pricing=e}get errors(){return this._errors}get viewableImpression(){return this._viewableImpression}set viewableImpression(e){this._viewableImpression=e}get verifications(){return this._verifications}get extensions(){return this._extensions}get creatives(){return this._creatives}}class Fa extends ui{constructor(){super(),this._adTitle=null,this._categories=[],this._description=null,this._surveys=[]}get adTitle(){return this._adTitle}set adTitle(e){this._adTitle=e}get categories(){return this._categories}get description(){return this._description}set description(e){this._description=e}get advertiser(){return this._advertiser}set advertiser(e){this._advertiser=e}get surveys(){return this._surveys}get $type(){return"InLine"}}class Ma extends ui{constructor(){super(),this._followAdditionalWrappers=!0,this._allowMultipleAds=!1,this._fallbackOnNoAd=!1,this._vastAdTagURI=null}get followAdditionalWrappers(){return this._followAdditionalWrappers}set followAdditionalWrappers(e){this._followAdditionalWrappers=e}get allowMultipleAds(){return this._allowMultipleAds}set allowMultipleAds(e){this._allowMultipleAds=e}get fallbackOnNoAd(){return this._fallbackOnNoAd}set fallbackOnNoAd(e){this._fallbackOnNoAd=e}get vastAdTagURI(){return this._vastAdTagURI}set vastAdTagURI(e){this._vastAdTagURI=e}get $type(){return"Wrapper"}}class pi{constructor(){this._clickThrough=null,this._clickTrackings=[]}get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}}class za extends pi{get $type(){return"IconClicks"}}class ja extends pi{constructor(){super(),this._customClicks=[]}get customClicks(){return this._customClicks}get $type(){return"VideoClicks"}}class La{constructor(){this._version=null,this._name=null}get version(){return this._version}set version(e){this._version=e}get name(){return this._name}set name(e){this._name=e}get $type(){return"AdSystem"}}class qa{constructor(){this._authority=null,this._code=null}get authority(){return this._authority}set authority(e){this._authority=e}get code(){return this._code}set code(e){this._code=e}get $type(){return"Category"}}class $a{constructor(){this._id=null,this._uri=null}get id(){return this._id}set id(e){this._id=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Click"}}class Va extends di{constructor(){super(),this._id=null,this._adID=null,this._apiFramework=null,this._universalAdId=null,this._extensions=[],this._linear=null,this._companionAds=null,this._nonLinearAds=null}get id(){return this._id}set id(e){this._id=e}get adID(){return this._adID}set adID(e){this._adID=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get universalAdId(){return this._universalAdId}set universalAdId(e){this._universalAdId=e}get extensions(){return this._extensions}get linear(){return this._linear}set linear(e){this._linear=e}get companionAds(){return this._companionAds}set companionAds(e){this._companionAds=e}get nonLinearAds(){return this._nonLinearAds}set nonLinearAds(e){this._nonLinearAds=e}get $type(){return"Creative"}}class Ua{constructor(){this._program=null,this._width=null,this._height=null,this._xPosition=null,this._yPosition=null,this._duration=null,this._offset=null,this._apiFramework=null,this._pxratio=null,this._resource=null,this._clicks=null,this._viewTrackings=[]}get program(){return this._program}set program(e){this._program=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get xPosition(){return this._xPosition}set xPosition(e){this._xPosition=e}get yPosition(){return this._yPosition}set yPosition(e){this._yPosition=e}get duration(){return this._duration}set duration(e){this._duration=e}get offset(){return this._offset}set offset(e){this._offset=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get pxratio(){return this._pxratio}set pxratio(e){this._pxratio=e}get resource(){return this._resource}set resource(e){this._resource=e}get clicks(){return this._clicks}set clicks(e){this._clicks=e}get viewTrackings(){return this._viewTrackings}get $type(){return"Icon"}}class Ba{constructor(){this._id=null,this._uri=null}get id(){return this._id}set id(e){this._id=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Impression"}}class Ha{constructor(){this._type=null,this._apiFramework=null,this._url=null}get type(){return this._type}set type(e){this._type=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"InteractiveCreativeFile"}}class Wa{constructor(){this._delivery=null,this._type=null,this._width=null,this._height=null,this._codec=null,this._id=null,this._bitrate=null,this._minBitrate=null,this._maxBitrate=null,this._scalable=!1,this._maintainAspectRatio=!1,this._apiFramework=null,this._uri=null}get delivery(){return this._delivery}set delivery(e){this._delivery=e}get type(){return this._type}set type(e){this._type=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get codec(){return this._codec}set codec(e){this._codec=e}get id(){return this._id}set id(e){this._id=e}get bitrate(){return this._bitrate}set bitrate(e){this._bitrate=e}get minBitrate(){return this._minBitrate}set minBitrate(e){this._minBitrate=e}get maxBitrate(){return this._maxBitrate}set maxBitrate(e){this._maxBitrate=e}get scalable(){return this._scalable}set scalable(e){this._scalable=e}get maintainAspectRatio(){return this._maintainAspectRatio}set maintainAspectRatio(e){this._maintainAspectRatio=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"MediaFile"}}class Ga{constructor(){this._model=null,this._currency=null,this._value=null}get model(){return this._model}set model(e){this._model=e}get currency(){return this._currency}set currency(e){this._currency=e}get value(){return this._value}set value(e){this._value=e}get $type(){return"Pricing"}}class Da{constructor(){this._type=null,this._uri=null}get type(){return this._type}set type(e){this._type=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Survey"}}class Xa{constructor(){this._uri=null,this._offset=null}get uri(){return this._uri}set uri(e){this._uri=e}get offset(){return this._offset}set offset(e){this._offset=e}get $type(){return"TrackingEvent"}}class Qt{constructor(){this._map=Object.create(null)}get types(){return Object.keys(this._map)}get(e){return this._map[e]||[]}add(e,s){this._map[e]=this._map[e]||[],this._map[e].push(s)}get $type(){return"TrackingEvents"}}class Qa{constructor(){this._idRegistry="unknown",this._idValue="unknown",this._creativeIdentifier=null}get idRegistry(){return this._idRegistry}set idRegistry(e){this._idRegistry=e}get idValue(){return this._idValue}set idValue(e){this._idValue=e}get creativeIdentifier(){return this._creativeIdentifier}set creativeIdentifier(e){this._creativeIdentifier=e}get $type(){return"UniversalAdId"}}class Ya{constructor(){this._ads=new Xt,this._adPod=null}get ads(){return this._ads}get adPod(){return this._adPod}set adPod(e){this._adPod=e}get $type(){return"AdBuffet"}}class Ka extends Ya{constructor(){super(),this._uri=null,this._version=null,this._errors=[]}get uri(){return this._uri}set uri(e){this._uri=e}get version(){return this._version}set version(e){this._version=e}get errors(){return this._errors}get $type(){return"VAST"}}class Ja{constructor(){this._vendor=null,this._javaScriptResources=[],this._flashResources=[],this._viewableImpression=null}get vendor(){return this._vendor}set vendor(e){this._vendor=e}get javaScriptResources(){return this._javaScriptResources}get flashResources(){return this._flashResources}get viewableImpression(){return this._viewableImpression}set viewableImpression(e){this._viewableImpression=e}get $type(){return"Verification"}}class Za{constructor(){this._id=null,this._viewables=[],this._notViewables=[],this._viewUndetermineds=[]}get id(){return this._id}set id(e){this._id=e}get viewables(){return this._viewables}get notViewables(){return this._notViewables}get viewUndetermineds(){return this._viewUndetermineds}get $type(){return"ViewableImpression"}}class er{constructor(){this._required=null,this._companions=[],this._xmlElement=null}get required(){return this._required}set required(e){this._required=e}get companions(){return this._companions}get xmlElement(){return this._xmlElement}set xmlElement(e){this._xmlElement=e}get $type(){return"CompanionAds"}}class tr{constructor(){this._id=null,this._width=null,this._height=null,this._assetWidth=null,this._assetHeight=null,this._expandedWidth=null,this._expandedHeight=null,this._apiFramework=null,this._adSlotID=null,this._pxratio=null,this._resource=null,this._adParameters=null,this._altText=null,this._clickThrough=null,this._clickTrackings=[],this._trackingEvents=null}get id(){return this._id}set id(e){this._id=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get assetWidth(){return this._assetWidth}set assetWidth(e){this._assetWidth=e}get assetHeight(){return this._assetHeight}set assetHeight(e){this._assetHeight=e}get expandedWidth(){return this._expandedWidth}set expandedWidth(e){this._expandedWidth=e}get expandedHeight(){return this._expandedHeight}set expandedHeight(e){this._expandedHeight=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get adSlotID(){return this._adSlotID}set adSlotID(e){this._adSlotID=e}get pxratio(){return this._pxratio}set pxratio(e){this._pxratio=e}get resource(){return this._resource}set resource(e){this._resource=e}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get altText(){return this._altText}set altText(e){this._altText=e}get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get $type(){return"Companion"}}class sr{constructor(){this._skipoffset=null,this._duration=null,this._mezzanine=null,this._mediaFiles=[],this._interactiveCreativeFiles=[],this._adParameters=null,this._videoClicks=null,this._trackingEvents=null,this._icons=[]}get skipoffset(){return this._skipoffset}set skipoffset(e){this._skipoffset=e}get duration(){return this._duration}set duration(e){this._duration=e}get mezzanine(){return this._mezzanine}set mezzanine(e){this._mezzanine=e}get mediaFiles(){return this._mediaFiles}get interactiveCreativeFiles(){return this._interactiveCreativeFiles}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get videoClicks(){return this._videoClicks}set videoClicks(e){this._videoClicks=e}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get icons(){return this._icons}get $type(){return"Linear"}}class ir{constructor(){this._nonLinears=[],this._trackingEvents=null}get nonLinears(){return this._nonLinears}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get $type(){return"NonLinearAds"}}class nr{constructor(){this._id=null,this._width=null,this._height=null,this._expandedWidth=null,this._expandedHeight=null,this._scalable=!1,this._maintainAspectRatio=!1,this._minSuggestedDuration=null,this._apiFramework=null,this._resource=null,this._adParameters=null,this._clickThrough=null,this._clickTrackings=[]}get id(){return this._id}set id(e){this._id=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get expandedWidth(){return this._expandedWidth}set expandedWidth(e){this._expandedWidth=e}get expandedHeight(){return this._expandedHeight}set expandedHeight(e){this._expandedHeight=e}get scalable(){return this._scalable}set scalable(e){this._scalable=e}get maintainAspectRatio(){return this._maintainAspectRatio}set maintainAspectRatio(e){this._maintainAspectRatio=e}get minSuggestedDuration(){return this._minSuggestedDuration}set minSuggestedDuration(e){this._minSuggestedDuration=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get resource(){return this._resource}set resource(e){this._resource=e}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}get $type(){return"NonLinear"}}class mi{constructor(){this._type=null,this._xmlElement=null}get type(){return this._type}set type(e){this._type=e}get xmlElement(){return this._xmlElement}set xmlElement(e){this._xmlElement=e}}class ar extends mi{get $type(){return"CreativeExtension"}}class rr extends mi{get $type(){return"Extension"}}class ht{constructor(){this._uri=null}get uri(){return this._uri}set uri(e){this._uri=e}}class fi extends ht{get $type(){return"HTMLResource"}}class hi extends ht{get $type(){return"IFrameResource"}}class Ot extends ht{constructor(){super(),this._creativeType=null}get creativeType(){return this._creativeType}set creativeType(e){this._creativeType=e}get $type(){return"StaticResource"}}class gi extends ht{constructor(){super(),this._apiFramework=null}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}}class or extends gi{get $type(){return"FlashResource"}}class lr extends gi{get $type(){return"JavaScriptResource"}}class yi{constructor(){this._value=null}get value(){return this._value}set value(e){this._value=e}}class cr extends yi{get $type(){return"AbsoluteTimeOffset"}}class dr extends yi{get $type(){return"RelativeTimeOffset"}}class ur{constructor(){this._ads=new Xt}get ads(){return this._ads}get $type(){return"AdPod"}}const Yt=t=>e=>e.nodeType===t,pr=Yt(1),mr=Yt(3),fr=Yt(4),vi=(t,e)=>Array.prototype.filter.call(t.childNodes,e),hr=t=>mr(t)||fr(t),gr=t=>vi(t,hr).map(e=>e.nodeValue).join("").trim(),q={bool:"b",int:"i",float:"f",time:"t"},yr=/^\s*(\d+):(\d+):(\d+(?:\.\d+)?)\s*$/,wi=t=>{if(typeof t!="string")return null;const e=yr.exec(t);return e==null?null:(parseInt(e[1],10)*60+parseInt(e[2],10))*60+parseFloat(e[3])},vr={[q.bool]:t=>t==="true"||t==="1",[q.int]:t=>parseInt(t,10),[q.float]:parseFloat,[q.time]:wi},ws=(()=>{const t=/^[A-Z]+/,e=s=>s.length===1?s.toLowerCase():s.substr(0,s.length-1).toLowerCase()+s.charAt(s.length-1);return s=>s.replace(t,e)})(),bs=(t,e,s)=>t[e]!=null&&~t[e].indexOf(s);class wr{constructor({collections:e,freeforms:s,hybrids:i,types:a}){this._collections=e,this._freeforms=s,this._hybrids=i,this._types=a}unmarshal(e){return this._createNode(e)}_createNode(e){const s=Object.create(null);return s._value=this._isHybrid(e.nodeName)?e:this._convertPropertyValue(gr(e),e.nodeName,"_value"),this._copyAttributes(s,e),this._createCollections(s,e),this._createChildren(s,e),s}_createFreeformNode(e){const s=Object.create(null);return this._copyAttributes(s,e),s._value=e,s}_copyAttributes(e,s){const i=s.nodeName;for(let a=0;a<s.attributes.length;++a){const n=s.attributes[a],o=n.nodeName,r=n.nodeValue;e[o]=this._convertPropertyValue(r,i,o)}}_createCollections(e,s){this._collections[s.nodeName]!=null&&this._collections[s.nodeName].forEach(i=>{e[ws(i)]=[]})}_createChildren(e,s){const i=s.nodeName;vi(s,pr).forEach(a=>{const n=a.nodeName,o=ws(n);this._isFreeformParent(i)?this._isFreeformChild(i,n)&&this._addFreeformChild(a,o,e):this._addNodeChild(a,o,e,i,n)})}_addNodeChild(e,s,i,a,n){const o=this._createNode(e);if(i[s]==null)i[s]=o;else if(this._isCollection(a,n))i[s].push(o);else throw new Error(`Multiple values for ${a}.${n}`)}_addFreeformChild(e,s,i){i[s]=i[s]||[],i[s].push(this._createFreeformNode(e))}_convertPropertyValue(e,s,i){const a=this._types[s]!=null?this._types[s][i]:null;return a!=null?vr[a](e):e}_isCollection(e,s){return bs(this._collections,e,s)}_isFreeformParent(e){return this._freeforms[e]!=null}_isFreeformChild(e,s){return bs(this._freeforms,e,s)}_isHybrid(e){return this._hybrids.indexOf(e)>=0}}const br={AdVerifications:["Verification"],Companion:["CompanionClickTracking"],CompanionAds:["Companion"],CreativeExtensions:["CreativeExtension"],Creatives:["Creative"],Extensions:["Extension"],Icon:["IconViewTracking"],IconClicks:["IconClickTracking"],Icons:["Icon"],InLine:["Category","Error","Impression","Survey"],MediaFiles:["MediaFile","InteractiveCreativeFile"],NonLinear:["NonLinearClickTracking"],NonLinearAds:["NonLinear"],TrackingEvents:["Tracking"],VAST:["Error","Ad"],Verification:["JavaScriptResource","FlashResource"],ViewableImpression:["Viewable","NotViewable","ViewUndetermined"],VideoClicks:["ClickTracking","CustomClick"],Wrapper:["Impression","Error"]},Sr={CreativeExtensions:["CreativeExtension"],Extensions:["Extension"]},xr=["CompanionAds"],_r={Ad:{sequence:q.int},AdParameters:{xmlEncoded:q.bool},Companion:{width:q.int,height:q.int,expandedWidth:q.int,expandedHeight:q.int},Creative:{sequence:q.int},Duration:{_value:q.time},Icon:{width:q.int,height:q.int,offset:q.time,duration:q.time},MediaFile:{bitrate:q.int,minBitrate:q.int,maxBitrate:q.int,width:q.int,height:q.int,scalable:q.bool,maintainAspectRatio:q.bool},NonLinear:{width:q.int,height:q.int,assetWidth:q.int,assetHeight:q.int,expandedWidth:q.int,expandedHeight:q.int,scalable:q.bool,maintainAspectRatio:q.bool,minSuggestedDuration:q.time},Pricing:{_value:q.float},Wrapper:{followAdditionalWrappers:q.bool,allowMultipleAds:q.bool,fallbackOnNoAd:q.bool}},Tr={collections:br,freeforms:Sr,hybrids:xr,types:_r},kr=t=>{const e=new La;return e.version=t.version,e.name=t._value,e},Ir=t=>{const e=new Qa;return t.idRegistry!=null&&(e.idRegistry=t.idRegistry),t.idValue!=null&&(e.idValue=t.idValue),e.creativeIdentifier=t._value,e},Ar=t=>{const e=new ar;return e.type=t.type,e.xmlElement=t._value,e},Pr=t=>{const e=new Wa;return e.id=t.id,e.delivery=t.delivery,e.type=t.type,e.bitrate=t.bitrate,e.minBitrate=t.minBitrate,e.maxBitrate=t.maxBitrate,e.width=t.width,e.height=t.height,e.scalable=t.scalable,e.maintainAspectRatio=t.maintainAspectRatio,e.codec=t.codec,e.apiFramework=t.apiFramework,e.uri=t._value,e},Er=t=>{const e=new Ha;return e.type=t.type,e.apiFramework=t.apiFramework,e.uri=t._value,e},Nr=t=>{const e=new Ot;return e.creativeType=t.creativeType,e.uri=t._value,e},Rr=t=>{const e=new hi;return e.uri=t._value,e},Cr=t=>{const e=new fi;return e.uri=t._value,e},Kt=t=>t.staticResource!=null?Nr(t.staticResource):t.iFrameResource!=null?Rr(t.iFrameResource):t.htmlResource!=null?Cr(t.htmlResource):null,we=t=>{const e=new $a;return e.id=t.id,e.uri=t._value,e},Ze=t=>typeof t=="string"&&t.length>0,ce=t=>t!=null&&Ze(t._value),Or=t=>{const e=new za;return t.iconClickThrough!=null&&ce(t.iconClickThrough)&&(e.clickThrough=we(t.iconClickThrough)),t.iconClickTracking!=null&&e.clickTrackings.push(...t.iconClickTracking.filter(ce).map(we)),e},gt=t=>Array.isArray(t)&&t.length>0,Ss=(t,e)=>t==null?t:e.indexOf(t)<0?parseInt(t,0):t,Fr=t=>{const e=new Ua;return e.program=t.program,e.width=t.width,e.height=t.height,e.xPosition=Ss(t.xPosition,["left","right"]),e.yPosition=Ss(t.yPosition,["top","bottom"]),e.duration=t.duration,e.offset=t.offset,e.apiFramework=t.apiFramework,e.pxratio=t.pxratio,e.resources=Kt(t),t.iconClicks!=null&&(ce(t.iconClicks.iconClickThrough)||gt(t.iconClicks.iconClickTracking))&&(e.clicks=Or(t.iconClicks)),t.iconViewTracking!=null&&e.viewTrackings.push(...t.iconViewTracking.filter(ce).map(we)),e},bi=(t,e,s)=>{if(t.charAt(t.length-1)==="%"){const a=new dr;return a.value=parseFloat(t.substr(0,t.length-1)),a}else{const a=new cr;try{a.value=wi(t)}catch(n){e.errorHandler.tryRecover(n)}return a}},Jt=(t,e,s)=>{if(!(t==null||!Array.isArray(t.tracking)))for(const i of t.tracking){if(!Ze(i._value))continue;const a=new Xa;if(a.uri=i._value,Ze(i.offset))try{a.offset=bi(i.offset)}catch(n){s.errorHandler.tryRecover(n)}e.add(i.event,a)}},Mr=(t,e)=>{t.clickThrough!=null&&ce(t.clickThrough)&&(e.clickThrough=we(t.clickThrough)),t.clickTracking!=null&&e.clickTrackings.push(...t.clickTracking.filter(ce).map(we)),t.customClick!=null&&e.customClicks.push(...t.customClick.filter(ce).map(we))},zr=(t,e)=>{const s=t.linear,i=new sr;return Ze(s.skipoffset)&&(i.skipoffset=bi(s.skipoffset,e)),s.duration!=null&&(i.duration=s.duration._value),s.mediaFiles!=null&&(s.mediaFiles.mezzanine!=null&&(i.mezzanine=s.mediaFiles.mezzanine._value),s.mediaFiles.mediaFile!=null&&i.mediaFiles.push(...s.mediaFiles.mediaFile.map(Pr)),s.mediaFiles.interactiveCreativeFile!=null&&i.interactiveCreativeFiles.push(...s.mediaFiles.interactiveCreativeFile.map(Er))),s.adParameters!=null&&(i.adParameters=s.adParameters._value),s.videoClicks!=null&&(i.videoClicks=new ja,Mr(s.videoClicks,i.videoClicks)),s.trackingEvents!=null&&gt(s.trackingEvents.tracking)&&(i.trackingEvents=new Qt,Jt(s.trackingEvents,i.trackingEvents,e)),s.icons!=null&&s.icons.icon&&i.icons.push(...s.icons.icon.map(Fr)),i},jr=t=>{const e=new nr;return e.id=t.id,e.width=t.width,e.height=t.height,e.expandedWidth=t.expandedWidth,e.expandedHeight=t.expandedHeight,e.scalable=t.scalable,e.maintainAspectRatio=t.maintainAspectRatio,e.minSuggestedDuration=t.minSuggestedDuration,e.apiFramework=t.apiFramework,e.resource=Kt(t),t.adParameters!=null&&(e.adParameters=t.adParameters._value),t.nonLinearClickThrough!=null&&ce(t.nonLinearClickThrough)&&(e.clickThrough=we(t.nonLinearClickThrough)),t.nonLinearClickTracking!=null&&e.clickTrackings.push(...t.nonLinearClickTracking.filter(ce).map(we)),e},Lr=t=>{const e=t.nonLinearAds,s=new ir;return e.nonLinear!=null&&s.nonLinears.push(...e.nonLinear.map(jr)),e.trackingEvents!=null&&gt(e.trackingEvents.tracking)&&(s.trackingEvents=new Qt,Jt(e.trackingEvents,s.trackingEvents)),s},qr=t=>{const e=new tr;return e.id=t.id,e.width=t.width,e.height=t.height,e.assetWidth=t.assetWidth,e.assetHeight=t.assetHeight,e.expandedWidth=t.expandedWidth,e.expandedHeight=t.expandedHeight,e.apiFramework=t.apiFramework,e.adSlotID=t.adSlotID,e.pxratio=t.pxratio,e.resource=Kt(t),t.adParameters!=null&&ce(t.adParameters)&&(e.adParameters=t.adParameters._value),t.altText!=null&&ce(t.altText._value)&&(e.altText=t.altText._value),t.companionClickThrough!=null&&ce(t.companionClickThrough)&&(e.clickThrough=we(t.companionClickThrough)),t.companionClickTracking!=null&&e.clickTrackings.push(...t.companionClickTracking.filter(ce).map(we)),t.trackingEvents!=null&&gt(t.trackingEvents.tracking)&&(e.trackingEvents=new Qt,Jt(t.trackingEvents,e.trackingEvents)),e},$r=t=>{const e=t.companionAds,s=new er;return s.required=e.required,e.companion!=null&&s.companions.push(...e.companion.map(qr)),s.xmlElement=e._value,s},Vr=(t,e)=>{const s=new Va;return s.id=t.id,s.sequence=t.sequence,s.adID=t.AdID||t.adID||t.adId,s.apiFramework=t.apiFramework,t.universalAdId!=null&&(s.universalAdId=Ir(t.universalAdId)),t.creativeExtensions!=null&&t.creativeExtensions.creativeExtension&&s.extensions.push(...t.creativeExtensions.creativeExtension.map(Ar)),t.linear!=null?s.linear=zr(t,e):t.nonLinearAds!=null&&(s.nonLinearAds=Lr(t)),t.companionAds!=null&&(s.companionAds=$r(t)),s.linear==null&&s.nonLinearAds==null&&s.companionAds==null&&e.errorHandler.tryRecover("Creative has no ads"),s},Ur=t=>{const e=new rr;return e.type=t.type,e.xmlElement=t._value,e},Br=t=>{const e=new Ba;return e.id=t.id,e.uri=t._value,e},Hr=t=>{const e=new Ga;return e.model=t.model,e.currency=t.currency,e.value=t._value,e},Wr=t=>{const e=new Za;return e.id=t.id,t.viewable!=null&&e.viewables.push(...t.viewable.map(s=>s._value)),t.notViewable!=null&&e.notViewables.push(...t.notViewable.map(s=>s._value)),t.viewUndetermined!=null&&e.viewUndetermineds.push(...t.viewUndetermined.map(s=>s._value)),e},Gr=t=>{const e=new lr;return e.apiFramework=t.apiFramework,e.uri=t._value,e},Dr=t=>{const e=new or;return e.apiFramework=t.apiFramework,e.uri=t._value,e},Xr=t=>{const e=new Ja;return e.vendor=t.vendor,t.javaScriptResource!=null&&e.javaScriptResources.push(...t.javaScriptResource.map(Gr)),t.flashResource!=null&&e.flashResources.push(...t.flashResource.map(Dr)),t.viewableImpression!=null&&(e.viewableImpression=t.viewableImpression._value),t.verificationParameters!=null&&(e.parameters=t.verificationParameters._value),e},xs=t=>t!=null&&Ze(t._value),Si=(t,e,s,i)=>(s.id=t.id,s.conditionalAd=t.conditionalAd,s.sequence=t.sequence,e.adSystem!=null&&(s.adSystem=kr(e.adSystem)),e.impression!=null&&s.impressions.push(...e.impression.filter(xs).map(Br)),e.pricing!=null&&(s.pricing=Hr(e.pricing)),e.error!=null&&s.errors.push(...e.error.filter(xs).map(a=>a._value)),e.viewableImpression!=null&&(s.viewableImpression=Wr(e.viewableImpression)),e.adVerifications!=null&&e.adVerifications.verification.forEach(a=>{try{const n=Xr(a,i);s.verifications.push(n)}catch(n){i.errorHandler.tryRecover(n)}}),e.extensions!=null&&s.extensions.push(...e.extensions.extension.map(Ur)),e.creatives!=null&&e.creatives.creative.forEach(a=>{try{const n=Vr(a,i);s.creatives.add(n)}catch(n){i.errorHandler.tryRecover(n)}}),s),Qr=t=>{const e=new qa;return e.authority=t.authority,e.code=t._value,e},Yr=t=>{const e=new Da;return e.type=t.type,e.uri=t._value,e},Kr=(t,e)=>{const s=new Fa,i=t.inLine;return Si(t,i,s,e),s.adTitle=i.adTitle!=null?i.adTitle._value:null,i.category!=null&&s.categories.push(...i.category.filter(a=>a.authority!=null).map(Qr)),s.description=i.description!=null?i.description._value:null,s.advertiser=i.advertiser!=null?i.advertiser._value:null,i.survey!=null&&s.surveys.push(...i.survey.filter(a=>a._value.length>0).map(Yr)),s},Jr=(t,e)=>{const s=new Ma,i=t.wrapper;return Si(t,i,s,e),i.followAdditionalWrappers!=null&&(s.followAdditionalWrappers=i.followAdditionalWrappers),i.allowMultipleAds!=null&&(s.allowMultipleAds=i.allowMultipleAds),s.fallbackOnNoAd=i.fallbackOnNoAd,s.vastAdTagURI=i.vastAdTagURI!=null?i.vastAdTagURI._value:null,s},_s=(t,e)=>{if(t.inLine!=null)return Kr(t,e);if(t.wrapper!=null)return Jr(t,e);throw new Error("Unrecognized ad type")},Zr=t=>{const e=[],s=[];for(let i=0;i<t.length;++i){const a=t[i];typeof a.sequence<"u"?e.push(a):s.push(a)}return[e,s]},eo=(t,e)=>{const s=new Ka;s.version=t.version,s.errors.push(...t.error.map(n=>n._value).filter(n=>n!==""));const[i,a]=Zr(t.ad);if(i.length>0)if(e.noSingleAdPods&&t.ad.length===1&&i.length===1)a.push(i[0]);else{s.adPod=new ur;for(let n=0;n<i.length;n++)s.adPod.ads.add(_s(i[n],e))}for(let n=0;n<a.length;n++)s.ads.add(_s(a[n],e));return s},xi={XML_PARSING_ERROR:100,VAST_SCHEMA_VALIDATION_ERROR:101};function to(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ts(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function so(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function io(t){function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}var no=function(t){so(e,t);function e(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";to(this,e);var i=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s));return Object.defineProperty(i,"message",{configurable:!0,enumerable:!1,value:s,writable:!0}),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:i.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(i,i.constructor),Ts(i)):(Object.defineProperty(i,"stack",{configurable:!0,enumerable:!1,value:new Error(s).stack,writable:!0}),i)}return e}(io(Error));class ks extends no{constructor(e,s){super(e),this.code=s,this.name="VASTParserError"}}class ao{constructor(e){this._strictMode=e}failWithErrorCode(e,s){throw e instanceof ks?e:new ks(e instanceof Error?e.message:e,s)}fail(e){this.failWithErrorCode(e,xi.VAST_SCHEMA_VALIDATION_ERROR)}tryRecover(e){this._strictMode&&this.fail(e)}}const ro={strict:!1,noSingleAdPods:!1},oo=(t,e)=>(typeof t=="string"&&(t=(e.domParser||new DOMParser).parseFromString(t,"text/xml")),t.documentElement!=null&&(t=t.documentElement),t.getElementsByTagName("parsererror").length>0&&e.errorHandler.failWithErrorCode("XML parsing error",xi.XML_PARSING_ERROR),t),lo=(t,e={})=>{e=Object.assign({},ro,e),e.errorHandler=new ao(e.strict);const s=oo(t,e),i=new wr(Tr);try{const a=i.unmarshal(s);return eo(a,e)}catch(a){e.errorHandler.fail(a)}};class co extends Map{#s=0;#e=new Map;#t=new Map;#a;#o;#i;constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.#a=e.maxSize,this.#o=e.maxAge||Number.POSITIVE_INFINITY,this.#i=e.onEviction}get __oldCache(){return this.#t}#r(e){if(typeof this.#i=="function")for(const[s,i]of e)this.#i(s,i.value)}#n(e,s){return typeof s.expiry=="number"&&s.expiry<=Date.now()?(typeof this.#i=="function"&&this.#i(e,s.value),this.delete(e)):!1}#p(e,s){if(this.#n(e,s)===!1)return s.value}#l(e,s){return s.expiry?this.#p(e,s):s.value}#c(e,s){const i=s.get(e);return this.#l(e,i)}#d(e,s){this.#e.set(e,s),this.#s++,this.#s>=this.#a&&(this.#s=0,this.#r(this.#t),this.#t=this.#e,this.#e=new Map)}#m(e,s){this.#t.delete(e),this.#d(e,s)}*#u(){for(const e of this.#t){const[s,i]=e;this.#e.has(s)||this.#n(s,i)===!1&&(yield e)}for(const e of this.#e){const[s,i]=e;this.#n(s,i)===!1&&(yield e)}}get(e){if(this.#e.has(e)){const s=this.#e.get(e);return this.#l(e,s)}if(this.#t.has(e)){const s=this.#t.get(e);if(this.#n(e,s)===!1)return this.#m(e,s),s.value}}set(e,s,{maxAge:i=this.#o}={}){const a=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.#e.has(e)?this.#e.set(e,{value:s,expiry:a}):this.#d(e,{value:s,expiry:a}),this}has(e){return this.#e.has(e)?!this.#n(e,this.#e.get(e)):this.#t.has(e)?!this.#n(e,this.#t.get(e)):!1}peek(e){if(this.#e.has(e))return this.#c(e,this.#e);if(this.#t.has(e))return this.#c(e,this.#t)}delete(e){const s=this.#e.delete(e);return s&&this.#s--,this.#t.delete(e)||s}clear(){this.#e.clear(),this.#t.clear(),this.#s=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const s=[...this.#u()],i=s.length-e;i<0?(this.#e=new Map(s),this.#t=new Map,this.#s=s.length):(i>0&&this.#r(s.slice(0,i)),this.#t=new Map(s.slice(i)),this.#e=new Map,this.#s=0),this.#a=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.#e){const[s,i]=e;this.#n(s,i)===!1&&(yield[s,i.value])}for(const e of this.#t){const[s,i]=e;this.#e.has(s)||this.#n(s,i)===!1&&(yield[s,i.value])}}*entriesDescending(){let e=[...this.#e];for(let s=e.length-1;s>=0;--s){const i=e[s],[a,n]=i;this.#n(a,n)===!1&&(yield[a,n.value])}e=[...this.#t];for(let s=e.length-1;s>=0;--s){const i=e[s],[a,n]=i;this.#e.has(a)||this.#n(a,n)===!1&&(yield[a,n.value])}}*entriesAscending(){for(const[e,s]of this.#u())yield[e,s.value]}get size(){if(!this.#s)return this.#t.size;let e=0;for(const s of this.#t.keys())this.#e.has(s)||e++;return Math.min(this.#s+e,this.#a)}get maxSize(){return this.#a}entries(){return this.entriesAscending()}forEach(e,s=this){for(const[i,a]of this.entriesAscending())e.call(s,a,i,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}var le=(t=>(t.Start="before-getCompanionVAST",t.End="after-getCompanionVAST",t.Name="roundTrip-getCompanionVAST",t))(le||{});const Ge=ci(),At=new co({maxSize:1e3}),uo=async(t,e)=>{if(At.has(t))return At.get(t);{const s=await e.api.v3.catalog.getTracks({params:{ids:[t]}}).then(J("body")).then(J("tracks")).then(i=>i.find(a=>a.id===t));if(s){const i={artistId:s.artistId,artistName:s.artistName,trackId:s.id,trackName:s.title};return At.set(t,i),i}}};function po(t,e){return Ge.setLogger(e),t.split(/\s/).reduce((s,i)=>{const[a,n]=i.split(/=(.*)/).map(o=>o.replaceAll("\\","").replaceAll('"',""));if(!n)return s;if(a.includes("adContext"))try{return{...s,adContext:window.atob(n)}}catch(o){const r=o instanceof Error?o:new Error(String.prototype.toString.apply(o));return e.warn(`Failed to decode adContext, ${r.message}`),{...s,adContext:null}}else if(a==="adMarkers"){const o=n.split("|").reduce((r,l)=>{const c=l.split(",").reduce((u,y)=>{const[g,m]=y.split(/=/).map(d=>d.replaceAll("'",""));if(!m)return u;try{return{...u,[g]:JSON.parse(m)}}catch{return e.warn("Failed to JSON.parse adMarker value in processStreamMetadata",m),{...u,[g]:m}}},{});return[...r,c]},[]);return{...s,[a]:o}}else if(a==="spotBlockMarker"){const o=n.split(",").reduce((r,l)=>{const[c,u]=l.split(/=/).map(y=>y.replaceAll("'",""));if(!u)return r;try{return{...r,[c]:JSON.parse(u)}}catch{return e.warn("Failed to JSON.parse spotBlockMarker value in processStreamMetadata",u),{...r,[c]:u}}},{});return{...s,[a]:o}}else return s},{})}function mo({liveInStreamAdPayload:t,player:e,logger:s,delay:i=0,identifier:a,offsetTimeEvents:n=0}){Ge.setLogger(s);const{duration:o,creatives:r,tag:l}=de(t);if(!o){s.warn("No duration available for live in-stream ad");return}(({duration:c,creatives:u,tag:y},g,m,d=0)=>{Ge.set(`render-livestream-ad-${m}`,()=>{const p=e.getAds(),f=u.HTML??u.STATIC??u.IFRAME??void 0;if(f){const v=function(){return f.creative.events?.creativeView?.reduce((S,A,T)=>[...S,Xi(()=>{const{uri:P}=A;s.info(`Firing creativeView pixel for ${m} - ${T}`,{uri:P});const E=document.createElement("img");E.src=P,E.height=1,E.width=1,E.addEventListener("load",()=>E.remove()),document.body.append(E)})],[])??[]}(),h=()=>{if(document.visibilityState==="visible"){s.info(`Firing 'visibilitychange' handler for ${m}`);for(const k of v)k()}},w=new AbortController;if(f.creative&&!ne(y)){s.info(`Rendering livestream ad break: ${m}`);const k={type:X.Instream,format:Se.Live,companions:[Je(f.creative,["events"])],tag:y};if(p.serialize({...p.deserialize(),type:"audio",status:R.Streaming,current:k}),document.visibilityState==="visible")for(const S of v)S();document.addEventListener("visibilitychange",h,{signal:w.signal})}else s.warn(`No companion to render for live in-stream ad - ${m}`,{companion:t});const b=e.subscribe({stop(){s.info(`Playback stopped during live ad break ${m}, cleaning up...`),w.abort(),p.serialize({...p.deserialize(),status:R.Idle,current:void 0}),b()},setMute(k){if(!N(k)){if(k===!0&&f.companion.events?.mute)for(const S of f.companion.events.mute){const{uri:A}=S,T=document.createElement("img");T.src=A,T.width=1,T.height=1,T.addEventListener("load",()=>T.remove()),document.body.append(T),s.info(`Rendering livestream ad - ${m} - event: mute`,{uri:A})}else if(k===!1&&f.companion.events?.unmute)for(const S of f.companion.events.unmute){const{uri:A}=S,T=document.createElement("img");T.src=A,T.width=1,T.height=1,T.addEventListener("load",()=>T.remove()),document.body.append(T),s.info(`Rendering livestream ad - ${m} - event: unmute`,{uri:A})}}}});Ge.set(`livestream-companion-cleanup-${m}`,()=>{s.info(`Livestream ad break: ${m}, elapsed, cleaning up...`),b(),e.adComplete(X.Instream),document.removeEventListener("visibilitychange",h)},c-d)}},g)})({duration:o,creatives:r,tag:l},i,String(a),n)}async function _i(t,e){try{return await fetch(t,{redirect:"follow",signal:AbortSignal.timeout(3e3)})}catch(s){return s instanceof DOMException?s.name==="TimeoutError"?e.warn("Fetching VAST Document timed out"):s.name==="AbortError"?e.warn("Fetching VAST document was user-aborted"):e.warn(`${s.name}: ${s.cause??"unknown"}`):s instanceof Error?e.warn(s.message):e.warn(JSON.stringify(s)),performance.clearMarks(le.Start),null}}async function fo(t,e){Ge.setLogger(e);let s;performance.clearMarks(le.Start),performance.clearMarks(le.End),performance.mark(le.Start);try{s=new URL(t)}catch(a){const n=a instanceof Error?a:new Error(String.prototype.toString.apply(a));e.error(`Unable to create VAST URL from adContext parameter: ${t}, ${n.message}`),performance.clearMarks(le.Start);return}const i=await _i(s,e);if(i?.status===200)try{const a=await i.text(),n=lo(a),o=[],r=["mute","unmute"],l=["creativeView"];if(!n.ads)return;for(const c of n.ads){const u={id:c.id,creatives:{},tag:s.toString()},y={};for(const g of c.creatives)if(g.linear){if(u.duration=Number(g.linear.duration)*1e3,g.linear.trackingEvents)for(const m of r){const d=g.linear.trackingEvents.get(m);if(Array.isArray(d)){const p=[];for(const f of d){const v=f.uri;p.push({uri:v})}if(r.includes(m)){const f=m;y[f]=[...y[f]??[],...p]}}else if(r.includes(m)){const p=m;y[p]=[...y[p]??[],d]}}}else if(g.companionAds)for(const m of g.companionAds.companions){const{id:d,height:p,width:f,altText:v,resource:h,clickThrough:w,trackingEvents:b}=m,{uri:k,creativeType:S}=h,A=h instanceof Ot?Ue.Static:h instanceof fi?Ue.HTML:h instanceof hi?Ue.IFrame:void 0,T={};for(const B of l){const K=b.get(B);K&&Array.isArray(K)?T[B]=K.reduce((se,Ie)=>[...se,{uri:Ie.uri}],[]):K&&(T[B]=[{uri:K.uri}])}const P=j(w?.uri),E={id:d,height:p,width:f,altText:v,uri:k,events:y,...P?{clickThrough:w.uri}:{},...h instanceof Ot?{creativeType:S}:{}},M=A===Ue.Static?`${P?`<a href="${w.uri}" target="_blank">`:""}<img src="${k}" alt="${v}" width="${f}" height="${p}" />${P?"</a>":""}`:A===Ue.IFrame?`<iframe src="${k}" frameborder="0" width="${f}" height="${p}" />`:A===Ue.HTML?k:void 0,H={creative:{size:{width:f,height:p},resourceType:A,content:M,height:p,width:f,events:T},companion:E};j(A)&&(u.creatives[A]=H)}o.push(u)}return performance.mark(le.End),o}catch(a){const n=a instanceof Error?a:new Error(String.prototype.toString.apply(a));e.error("Unable to parse VAST object from live stream comment",n.message),performance.clearMarks(le.Start)}else performance.clearMarks(le.Start),e.error(`Fetchhing adContext: ${t} failed`)}const Be=new Map;async function ho({COMM:t},e){if(Ge.setLogger(e),j(t)){const s={},i=po(t,e);if(i.adMarkers)for(const a of i.adMarkers)a.identifier&&!Be.has(a.identifier)?Be.set(a.identifier,a):a.identifier&&Be.has(a.identifier)&&(s[String(a.identifier)]=!0);if(i.adContext){const a=await fo(i.adContext,e),n=performance.measure(le.Name,le.Start,le.End),{duration:o}={...n};if(performance.clearMeasures(le.Name),a)return{type:"companion",data:a.reduce((r,l)=>{const c=i.adMarkers?.find(d=>String(d.identifier)===String(l.id)),{identifier:u}=c??{identifier:void 0},y=(({ParsedAdMarkers:d,currentAdMarkers:p,identifier:f})=>{if(f&&p){const v=d.get(f);if(v){const h=v.offset??0;return(p.offset&&p.offset>0?p.offset:h)+(p.start??0)}else return(p.offset??0)+(p.start??0)}else return 0})({ParsedAdMarkers:Be,currentAdMarkers:c,identifier:u});let g,m;return u&&s[String(u)]&&(g={...Be.get(u)},Be.delete(u)),y-Math.floor(o)<0&&(m=o),[...r,{companion:l,delay:Math.max(0,y-Math.floor(o??0)),identifier:u,previousAdMarkers:g,offsetTimeEvents:m}]},[])}}}}function Ti(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];for(const s in t)if(typeof t[s]=="object"&&t[s]!==null){const i=Ti(t[s],e);if(i!==void 0)return i}}async function go({ads:t,payload:e,player:s,station:i}){const a=(()=>{try{return new URL(e.tag)}catch(r){ee.error(r instanceof Error?r.message:JSON.stringify(r))}})();if(!a)return null;const{sessionstart:n,sessionid:o}=t.deserialize();if(a.searchParams.append("correlator",String(Date.now())),a.searchParams.append("type",X.Midroll),i.type!==_.Live&&j(o)&&j(n)){a.searchParams.set("sessionstart",n.toString()),a.searchParams.set("sessionid",o),t.set("sessionstart",!1);try{const r=await _i(a,ee);if(r?.status===200){const l=await r.text(),y=new Oa().parse(l).VAST;if(y){const g=[],m=y.Ad;try{for(const d of Array.isArray(m)?m:[m]){const p=Ti(d,"CompanionClickThrough");p?g.push(p):g.push(null)}}catch(d){ee.error(d instanceof Error?d.message:JSON.stringify(d))}finally{s.loadAdXml({adPayload:e,xmlDoc:new DOMParser().parseFromString(l,"text/xml"),companionClickThroughs:g}),t.set("current",{...e,tag:a.toString()}),t.set("companionClickThroughs",g)}}else s.next(!0)}else s.next(!0)}catch(r){ee.error(r instanceof Error?r.message:JSON.stringify(r)),s.setError(x.new({code:L.Midroll,message:We[L.Midroll]}))}}else i.type!==_.Live&&s.next(!0);return e}function yo({api:t,logger:e,resolvers:s}){const i=ke({seed:{current:void 0,companionClickThroughs:[],enabled:!0,env:null,errors:[],history:[],sessionid:Te(),sessionstart:!0,skipNext:!1,status:R.Idle,subscriptionType:"free",targeting:{},type:"unknown"},prefix:"player:ads.",type:"session"}),a={errors:[],featureFlags:{},history:[],index:0,isScanning:!1,metadata:null,muted:!1,queue:[],repeat:je.Yes,retry:!1,shuffled:!1,skips:Number.MAX_SAFE_INTEGER,speed:ft.Normal,station:{context:{pageName:"",playedFrom:0},type:_.Live,id:-1},status:O.Idle,time:{duration:0,position:0},volume:50,pageName:"home",lsid:""},n=ke({seed:a,prefix:"player:state.",type:"local"}),o=Ee({messages:[]}),r=Ee({});try{x.InvalidPlayerState.validate(n.deserialize())}catch{n.serialize(a)}const l=$s(d=>{n.set("time",d)},5e3),c=Ee({time:{duration:0,position:0}});c.set("time",n.get("time")),c.subscribe({set:(d,p,f)=>{l(f)}}),n.serialize({...n.deserialize(),errors:[],status:O.Idle});async function u(d,p){if(g.timeRemaining>0)return m.setMessage(`We're having trouble playing right now, please try again in ${g.timeRemainingFormatted()}`,"warning"),n.deserialize();const f=x.InvalidStation.validate(d),v=s[f.type],{station:h}=n.deserialize();f.type===_.Scan?p===void 0?v.internalState?.clear():n.set("isScanning",!0):n.set("isScanning",!1),f.type!==_.Live&&f.type!==_.Scan?i.serialize({...i.deserialize(),status:R.Idle,sessionstart:!0,sessionid:Te(),current:void 0,targeting:f.targeting}):i.serialize({...i.deserialize(),status:R.Idle,sessionstart:null,sessionid:null,current:void 0,targeting:f.targeting});const w={...i.deserialize()},b={...n.deserialize()},{time:k}={...c.deserialize()},S=await v.load({api:t,state:b,ads:w,logger:e,time:k},d);if(S){p&&(e.info(`Excluding stream format: ${p}`),S.queue=S.queue.reduce((T,P)=>(P.type===C.Stream?P.format!==p&&T.push(P):T.push(P),T),[])),S.time||(S.time={duration:0,position:0}),c.serialize({time:S.time});let A=S.index;if(f.type===_.Scan){const T=S.queue.findIndex(P=>P.id===h?.id);T>-1&&(A=T+1,A>S.queue.length-1&&(A=0))}n.serialize({...b,...S,index:A})}return m.setMetadata(),n.deserialize()}async function y({isScanning:d}){if(n.set("isScanning",d),!d){const{queue:p,index:f,station:v}=n.deserialize(),h=p.at(f);if(!h)return;const{id:w,meta:b}=h,{stationType:k}=b;if(k&&k===_.Live&&v){i.set("skipNext",!0);const S={...i.deserialize()},A={...n.deserialize()},{time:T}={...c.deserialize()},P={context:v.context,targeting:v.targeting,id:Number(w),type:_.Live},E=await s[_.Live].load({api:t,state:A,ads:S,time:T,logger:e},P);E&&(E.time||(E.time={duration:0,position:0}),c.serialize({time:E.time}),n.serialize(E),m.setMetadata())}}}const g=new zn({specialHandlers:{224003:(d,p)=>{m.setError(x.new({code:x.InternalPlayerErrorFatal.code,message:"This media type cannot be played by this browser (JW Error 224003)",data:rt(p)}))},232011:(d,p)=>{m.setError(x.new({code:x.InternalPlayerErrorFatal.code,message:"This media could not be played because of a technical error (JW Error 232011)",data:rt(p)}))}},defaultHandler:(d,p)=>{m.setError(x.new({code:x.InternalPlayerErrorFatal.code,message:`${x.InternalPlayerErrorFatal.message}. Please try again in ${d.timeRemainingFormatted()}`,data:rt(p)}))}}),m=W({async initialize(){n.set("status",O.Idle),i.set("status",R.Idle),i.set("type","unknown");const d=function(){const{queue:f=[],index:v=0}=n.deserialize();return f[v]?.type===C.Episode?{position:f[v]?.starttime??0,duration:f[v]?.duration??0}:f[v]?.type===C.Track?{position:0,duration:f[v]?.meta?.duration??0}:{position:0,duration:0}}();return n.serialize({...n.deserialize(),errors:[],time:d,status:O.Idle}),c.set("time",d),n.deserialize()},async adComplete(d){const p=x.InvalidStation.validate(n.get("station"));i.set("companionClickThroughs",[]);const f=Array.from(document.querySelectorAll("."+qn));for(const h of f)h.remove();const v=i.get("current");if(j(v)){const h=i.get("history"),w={format:v.format,station:p,status:Le.Complete,type:v.type,tag:v.tag,timestamp:Date.now()};i.set("history",[...h,w]),i.set("current",void 0)}return(v?.type===X.Midroll||d===X.Midroll)&&m.next(!0),m.setMetadata(),v?.type??d??null},async adEnd(){const{station:d}=n.deserialize();d&&await s[d.type].adEnd?.(),i.set("status",R.Done)},async adStart(d){if(d){const p=d.creativetype.includes("audio")||ms(d.mediaFile?.file)?.includes("audio"),f=!p&&(d.creativetype.includes("video")||ms(d.mediaFile?.file)?.includes("video")||d.mediaFile?.file.includes("video")),v=!p&&!f&&d.creativetype.includes("javascript");i.set("type",p?"audio":f?"video":v?"script":"unknown"),i.set("status",R.Playing);const h=i.get("current");if(j(h)){h.totalAds=d.ima?.ad.data.adPodInfo.totalAds??1,h.adIndex=d.ima?.ad.data.adPodInfo.adPosition??1;const k=i.get("companionClickThroughs")[h.adIndex-1],S=Ys.safeParse(d.ima?.ad.data.companions);S.success&&p?Array.isArray(S.data)&&S.data.length>0?h.companions=S.data.map(A=>({...A,clickThroughUrl:k})):h.companions=null:S.success||(m.setError(x.new({code:L.AdsMetadata,message:"Failed to parse companion ads!",data:{...S.error}})),h.companions=null),i.set("current",{...h})}const{name:w,meta:b}=n.get("station");n.set("metadata",{type:D.Ad,data:{...b,subtitle:`${w??"Your content"} will play after the break`}})}else i.set("status",R.Buffering)},async adRequest(){i.set("status",R.Buffering)},async beforeStart(){n.set("retry",!1),g.clearAll()},async fastForward(d){const p=de(n.deserialize()),{time:f}=de(c.deserialize()),v=de(i.deserialize()),{queue:h,index:w}=p,{duration:b,position:k}=f;x.InvalidSeekType.validate(h[w].type),x.InvalidSeekValue.validate(d),x.RestrictedDuringAdBreak.validate(v.status!==R.Idle&&v.status!==R.Done,"fastForward");const S=k+d>=b?b:k+d;return m.seek(S),S},_get(){const d=x.InvalidStation.validate(n.get("station"));return s[d.type].internalState},getAds(){return i},getFeatures(){return r},getMessages(){return o},getState(){return n},getTime(){return c},load:u,loadAdXml:async d=>d,async midroll(){const d=x.InvalidStation.validate(n.get("station")),p={...n.deserialize()},f={...c.deserialize()},v={...i.deserialize()};if(!v.enabled)return m.next(!0),null;const h=s[d.type];try{const w=await h.midroll?.({ads:v,api:t,logger:e,state:p,time:f.time});return N(w)?(i.set("status",R.Done),d.type!==_.Live&&m.next(!0),null):go({ads:i,payload:w,player:m,station:d})}catch{return null}},async next(d=!1){const p=x.InvalidStation.validate(n.get("station")),{time:f}=c.deserialize();d||x.SkipLimit.validate(n.get("skips"));const v=s[p.type],w=await x.UnsupportedMethod.validate(v.next)({api:t,state:n.deserialize(),ads:i.deserialize(),logger:e,time:f},d);return N(w)?(n.set("index",0),n.get("repeat")===je.No&&m.stop(),w):(w.time&&c.set("time",w.time),Promise.resolve(!w.isScanning&&p.type===_.Scan).then(b=>(b&&m.setScanning({isScanning:!1}),b)).then(b=>(b||(n.serialize(w),m.setMetadata()),m.play(),w)))},async pause(){const d=x.InvalidStation.validate(n.get("station")),{time:p}=c.deserialize();return await s[d.type].pause?.({api:t,ads:i.deserialize(),logger:e,state:n.deserialize(),time:p}),i.get("status")!==R.Done&&i.get("status")!==R.Idle?(m.pauseAd(i.get("status")===R.Playing),i.get("status")===R.Playing?O.Paused:O.Playing):(n.set("status",O.Paused),O.Paused)},async pauseAd(d){return n.set("status",d?O.Paused:O.Playing),i.set("status",d?R.Paused:R.Playing),d},async play(d){if(g.timeRemaining>0)return m.setMessage(`We're having trouble playing right now, please try again in ${g.timeRemainingFormatted()}`),n.get("status");const p=n.get("station");x.InvalidStation.validate(p);const f=d&&d.playedFrom!==p.context.playedFrom;f&&n.set("station",{...p,context:d});const v=n.get("station");if(i.get("status")!==R.Done&&i.get("status")!==R.Idle)return m.pauseAd(i.get("status")===R.Playing),i.get("status")===R.Playing?O.Paused:O.Playing;const h=n.get("queue"),w=n.get("index"),b=h[w],k=n.get("history").filter(M=>M.item?.type!==C.Event),S=k.at(-1)?.item,A=S===void 0?!1:lt(Je(b,["starttime","url"]),Je(S,["starttime","url"]));(f||!A)&&(n.set("history",[...k,{item:b,station:v,timestamp:Date.now()}].slice(-50)),c.set("time",{duration:1,position:0}));const T=b.type===C.Stream?O.Idle:O.Paused,P=A?{[O.Buffering]:T,[O.Idle]:b.meta.restart?O.Restart:O.Playing,[O.Paused]:b.meta.restart?O.Restart:O.Playing,[O.Playing]:T,[O.Restart]:O.Playing}[n.get("status")]:O.Playing;n.set("status",P),delete b.meta.restart,h[w]=b,n.set("queue",h);const E=s[v.type];return E&&E.play&&P===O.Playing?await E.play({api:t,state:n.deserialize(),ads:i.deserialize(),logger:e,time:c.deserialize().time}):P},async playAd(d){return x.RestrictedDuringAdBreak.validate(i.get("status")!==R.Idle&&i.get("status")!==R.Done,"playAd"),n.set("status",O.Playing),i.set("status",R.Buffering),d},async preroll(){const d=x.InvalidStation.validate(n.get("station")),p={...n.deserialize()},f={...c.deserialize()},v={...i.deserialize()};if(!v.enabled||!Nn.safeParse(d.type).success||v.skipNext)return i.set("status",R.Done),v.skipNext&&i.set("skipNext",!1),null;const h=s[d.type];try{const w=await h.preroll?.({api:t,state:p,ads:v,logger:e,time:f.time});if(N(w))return i.set("status",R.Done),i.set("current",void 0),null;i.set("current",w);const b=new URL(w.tag);return b.searchParams.set("correlator",String(Date.now())),b.searchParams.set("type",X.Preroll),m.playAd(b.toString()),w}catch{return null}},async previous(d=!0){const p=de(n.deserialize()),{station:f}=p,v=x.InvalidStation.validate(f);d||x.SkipLimit.validate(n.get("skips"));const h=s[v.type],b=await x.UnsupportedMethod.validate(h.previous)({api:t,state:n.deserialize(),ads:i.deserialize(),logger:e,time:c.deserialize().time});return N(b)?(n.set("index",0),n.get("repeat")===je.No&&m.stop(),b):(b.time&&c.set("time",b.time),n.serialize({...p,...b}),m.setMetadata(),m.play(),{...p,...b})},async reload({exclude:d}){e.info("Reloading Station");const p=n.get("station");return n.set("retry",!0),u(p,d)},async rewind(d){const p=de(n.deserialize()),{time:f}=de(c.deserialize()),v=de(i.deserialize()),{queue:h,index:w}=p,{position:b}=f;x.InvalidSeekType.validate(h[w].type),x.InvalidSeekValue.validate(d),x.RestrictedDuringAdBreak.validate(v.status!==R.Idle&&v.status!==R.Done,"rewind");const k=b-d<=0?0:b-d;return m.seek(k),k},async seek(d){const p=de(n.deserialize()),{time:f}=de(c.deserialize()),v=de(i.deserialize()),{queue:h,index:w,station:b}=p,k=x.InvalidStation.validate(b),{duration:S}=f;x.InvalidSeekType.validate(h[w].type),x.InvalidSeekValue.validate(d),x.RestrictedDuringAdBreak.validate(v.status!==R.Idle&&v.status!==R.Done,"seek");const A=s[k.type].seek,T=d>=S?S:d<=0?0:d,P={duration:S,position:T};return A?.({api:t,ads:v,logger:e,state:p,time:f},T),c.set("time",P),n.serialize({...p,time:P}),P.position},async setError(d){const p=n.get("station"),f=s[p.type],v=Ae.safeParse(d);let h=v.success?v.data:{};if(N(p))h=x.new({code:x.InvalidStation.code,data:p,message:We[L.InvalidStation]});else if(v.success)switch(v.data.code){case x.Preroll.code:{i.set("errors",[...i.get("errors"),Ae.parse(d)]);const b=i.get("current");return N(b)||(i.set("history",[...i.get("history"),{format:b.format,station:p,status:Le.Error,type:X.Preroll,tag:b.tag,timestamp:Date.now()}]),i.set("current",void 0)),d}case x.Midroll.code:{i.set("errors",[...i.get("errors"),Ae.parse(d)]);const b=i.get("current");return N(b)||(i.set("history",[...i.get("history"),{format:b.format,station:p,status:Le.Error,type:X.Preroll,tag:b.tag,timestamp:Date.now()}]),i.set("current",void 0),m.next(!0)),d}default:{v.data=Ae.parse(d);break}}else h=x.new({code:x.Generic.code,data:d,message:x.Generic.code});await f.setError?.(d);const w=Array.isArray(h.data)?h.data.filter(b=>typeof b=="string"):Ki(h.data)?Object.values(h.data).filter(b=>typeof b=="string"):null;return w&&w.some(b=>b.trim()==="This video file cannot be played.")||n.set("errors",[...n.get("errors"),h]),d},async setMessage(d,p){const f=Te(),v=ii.parse({id:f,message:d,kind:p});return o.set("messages",[...o.get("messages"),{...v}]),v},async setMetadata(d){const p=x.InvalidStation.validate(n.get("station"));if(j(d))return n.set("metadata",d),d;const f=s[p.type],v=x.UnsupportedMethod.validate(f.setMetadata),h=x.InvalidMetadata.validate(await v({ads:i.deserialize(),api:t,logger:e,state:n.deserialize(),time:c.deserialize().time},null));return n.set("metadata",h),h},async setMute(d){const p=d??!n.get("muted");return n.set("muted",p),p},async setRepeat(d){return n.set("repeat",d),d},setScanning:y,async setShuffle(d){const p=de(n.deserialize()),{station:f}=p,v=x.InvalidStation.validate(f),h=s[v.type],w=x.UnsupportedMethod.validate(h.setShuffle),b=d??!n.get("shuffled"),k=await w({ads:i.deserialize(),api:t,logger:e,state:n.deserialize(),time:c.deserialize().time},b);return n.serialize({...p,...k,shuffled:b}),{...p,...k,shuffled:b}},async setSpeed(d){const p=n.get("queue")[n.get("index")];return x.InvalidSpeed.validate(d),x.InvalidSpeedType.validate(p.type),x.InvalidStation.validate(n.get("station")),x.RestrictedDuringAdBreak.validate(i.get("status")!==R.Idle&&i.get("status")!==R.Done,"setSpeed"),n.set("speed",d),d},async setStatus(d){return x.InvalidStation.validate(n.get("station")),n.set("status",d),d},async setTime({duration:d,position:p}){const f={...n.deserialize()},{station:v,queue:h,index:w}=f,b=x.InvalidStation.validate(v);if(h?.[w]?.type===C.Stream&&b.type!==_.Scan)return{...f};const k=s[b.type];if(b.type!==_.Scan){const S=x.InvalidTime.validate({duration:d,position:p}),A=await k.setTime?.({ads:i.deserialize(),api:t,logger:e,state:f,time:S},S);return n.serialize({...f,...A}),c.set("time",S),{...f,...A,time:S}}else try{const S={duration:0,position:0},A=await k.setTime?.({ads:i.deserialize(),api:t,logger:e,state:f,time:S},S);return n.serialize({...f,...A}),A?.time&&c.set("time",A?.time),{...f,...A}}catch(S){return S&&typeof S=="object"&&"scanNext"in S&&m.next(!0),{...f}}},async setVolume(d){return x.InvalidVolume.validate(d),n.set("muted",!1),n.set("volume",d),d},async stop(){if(i.get("status")===R.Playing)return m.pauseAd(!0),O.Paused;n.set("status",O.Idle),n.set("isScanning",!1),i.set("status",R.Idle),c.set("time",{...c.get("time"),position:0});const{station:d}=n.deserialize(),p=x.InvalidStation.validate(d);return await s[p.type].stop?.(),O.Idle}});return m.subscribe({catch(d,p,...f){m.setError(p instanceof De?p:x.new({code:x.Code.Generic,message:p.message,data:{error:p,args:f,_:d}}))}}),{player:m,errorCounter:g}}function vo(){const t=ke({seed:{shuffled:[],unshuffled:[]},type:"session",prefix:"player:resolver:album:state."});return W({async load({api:s,state:i},a){const n={...a},o=Array.isArray(n.id)?n.id[0]:n.id,{body:r}=await s.api.v3.catalog.getAlbum({params:{id:o}});if("error"in r){const v=Array.isArray(r.error)?r.error.join(","):r.error;throw x.new({code:L.ApiError,message:v})}const{tracks:l,title:c}=r;n.name=c;const{items:u,ageLimit:y}=await s.api.v2.playback.postStreams({body:{hostName:s.hostName,contentIds:l.map(v=>v.id),playedFrom:n.context.playedFrom,stationId:String(n.id),stationType:"ALBUM"}}).then(J("body"));if(u===void 0||u.length===0)throw x.new({code:L.MissingStreams});const g=u.reduce((v,h)=>{const w=h.content?.id;return h.streamUrl!==void 0&&w!==void 0&&v.push({type:C.Track,id:w,meta:{...h.content,description:h.content?.artistName,image:h.content?.imagePath,subtitle:h.content?.albumName,title:h.content?.title?`${h.content?.title}${h.content?.version?` • ${h.content.version}`:""}`:void 0,childOriented:!!y},reporting:h.reportPayload,url:h.streamUrl}),v},[]);function m(v){return v.reduce((h,w)=>[...h,w.id],[])}t.set("unshuffled",g);let d=He(g);if(m(t.get("unshuffled")).length>1)for(;lt(m(t.get("unshuffled")),m(d));)d=He(t.get("unshuffled"));else d=He(t.get("unshuffled"));t.set("shuffled",d);const p=i.shuffled?t.get("shuffled"):t.get("unshuffled");let f=n.seed?p.findIndex(v=>v.id===n.seed):0;return f=f===-1?0:f,{...i,index:f,queue:p,station:n}},async next({state:s}){const{index:i,queue:a,station:n}=s,o=i===a.length-1?0:i+1;return{...s,index:o,station:{...n,seed:Number(a[o].id)}}},async previous({state:s}){const{index:i,queue:a}=s,n=i===0?a.length-1:i-1;return{...s,index:n,seed:Number(a[n].id)}},async setMetadata({state:s}){const{index:i,queue:a}=s;return{type:D.Track,data:a[i].meta}},async setShuffle({state:s}){const{index:i,queue:a,shuffled:n}=s,{shuffled:o,unshuffled:r}=t.deserialize(),l=n?r:o,c=l.findIndex(u=>u.id===a[i].id);return{...s,shuffled:!n,index:c,queue:l}}})}async function wo(t){return new Promise(e=>setTimeout(e,t))}const bo=3,Is={BASE:500,POW:.8};async function Ne({api:t,playedFrom:e,stationType:s,contentIds:i=[],initial:a=!0,seed:n,seedType:o,stationId:r},l=0){if(r===void 0||s==="PODCAST"&&i.length===0)throw x.new({code:L.InternalPlayerError});try{const{items:c,ageLimit:u}=await t.api.v2.playback.postStreams({body:{contentIds:i,playedFrom:e,hostName:t.hostName,stationId:String(r),stationType:s,startStream:a&&o&&n?{contentId:n,reason:o}:void 0}}).then(J("body"));return{items:c,ageLimit:u}}catch(c){if(c instanceof Vt){const u=await c.getResponseErrors(),y={requestPayload:await c.getRequestPayload(),requestUrl:await c.getRequestUrl(),responseErrors:u};throw u.some(m=>$e(m)&&"code"in m&&m.code===617)?x.new({code:L.ApiNoMoreSongs,data:y}):x.new({code:L.ApiError,data:y})}else if(c instanceof Error)if(c.name==="TimeoutError")if(l<bo){const u=l+1;return await wo(Math.floor((u*Is.BASE)**Is.POW)),Ne({api:t,playedFrom:e,stationType:s,contentIds:i,initial:a,seedType:o,stationId:r},u)}else throw c;else throw x.new({code:L.Generic,data:{stack:c.stack,cause:c.cause,message:c.message}});else throw x.new({code:L.Generic})}}const So=(t,e,s,i)=>{if(s==="length"||s==="prototype"||s==="arguments"||s==="caller")return;const a=Object.getOwnPropertyDescriptor(t,s),n=Object.getOwnPropertyDescriptor(e,s);!xo(a,n)&&i||Object.defineProperty(t,s,n)},xo=function(t,e){return t===void 0||t.configurable||t.writable===e.writable&&t.enumerable===e.enumerable&&t.configurable===e.configurable&&(t.writable||t.value===e.value)},_o=(t,e)=>{const s=Object.getPrototypeOf(e);s!==Object.getPrototypeOf(t)&&Object.setPrototypeOf(t,s)},To=(t,e)=>`/* Wrapped ${t}*/
${e}`,ko=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),Io=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),Ao=(t,e,s)=>{const i=s===""?"":`with ${s.trim()}() `,a=To.bind(null,i,e.toString());Object.defineProperty(a,"name",Io);const{writable:n,enumerable:o,configurable:r}=ko;Object.defineProperty(t,"toString",{value:a,writable:n,enumerable:o,configurable:r})};function Po(t,e,{ignoreNonConfigurable:s=!1}={}){const{name:i}=t;for(const a of Reflect.ownKeys(e))So(t,e,a,s);return _o(t,e),Ao(t,e,i),t}const Eo=new WeakMap,As=new WeakMap;function No(t,{cacheKey:e,cache:s=new Map,maxAge:i}={}){if(i===0)return t;if(typeof i=="number"){if(i>2147483647)throw new TypeError("The `maxAge` option cannot exceed 2147483647.");if(i<0)throw new TypeError("The `maxAge` option should not be a negative number.")}const a=function(...n){const o=e?e(n):n[0],r=s.get(o);if(r)return r.data;const l=t.apply(this,n),c=typeof i=="function"?i(...n):i;if(s.set(o,{data:l,maxAge:c?Date.now()+c:Number.POSITIVE_INFINITY}),c&&c>0&&c!==Number.POSITIVE_INFINITY){const u=setTimeout(()=>{s.delete(o)},c);u.unref?.();const y=As.get(t)??new Set;y.add(u),As.set(t,y)}return l};return Po(a,t,{ignoreNonConfigurable:!0}),Eo.set(a,s),a}const Zt=t=>{const e=new URLSearchParams;for(const[s,i]of t)$e(i)?e.set(s,Zt(Object.entries(i)).toString()):e.set(s,String(i));return e},ki=t=>{const e=Date.now().toString();return t.set("ts",e),t.set("ord",es()),t},Ii=(t,e)=>{const{ads:s,callLetters:i,feeds:a,id:n,subscriptionType:o}=e,{audio_ad_provider:r,enable_triton_token:l}=s??{},{childOriented:c=!1}=a??{},u=c?t?.Extra?.partnerTokens?.coppa:t?.Extra?.partnerTokens?.nonCoppa;let y={...t?.InStream};return r===Bt.Triton&&l&&u&&(y.partnertok=u),y={...y,callLetters:i,dist:"iheart",streamid:n.toString(),...l&&u?{partnertok:u}:{},subscription_type:o==="PREMIUM"?"all_access":o.toLowerCase()},y};async function Ai(){return globalThis.window.apstag?new Promise(t=>{try{ee.info("Fetching Amazon bids"),globalThis.window.apstag?.fetchBids({slots:[{slotID:"preroll",slotName:"preroll",sizes:[[640,480]],mediaType:"video"}],timeout:5e3},e=>{if(ee.info(`Amazon bids Length ${e?.length}`),N(e)||e.length===0){ee.info("No Amazon bids returned"),t({});return}const s=e.filter(n=>n.mediaType==="video").map(n=>n.encodedQsParams||n.helpers?.encodedQsParams()).join("");ee.info("Amazon bids encoded params",s);const i=decodeURIComponent(s),a=new URLSearchParams(i);t(Object.fromEntries(a.entries()))})}catch(e){ee.error("Error fetching Amazon bids",e),t({})}}):(ee.info("Amazon apstag not loaded"),{})}const Ro=async(t,e,s)=>{try{const i=await Ai();Object.keys(i).length>0&&(t.cust_params={...t.cust_params,...i}),e&&(t.rdp="1",t.cust_params={...t.cust_params,age:null,gender:null,zip:null}),ne(t)||(t.description_url=encodeURIComponent(window.location.href));const a=Zt(Object.entries(t));return a.toString().length>0?new URL(`${ni}?${a.toString()}`).toString():void 0}catch{s.error(x.Targeting.message)}},Co=({stationTargeting:t,ampTargeting:e,options:s})=>{const i={...t.InStream},a=s.childOriented?t?.Extra?.partnerTokens?.coppa:t?.Extra?.partnerTokens?.nonCoppa;a&&(i.partnertok=a);const n=e?.["aw_0_1st.ihmgenre"],o=e?.["aw_0_1st.playlistid"],r=e?.["aw_0_1st.playlisttype"];return{...i,ihmgenre:n,playlistid:o,playlisttype:r,dist:"iheart",...s.stationId?{streamid:s.stationId}:{},tags:n,"break-id":Te()}},es=()=>{const t=new Uint32Array(2);return globalThis.window.crypto.getRandomValues(t),t.join("")},yt=({ampTargeting:t,paramsKey:e,queue:s,stationId:i,targeting:a})=>{const n=Co({stationTargeting:{...a,InStream:{...a?.InStream,sessionstart:!1}},ampTargeting:t,options:{childOriented:s.some(({meta:r})=>!!r.childOriented),...i?{stationId:String(i)}:{}}}),o=Oo(n);if(o){const r=new URL(o),l=new URLSearchParams((()=>{if(e&&r.searchParams.has(e))return r.searchParams.get(e).toString()})());return ki(e?l:r.searchParams),e&&r.searchParams.set(e,l.toString()),{format:Se.Custom,tag:r.toString(),type:X.Midroll,companions:null}}return null},tt=(t,e)=>{try{const s=new URL(t),i=new URLSearchParams((()=>{const a=s.searchParams.get("cust_params");if(a)return a})());return ki(i),s.searchParams.set("cust_params",i.toString()),{format:e,tag:s.toString(),type:X.Preroll,companions:null}}catch{return null}},Oo=t=>{const{ua:e,us_privacy:s,...i}=t;try{const a=Zt(Object.entries({...i,us_privacy:sn(s??""),"X-Device-User-Agent":e,"X-Device-Referer":window.location.href}));return a.toString().length>0?new URL(`${jn}?${a.toString()}`).toString():null}catch{console.error(x.Targeting.message)}return null},vt=async({ampPrerollUrl:t,iu:e,seed:s,prerollTargeting:i})=>{try{const[,a]=t.split("?"),n=new URLSearchParams(a);n.set("iu",e),n.set("description_url",encodeURIComponent(window.location.href));for(const[l,c]of Object.entries(ai))n.set(l,c);const o=new URLSearchParams(n.get("cust_params")??""),r=await Ai();if(ee.info("Amazon bids set in custom preroll apsTargeting values",JSON.stringify(r)),r&&Object.keys(r)?.length>0)for(const[l,c]of Object.entries(r))ee.info(`Amazon bids set in custom preroll apsTargeting keys ${l}=${c}`),o.set(l,c);if(ee.info(`Amazon bids set in custom preroll ${o.toString()}`),o.set("ccrcontent1","null"),o.set("ccrcontent2","null"),o.set("ccrcontent3","null"),o.set("ccrpos","7005"),o.set("source","null"),s&&o.set("seed",s),i)for(const[l,c]of Object.entries(i))c&&o.set(l,String(c));return n.set("cust_params",o.toString()),new URL(`${ni}?${n.toString()}`).toString()}catch(a){console.log("Could not build custom preroll url",a)}},Fo=No(({provider:t,market:e,callLetters:s,dfpInstanceId:i,postfix:a})=>{if(!i)return;const n=!t||/clear\schannel/i.test(t)?"ccr":t?.toLowerCase().slice(0,3),o=e?e.toLowerCase().replaceAll("-","."):void 0;return`/${[String(i),[n,o,a].filter(Boolean).join("."),s?.toLowerCase()].filter(Boolean).join("/")}`});function Mo(){const t=ke({seed:{addedStation:void 0,ampTargeting:void 0},prefix:"player:resolver:artist:state.",type:"session"});async function e({api:i,station:a}){const{body:n}=await i.api.v2.playlists.postAddStation({body:{playedFrom:a.context.playedFrom},params:{type:Y.ARTIST,contentId:a.id,profileId:i.profileId}});return t.set("addedStation",n),n}function s({items:i,childOriented:a}){if(N(i)||ne(i))throw x.new({code:L.MissingStreams});return i.reduce((n,o)=>(o.streamUrl&&n.push({id:o.content?.id,meta:{...o.content,childOriented:a,description:o.content?.artistName,id:o.content?.id,image:o.content?.imagePath,subtitle:`${t.get("addedStation")?.name} Radio`,title:o.content?.title?`${o.content?.title}${o.content?.version?` • ${o.content.version}`:""}`:void 0},reporting:o.reportPayload,type:C.Track,url:o.streamUrl}),n),[])}return W({async load({api:i,state:a},n){const o={...n},r=await e({api:i,station:o});o.started=r.registeredDate,o.name=`${r.name} Radio`,o.meta={title:`${r.name} Radio`,image:`https://i.iheart.com/v3/catalog/artist/${o.id}?ops=cover(400,400)`};const l=o.seed??o.id,c=o.seed?"SONG2START":"ARTIST2START",{items:u,ageLimit:y}=await Ne({api:i,stationType:Y.RADIO,playedFrom:o.context.playedFrom,stationId:r.id,seed:l,seedType:c,initial:!0}),g=s({items:u,childOriented:!!y});return{...a,index:0,queue:g,station:o}},async midroll({state:i,ads:a,api:n}){const{queue:o,station:r}=i,{targeting:l}=a;if(N(r)||N(l))return null;const c=await n.api.v3.ads.getTargeting({query:{type:Y.ARTIST,id:r.id}}).then(J("body"));return t.set("ampTargeting",{...c,"aw_0_1st.playlistid":String(r.id)}),yt({ampTargeting:t.get("ampTargeting"),targeting:l,stationId:r.id,queue:o})},async next({api:i,state:a}){const{index:n,queue:o,station:r}=a;if(N(r))return a;let l=[...o];const c=n+1;if(c>=o.length)try{const{items:u,ageLimit:y}=await Ne({api:i,stationType:Y.RADIO,playedFrom:r.context.playedFrom,stationId:t.get("addedStation")?.id,initial:!1});l=l.concat(s({items:u,childOriented:!!y}))}catch(u){const{success:y}=Ae.safeParse(u);throw y?u:x.new({code:L.Generic})}return{...a,index:c,queue:[...l]}},async preroll({state:i,ads:a,api:n}){let o;const r=t.get("addedStation"),{dfpInstanceId:l,targeting:c}=a;if(N(r))return null;const{station:u}=i;if(N(u))return null;const{body:y}=await n.api.v2.playback.postAds({body:{host:n.hostName,stationType:Y.ARTIST,stationId:r.id,includeStreamTargeting:!0,playedFrom:u.context.playedFrom}}),{ads:g,streamTargeting:m}=y;if(m&&!ne(m))t.set("ampTargeting",{...m,"aw_0_1st.playlistid":String(u.id)});else{const d=await n.api.v3.ads.getTargeting({query:{type:Y.ARTIST,id:u.id}}).then(J("body"));t.set("ampTargeting",{...d,"aw_0_1st.playlistid":String(u.id)})}if(!ne(g)){const d=g.find(p=>p.preRoll);d&&l&&c&&(o=await vt({ampPrerollUrl:d.url,iu:`/${l}/ccr.ihr/ihr`,prerollTargeting:{...c.PreRoll,...t.get("ampTargeting")}}))}return o?tt(o,Se.Custom):null},async previous({state:i}){const{index:a}=i;return{...i,index:a===0?a:a-1}},async setMetadata({state:i}){const{index:a,queue:n}=i;return{type:D.Track,data:n[a].meta}}})}function zo(){const t=ke({seed:{addedStation:void 0,ampTargeting:void 0},prefix:"player:resolver:favorites:state.",type:"session"});async function e({api:a,station:n}){const{body:o}=await a.api.v2.playlists.postAddStation({params:{type:Y.FAVORITES,contentId:n.id,profileId:a.profileId},body:{playedFrom:n.context.playedFrom}});return t.set("addedStation",o),o}function s({items:a,childOriented:n}){if(a===void 0||a.length===0)throw x.new({code:L.MissingStreams});return a.reduce((o,r)=>(r.streamUrl&&o.push({id:r.content?.id,meta:{...r.content,childOriented:n,description:r.content?.artistName,image:r.content?.imagePath,reporting:r.reportPayload,subtitle:`${t.get("addedStation")?.name} Favorites Radio`,title:r.content?.title?`${r.content?.title}${r.content?.version?` • ${r.content.version}`:""}`:void 0},reporting:r.reportPayload,type:C.Track,url:r.streamUrl}),o),[])}return W({async load({api:a,state:n},o){const r={...o},l=await e({api:a,station:r});r.started=l.registeredDate,r.name=l.name,r.meta={title:`${l.name} Favorites Radio`,image:`https://i.iheart.com/v3/user/${r.id}/profile?ops=run("favorite"),cover(400,400)`};const{items:c,ageLimit:u}=await Ne({api:a,playedFrom:r.context.playedFrom,stationId:l.id,stationType:Y.RADIO}),y=s({items:c,childOriented:!!u});return{...n,index:0,queue:y,station:r}},async midroll({state:a,ads:n,api:o}){const{queue:r,station:l}=a,{targeting:c}=n,u=t.get("addedStation");return N(l)||N(c)||N(u)?null:(t.set("ampTargeting",await o.api.v3.ads.getTargeting({query:{type:"FAVORITE",id:u.id}}).then(J("body"))),yt({ampTargeting:t.get("ampTargeting"),targeting:c,stationId:t.get("addedStation")?.id,queue:r}))},async next({api:a,state:n}){const{index:o,queue:r,station:l}=n;if(N(l))return n;let c=[...r];const u=o+1;if(u>=c.length)try{const{items:y,ageLimit:g}=await Ne({api:a,stationId:t.get("addedStation")?.id,playedFrom:l.context.playedFrom,stationType:Y.RADIO});c=c.concat(s({items:y,childOriented:!!g}))}catch{throw x.new({code:L.ApiError})}return{...n,index:u,queue:[...c]}},async preroll({state:a,ads:n,api:o}){let r;const l=t.get("addedStation");if(N(l))return null;const{dfpInstanceId:c,targeting:u}=n,{station:y}=a;if(N(y))return null;const{body:g}=await o.api.v2.playback.postAds({body:{host:o.hostName,stationType:Y.FAVORITES,stationId:l.id,includeStreamTargeting:!0,playedFrom:y.context.playedFrom}}),{ads:m,streamTargeting:d}=g;if(d&&!ne(d)?t.set("ampTargeting",d):l.id&&t.set("ampTargeting",await o.api.v3.ads.getTargeting({query:{type:"FAVORITE",id:l.id}}).then(J("body"))),!ne(m)){const p=m.find(f=>f.preRoll);p&&c&&u&&(r=await vt({ampPrerollUrl:p.url,iu:`/${c}/ccr.ihr/ihr`,prerollTargeting:{...u.PreRoll,...t.get("ampTargeting")}}))}return r?tt(r,Se.Custom):null},async previous({state:a}){const{index:n}=a;return{...a,index:n===0?n:n-1}},async setMetadata({state:a}){const{index:n,queue:o}=a;return{type:D.Track,data:o[n].meta}}})}const jo=({lastAdComplete:t,lastAdError:e,interval:s})=>j(t)&&N(e)?Date.now()-t.timestamp<s:N(t)&&j(e)?Date.now()-e.timestamp<6e4:j(t)&&j(e)?Date.now()-e.timestamp<6e4||Date.now()-t.timestamp<s:!0,Lo=async({ads:t,interval:e,format:s,type:i})=>{const a=t.history.findLast(o=>o.type===i&&o.status===Le.Complete&&o.format===s),n=t.history.findLast(o=>o.type===i&&o.status===Le.Error&&o.format===s);return N(a)&&N(n)?!0:!jo({lastAdComplete:a,lastAdError:n,interval:e})},Ps={secure_hls_stream:ve.HLS,secure_mp3_pls_stream:ve.MP3,secure_pls_stream:ve.AAC,secure_shoutcast_stream:ve.AAC},qo=["secure_hls_stream","secure_shoutcast_stream","secure_pls_stream","secure_mp3_pls_stream"],$o=/File\d=(?<stream>.*)/g;function Vo(){const t=ke({seed:{addedStation:void 0},prefix:"player:resolver:live:state.",type:"session"});return W({async load({api:s,state:i,ads:a},n){const o={...n},{targeting:r,subscriptionType:l}=a,c=await s.api.v3.livemeta.getStationMeta({params:{stationId:o.id}}).then(J("body"));if(t.set("addedStation",c),c===void 0||c.streams===void 0||Object.keys(c.streams).length===0)throw x.new({code:L.MissingStreams});const{ads:u,callLetters:y,description:g,feeds:m,id:d,logo:p,name:f,streams:v}=c;j(r)&&j(u)&&(r.InStream={...r.InStream,...Ii(r,{ads:u,callLetters:y,feeds:m,id:d,subscriptionType:l})}),o.meta={title:f,image:`${p}?ops=cover(400,400)`},o.name=f;const h=qo.filter(S=>v[S]).map(S=>({url:v[S],format:Ps[S],type:S})).filter(S=>!!S);if(h.length===0)throw new Error(x.MissingStreams.message);const w=es(),b=await h.reduce(async(S,A)=>{if(A.type!=="secure_pls_stream"){const T=new URL(A.url);for(const[P,E]of Object.entries(r?.InStream??{}))E&&T.searchParams.set(P,String(E));return T.searchParams.set("ord",w),[...await S,{...A,url:T.toString()}]}try{const E=[...(await(await window.fetch(A.url)).text()).matchAll($o)].filter(M=>!!M.groups&&"stream"in M.groups).reduce((M,H)=>{try{const B=new URL(H.groups.stream);for(const[K,se]of Object.entries(r?.InStream??{}))se&&B.searchParams.set(K,String(se));B.searchParams.set("ord",w),M.push({url:B.toString(),format:Ps[A.type],type:A.type})}catch{}return M},[]);return[...await S,...E]}catch{return S}},Promise.resolve([]));if(b.length===0)throw x.new({code:L.MissingStreams});const k=b.map(S=>({format:S.format,id:o.id,meta:{...c,childOriented:m?.childOriented??!1,description:g,image:p,subtitle:f},type:C.Stream,url:S.url}));return{...i,index:0,queue:k,station:o}},async preroll({ads:s,api:i,logger:a,state:n}){let o;const{station:r}=n,{targeting:l,dfpInstanceId:c}=s;if(await Lo({ads:s,interval:Ln,format:Se.Live,type:X.Preroll})===!1)return null;const{userPrivacyOptOut:u=!1}=i.getConfig(),y=t.get("addedStation");if(N(y))return null;const{callLetters:g,format:m,markets:d,provider:p}=y;if(N(r))return null;const f=d?.filter(v=>v.isPrimary)?.[0]??d?.[0];if(c){const v=Fo({provider:p,callLetters:g,market:f?.name,dfpInstanceId:Number(c),postfix:void 0});v&&l&&(o=await Ro({iu:v,...ai,cust_params:{...l.PreRoll,ccrpos:"7005",ccrcontent2:"LIVE",ccrformat:m,ccrmarket:f?.name,playedfrom:String(r.context)}},u,a))}return o!==void 0?tt(o,Se.Live):null},async play({api:s,state:i}){const{profileId:a,sessionId:n}=s.getConfig();return a&&n&&(await s.api.v2.playlists.postAddStation({params:{type:"LIVE",profileId:a,contentId:i.station.id},body:{addToFavorites:!1,playedFrom:i.station.context.playedFrom,contentId:i.station.id}}),await s.api.v1.liveRadio.postRegisterListen({params:{profileId:String(a),stationId:String(i.station.id)},body:{profileId:Number(a),sessionId:n}})),i.status},async setMetadata({state:s}){const{index:i,queue:a}=s;return{type:D.Station,data:a[i].meta}}})}function Uo(){const t=Ee({playlist:void 0,shuffled:[],unshuffled:[]});async function e({api:a,station:n}){if(t.get("playlist")!==void 0)return;const[o,r]=n.id.split("::"),{body:l}=await a.api.v3.collection.getCollection({params:{id:r,userId:o}});t.set("playlist",l),t.set("unshuffled",l.tracks.map(u=>({id:u.id,meta:{description:"",image:"",subtitle:"",title:"",trackId:u.trackId,childOriented:l?.childOriented??!1},type:C.Track,url:""})));const c=t.get("unshuffled");t.set("shuffled",He(c))}async function s({api:a,index:n,queue:o,station:r}){try{if(o[n].url)return o;const{items:l,ageLimit:c}=await a.api.v2.playback.postStreams({body:{hostName:a.hostName,contentIds:[o[n].meta.trackId],playedFrom:r.context.playedFrom,stationId:String(r.id),stationType:Y.COLLECTION}}).then(J("body"));if(l===void 0||l.length===0)throw new Error(":(");const[u]=l;return o[n]={...o[n],url:u.streamUrl,meta:{...u.content,childOriented:(t.get("playlist")?.childOriented||!!c)??!1,isCurated:t.get("playlist")?.curated??!1,description:u.content?.artistName,image:u.content?.imagePath,subtitle:t.get("playlist")?.name,followed:t.get("playlist")?.followed,followable:t.get("playlist")?.followable,title:u.content?.title?`${u.content?.title}${u.content?.version?` • ${u.content.version}`:""}`:void 0},reporting:u.reportPayload},o}catch{throw x.new({code:L.NoAvailableSongs})}}return W({async load({api:a,state:n},o){const r={...o};t.set("playlist",void 0),await e({api:a,station:r}),r.name=t.get("playlist")?.name,r.meta={title:t.get("playlist")?.name,image:`${t.get("playlist")?.urls.image}?ops=cover(400,400)`};const l=n.shuffled?t.get("shuffled"):t.get("unshuffled");let c=r.seed?l.findIndex(y=>y.id===r.seed):0;c=c===-1?0:c;const u=await s({api:a,index:c,queue:l,station:r});return{...n,index:c,queue:u,station:r}},async next({api:a,state:n}){const{index:o,queue:r,station:l}=n;if(N(l))return n;await e({api:a,station:l});const c=o===r.length-1?0:o+1,u=await s({api:a,index:c,queue:r,station:l});return{...n,index:c,queue:u}},async previous({api:a,state:n}){const{index:o,queue:r,station:l}=n;if(N(l))return n;await e({api:a,station:l});const c=o===0?r.length-1:o-1,u=await s({api:a,index:c,queue:r,station:l});return{...n,index:c,queue:u}},async setMetadata({state:a}){const{index:n,queue:o}=a;return{type:D.Track,data:o[n].meta}},async setShuffle({state:a},n){const{index:o,queue:r}=a,l=t.get("shuffled"),c=t.get("unshuffled"),u=n?l:c,y=u.findIndex(g=>g.id===r[o].id);return{...a,index:y,queue:u}}})}function Bo(){const t=ke({seed:{playlist:void 0,ampTargeting:void 0},prefix:"player:resolver:playlistradio:state.",type:"session"});async function e({api:a,station:n}){const[o,r]=n.id.split("::"),{body:l}=await a.api.v3.collection.getCollection({params:{id:r,userId:Number(o)}});return t.set("playlist",l),l}function s({items:a,childOriented:n}){if(N(a)||ne(a))throw x.new({code:L.MissingStreams});return a.reduce((o,r)=>(r.streamUrl&&o.push({id:r.content?.id,meta:{...r.content,childOriented:(t.get("playlist")?.childOriented||n)??!1,description:r.content?.artistName,image:r.content?.imagePath,subtitle:t.get("playlist")?.name??"",followed:t.get("playlist")?.followed,followable:t.get("playlist")?.followable,isCurated:t.get("playlist")?.curated??!1,title:r.content?.title?`${r.content?.title}${r.content?.version?` • ${r.content.version}`:""}`:void 0},reporting:r.reportPayload,type:C.Track,url:r.streamUrl}),o),[])}return W({async load({api:a,state:n},o){const r={...o},l=await e({api:a,station:r});r.started=Date.now(),r.name=l.name,r.meta={title:l.name,image:`${l.urls.image}?ops=cover(400,400)`},r.targeting.PreRoll={...r.targeting.PreRoll,...l.type==="new4u"||l.type==="personalized"?{seed:l.id}:{}};const{items:c,ageLimit:u}=await Ne({api:a,stationId:r.id,playedFrom:r.context.playedFrom,stationType:Y.COLLECTION}),y=s({items:c,childOriented:!!u});return{...n,index:0,queue:y,station:r}},async midroll({state:a,ads:n}){const{queue:o,station:r}=a,{targeting:l}=n;return N(r)||N(l)?null:yt({ampTargeting:t.get("ampTargeting"),queue:o,targeting:l,stationId:t.get("playlist")?.id})},async next({api:a,state:n}){const{index:o,queue:r,station:l}=n;if(N(l))return n;let c=[...r];const u=o+1;if(u>=r.length)try{const{items:y,ageLimit:g}=await Ne({api:a,stationId:l.id,playedFrom:l.context.playedFrom,stationType:Y.RADIO});c=c.concat(s({items:y,childOriented:!!g}))}catch{throw x.new({code:L.ApiError})}return{...n,index:u,queue:[...c]}},async preroll({state:a,ads:n,api:o}){let r;const{station:l}=a,{targeting:c,dfpInstanceId:u}=n,y=t.get("playlist");if(N(l)||N(y))return null;const{body:g}=await o.api.v2.playback.postAds({body:{host:o.hostName,stationType:Y.COLLECTION,stationId:l.id,includeStreamTargeting:!0,playedFrom:l.context.playedFrom}}),{ads:m,streamTargeting:d}=g;if(d&&!ne(d)?t.set("ampTargeting",d):t.set("ampTargeting",await o.api.v3.ads.getTargeting({query:{type:Y.COLLECTION,id:y.id}}).then(J("body"))),d&&!ne(m)){const p=m.find(v=>v.preRoll),f=zs(c.PreRoll,l.targeting.PreRoll);p&&u&&c&&(r=await vt({ampPrerollUrl:p.url,iu:`/${u}/ccr.ihr/ihr`,prerollTargeting:{...f,...t.get("ampTargeting")}}))}return r!==void 0?tt(r,Se.Custom):null},async previous({state:a}){const{index:n}=a;return{...a,index:n===0?n:n-1}},async setMetadata({state:a}){const{index:n,queue:o}=a;return{type:D.Track,data:o[n].meta}}})}function oe(t){return Math.floor(t.position)>=Math.floor(t.duration)}const Es=$s(({api:t,state:e},s)=>{const{index:i,queue:a,station:n,featureFlags:o}=e,r=a[i],l=Number(a[i].id),c=Number(n?.id);return t.api.v3.podcast.updateEpisodeProgress({params:{episodeId:l,podcastId:c},body:{completed:o?.newPodcastPlaybackOrder?r.meta.completed||oe(s):r.meta.completed??oe(s),secondsPlayed:Math.floor(s.position)},throwOnErrorStatus:!1}),o?.newPodcastPlaybackOrder?r.meta.completed||oe(s):r.meta.completed??oe(s)},1e4);function Ho(){const t=ke({seed:{pageKey:void 0,podcast:void 0,triton:void 0},prefix:"player:resolver:podcast:state.",type:"session"});async function e({api:o,station:r}){const{body:l}=await o.api.v3.podcast.getPodcast({params:{id:r.id}});return t.set("podcast",l),l}async function s({api:o,initial:r,station:l,featureFlags:c}){try{const u=[];if(r&&l.seed){const{body:g}=await o.api.v3.podcast.getEpisode({params:{id:l.seed},query:{withProgress:!0}});g.episode.completed=c?.newPodcastPlaybackOrder?g.episode.completed||oe({duration:g.episode.duration,position:g.episode.secondsPlayed??0}):g.episode.completed??oe({duration:g.episode.duration,position:g.episode.secondsPlayed??0}),u.push(g.episode),t.set("pageKey",g.pageKey)}else{const{body:g}=await o.api.v3.podcast.getRecentPlaybackStatus({params:{podcastId:l?.id}});if(r&&g.data.length>0){const m=g?.data[0]?.id,{body:d}=await o.api.v3.podcast.getEpisode({params:{id:m},query:{withProgress:!0}});u.push(d.episode),t.set("pageKey",d.pageKey)}else{const{body:m}=await o.api.v3.podcast.getPodcastEpisodes({params:{id:l.id},query:{limit:r?2:1,pageKey:t.get("pageKey"),sortBy:c?.newPodcastPlaybackOrder?r?t.get("podcast")?.showType==="serial"?"startDate-asc":"startDate-desc":"startDate-asc":t.get("podcast")?.showType==="serial"?"startDate-asc":"startDate-desc"}});if(m.data.length===0)return{queue:[],childOriented:!1};for(const d of m.data)u.push(d);t.set("pageKey",m.links.next)}}let y=!1;if(u[0].id){const{body:g}=await o.api.v3.podcast.getPodcastEpisodesWithWindow({params:{episodeId:u[0].id},query:{limitAfter:1,limitBefore:1,sortBy:c?.newPodcastPlaybackOrder||t.get("podcast")?.showType==="serial"?"startDate-asc":"startDate-desc"}});g.episodes[0].id===u[0].id&&(l.isFirstEpisode=!0),g.episodes?.at(-1)?.id==u[0].id&&(l.isLastEpisode=!0)}return{queue:await u.reduce(async(g,m)=>({...await g,[Symbol.for(String(m.id))]:{id:m.id,completed:m.completed??!1,transcriptionAvailable:m.transcriptionAvailable??!1,secondsPlayed:m.secondsPlayed??0,duration:m.duration,imageUrl:m.imageUrl??""}}),Promise.resolve({})).then(async g=>{const{items:m,ageLimit:d}=await Ne({api:o,contentIds:Object.getOwnPropertySymbols(g).reduce((p,f)=>[...p,g[f].id],[]),playedFrom:l.context.playedFrom,stationType:Y.PODCAST,stationId:l.id});if(d&&(y=!0),N(m)||m.length===0)throw x.new({code:L.MissingStreams});return m.reduce((p,f)=>{if(f.streamUrl&&f.content&&f.content.id){const v=g[Symbol.for(String(f.content.id))];let h=f.streamUrl;const w=t.get("triton");if(c?.podcastTritonTokenEnabled&&l.providerId&&w!==void 0&&w?.[l.providerId]&&w?.[l.providerId].token){const b=new URL(h);b.searchParams.set("partnertok",w[l.providerId].token.toString()),h=b.toString()}p.push({id:f.content?.id,duration:v.duration??f.content.duration,meta:{...f.content,childOriented:y,description:t.get("podcast")?.title,image:v.imageUrl??t.get("podcast")?.imageUrl,subtitle:f.content?.title,podcastId:t.get("podcast")?.id,podcastSlug:t.get("podcast")?.slug,title:void 0,transcriptionAvailable:v.transcriptionAvailable??!1,secondsPlayed:v.secondsPlayed??f.content.secondsPlayed??0,duration:v.duration??f.content.duration,completed:v.completed},reporting:f.reportPayload,starttime:l.timestamp??v.secondsPlayed??0,type:C.Episode,url:h})}return p},[])}),childOriented:y}}catch(u){throw u instanceof Vt?x.new({code:L.ApiError,data:{requestUrl:await u.getRequestUrl(),requestPayload:await u.getRequestPayload(),responseErrors:await u.getResponseErrors()}}):u instanceof Error?x.new({code:L.Generic,data:{stack:u.stack,cause:u.cause,message:u.message}}):x.new({code:L.Generic})}}async function i({api:o,featureFlags:r,queue:l,station:c}){if(l[0].id){const{body:u}=await o.api.v3.podcast.getPodcastEpisodesWithWindow({params:{episodeId:l[0].id},query:{limitAfter:0,limitBefore:1,sortBy:r?.newPodcastPlaybackOrder||t.get("podcast")?.showType==="serial"?"startDate-asc":"startDate-desc"}}),y=await u.episodes;if(y[0].id!==c.seed)c.seed=y[0].id;else return c.isFirstEpisode=!0,l;return(await s({api:o,initial:!0,station:c,featureFlags:r})).queue.concat(l)}return l}const a=async({api:o,featureFlags:r,index:l,newQueue:c,station:u})=>{let y=l+1;if(y>=c.length&&t.get("pageKey")){const{queue:g}=await s({api:o,initial:!1,station:u,featureFlags:r});if(ne(g))return u.isLastEpisode=!0,null;c=c.concat(g)}return y>=c.length&&(y=c.length-1),{nextIndex:y,nextQueue:c}};return W({async load({api:o,state:r},l){const c={...l};if(N(c))return r;if(t.set("pageKey",void 0),j(t.get("podcast"))&&t.get("podcast")?.id!==l.id){const{station:p,queue:f,index:v,time:h}=r;if(f[v].type===C.Episode){const b=Number(f[v].id),k=p.id;await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:b,podcastId:k},body:{completed:oe(h),secondsPlayed:Math.floor(h.position)}})}}const u=await e({api:o,station:c}),y=t.get("triton"),g=Math.floor(Date.now()/1e3),m=u?.adTargeting?.providerId&&y?.[u.adTargeting.providerId];if(r.featureFlags?.podcastTritonTokenEnabled&&u.adTargeting?.providerId&&(!m||m?.expiration<g)&&r.lsid){const{body:p}=await o.api.v3.oauth.postGenerateTritonToken({body:{lsid:r.lsid,providerId:u.adTargeting.providerId}});t.set("triton",{...y,[u.adTargeting.providerId]:{token:p.token,expiration:p.expirationDate}})}c.started=Date.now(),c.name=u.title,c.providerId=u.adTargeting?.providerId,c.meta={title:u.title,image:`${u.imageUrl}?ops=cover(400,400)`};const{queue:d}=await s({api:o,initial:!0,station:c,featureFlags:r.featureFlags});return delete c.timestamp,{...r,index:0,repeat:je.No,station:c,time:{position:d[0].starttime??0,duration:d[0].duration},queue:d}},async midroll({state:o,ads:r}){const{queue:l,station:c}=o,{targeting:u}=r;return N(c)||N(u)?null:yt({queue:l,targeting:u,stationId:t.get("podcast")?.id})},async next({api:o,state:r,time:l}){const{index:c,queue:u,station:y,featureFlags:g}=r;if(N(y))return r;y.isFirstEpisode=!1;let m=[...u];const d=m[c];if(d&&y){const p=Number(y.id),f=Number(d.id),v=g?.newPodcastPlaybackOrder?oe(l):oe(l)||d.meta.completed;await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:f,podcastId:p},body:{completed:v,secondsPlayed:Math.floor(l.position)}}),d.meta.completed=v}if(g?.newPodcastPlaybackOrder){const p=await a({api:o,station:y,newQueue:m,index:c,featureFlags:g});if(p){const{nextQueue:f,nextIndex:v}=p;if(oe({duration:f[v].duration??1,position:f[v].meta.secondsPlayed??0}))return f[v].starttime=0,{...r,index:v,queue:f,time:{position:0,duration:f[v].duration},station:{...y,seed:Number(f[v].id)}};m=f;const h={position:m[v].starttime,duration:m[v].duration};return{...r,index:v,queue:m,time:h,station:{...y,seed:Number(m[v].id)}}}else return null}else{let p=!1;for(;!p;){const f=await a({api:o,station:y,newQueue:m,index:c,featureFlags:g});if(f){const{nextQueue:v,nextIndex:h}=f;if(v[h]?.meta.completed)continue;{p=!0,m=v;const w={position:m[h].starttime,duration:m[h].duration};return{...r,index:h,queue:m,time:w,station:{...y,seed:Number(m[h].id)}}}}else return null}}return null},async pause({api:o,state:r,time:l}){const{index:c,queue:u,station:y,status:g}=r,m=Number(y?.id),d=Number(u[c]?.id);return await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:d,podcastId:m},body:{completed:oe(l),secondsPlayed:Math.floor(l.position)},throwOnErrorStatus:!1}),g},async play({api:o,state:r}){const{index:l,queue:c,station:u,status:y,featureFlags:g}=r,m=c[l],d=Number(u?.id),p=Number(c[l]?.id),f=g?.newPodcastPlaybackOrder?oe({duration:m.duration??1,position:m.meta.secondsPlayed??0}):m.meta.completed&&m.meta.secondsPlayed>=m.meta.duration;return g?.newPodcastPlaybackOrder&&(m.meta.completed||f?(m.starttime=f?0:m.meta.secondsPlayed??0,m.meta.completed=!1,m.meta.secondsPlayed=f?0:m.meta.secondsPlayed??0,await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:p,podcastId:d},body:{completed:!1,secondsPlayed:m.meta.secondsPlayed},throwOnErrorStatus:!1})):f&&await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:p,podcastId:d},body:{completed:!1,secondsPlayed:0},throwOnErrorStatus:!1})),y},async preroll({state:o,ads:r,api:l}){let c;const{station:u}=o,{dfpInstanceId:y,targeting:g}=r,m=t.get("podcast");if(N(u)||N(m))return null;const{body:d}=await l.api.v2.playback.postAds({body:{host:l.hostName,stationType:Y.PODCAST,stationId:String(m.id),includeStreamTargeting:!1,playedFrom:u.context.playedFrom}});if(d.ads){const p=d.ads.find(f=>f.preRoll);p&&y&&g&&(c=await vt({ampPrerollUrl:p.url,iu:`/${y}/ccr.ihr/ihr`,prerollTargeting:{...g.PreRoll}}))}return j(c)?tt(c,Se.Custom):null},async previous({api:o,state:r,time:l}){const{index:c,queue:u,station:y,featureFlags:g}=r;let m=[...u],d=c;c<=1&&(m=await i({api:o,station:y,queue:m,featureFlags:g}),d=1);const p=Number(y?.id),f=Number(u[c]?.id);y.isLastEpisode=!1;const v=oe(l);await o.api.v3.podcast.updateEpisodeProgress({params:{episodeId:f,podcastId:p},body:{completed:v,secondsPlayed:Math.floor(l.position)},throwOnErrorStatus:!1}),m[d]=Object.assign(m[d],{starttime:v?0:Math.floor(l.position)});const h=d-1,w={position:Math.floor(m[h].starttime),duration:m[h].duration};return{...r,queue:m,index:h,time:w,station:{...y,seed:Number(m[h].id)}}},async seek({api:o,state:r,time:l},c){const u={duration:l.duration,position:c};return Es({api:o,state:r},u),u.position},async setMetadata({state:o}){const{index:r,queue:l}=o;return{type:D.Episode,data:l[r].meta}},async setTime({api:o,state:r},l){return Es({api:o,state:r},l),{...r,time:l}}})}function ge(t){return`"${t}"`}const Pt="https://i.iheart.com",V=Object.freeze({Anchor:"anchor",BC:"bc",Blur:"blur",BoxMerge:"boxmerge",Contain:"contain",Cover:"cover",Crop:"crop",CropExact:"cropexact",CropI:"cropi",Duotone:"duotone",Dup:"dup",Fit:"fit",FitWithin:"fitwithin",Flood:"flood",Format:"format",Gradient2:"gradient2",Gravity:"gravity",Grey:"grey",Grid:"grid",Load:"load",Max:"max",MaxContain:"maxcontain",Merge:"merge",New:"new",Pluck:"pluck",Quality:"quality",Ratio:"ratio",Resize:"resize",ResizeI:"resizei",Run:"run",Scale:"scale",Smush:"smush",Swap:"swap",Tile:"tile"}),Wo=Object.freeze(Object.values(V));function Go(t){if(URL.canParse(t))return new URL(t);throw new TypeError(`Cannot create URL from: "${t}"`)}class z{cacheable;ops;url;static fromURL(e){if(e instanceof z)return e.clone();if(typeof e=="string"&&(e=Go(e)),!(e instanceof URL))throw console.trace("bad url"),new TypeError(`Cannot create MediaServerURL from "${e}"`);if(e?.hostname&&e.hostname!=="i.iheart.com"&&e.hostname!=="i-stg.iheart.com"){const s=btoa(e.toString());e=new URL(["v3","url",s].join("/"),Pt)}return new z({url:e})}static fromCatalog({type:e,id:s}){const i=new URL(["v3","catalog",e,s].join("/"),Pt);return new z({url:i})}static forUser({id:e}){const s=new URL(["v3","user",e,"profile"].join("/"),Pt);return new z({url:s})}constructor({cacheable:e=!0,url:s,ops:i=[]}){if(this.cacheable=e,this.ops=[...i],this.url=new URL(s),this.url.searchParams.has("ops")){const n=decodeURIComponent(this.url.searchParams.get("ops")).split("),").map(o=>{const[r,l]=o.split("(");if(Wo.includes(r))return`${r}(${l.endsWith(")")?l.slice(0,-1):l})`}).filter(o=>o!==void 0);this.ops=[...n,...this.ops],this.url.searchParams.delete("ops")}}hasOp(e){return this.ops.some(s=>s.startsWith(e))}removeOps(e){return this.ops=this.ops.filter(s=>!s.startsWith(e)),this}toURL(){return this.ops.length>0&&this.url.searchParams.set("ops",this.ops.join(",")),this.cacheable&&!this.url.searchParams.has("cacheable")&&this.url.searchParams.append("cacheable","true"),this.url}toString(){return this.toURL().toString()}clone(){const e=new URL(this.url);return e.search="",new z({url:e,ops:this.ops})}clear(){return this.url.searchParams.delete("ops"),this.ops=[],this}static _load(e){const s=e instanceof URL?e.toString():e;return`${V.Load}("${s}")`}load(e){return this.ops.push(z._load(e)),this}setCacheable(e){return this.cacheable=e,this}static _resize(e=0,s=0){return`${V.Resize}(${[e,s].join(",")})`}resize(e=0,s=0){return this.ops.push(z._resize(e,s)),this}static _scale(e=0,s=0){return`${V.Scale}(${[e,s].join(",")})`}scale(e=0,s=0){return this.ops.push(z._scale(e,s)),this}static _resizei(e,s){return`${V.ResizeI}(${[e,s].join(",")})`}resizei(e=0,s=0){return this.ops.push(z._resizei(e,s)),this}static _cover(e,s){return`${V.Cover}(${[e,s].join(",")})`}cover(e=0,s=0){return this.ops.push(z._cover(e,s)),this}static _fit(e,s){return`${V.Fit}(${[e,s].join(",")})`}fit(e=0,s=0){return this.ops.push(z._fit(e,s)),this}static _contain(e,s){return`${V.Contain}(${[e,s].join(",")})`}contain(e=0,s=0){return this.ops.push(z._contain(e,s)),this}static _fitwithin(e,s){return`${V.FitWithin}(${[e,s].join(",")})`}fitwithin(e=0,s=0){return this.ops.push(z._fitwithin(e,s)),this}static _max(e,s){return`${V.Max}(${[e,s].join(",")})`}max(e=0,s=0){return this.ops.push(z._max(e,s)),this}static _maxcontain(e,s){return`${V.MaxContain}(${[e,s].join(",")})`}maxcontain(e=0,s=0){return this.ops.push(z._maxcontain(e,s)),this}static _crop(e,s){return`${V.Crop}(${[e,s].join(",")})`}crop(e=0,s=0){return this.ops.push(z._crop(e,s)),this}static _cropi(e,s){return`${V.CropI}(${[e,s].join(",")})`}cropi(e=0,s=0){return this.ops.push(z._cropi(e,s)),this}static _cropexact(e,s,i,a){return`${V.CropExact}(${[e,s,i,a].join(",")})`}cropexact(e=0,s=0,i=0,a=0){return this.ops.push(z._cropexact(e,s,i,a)),this}static _ratio(e,s){return`${V.Ratio}(${[e,s].join(",")})`}ratio(e,s){return this.ops.push(z._ratio(e,s)),this}static _blur(e){return`${V.Blur}(${e})`}blur(e){return this.ops.push(z._blur(e)),this}static _grey(){return`${V.Grey}()`}grey(){return this.ops.push(z._grey()),this}static _bc(e,s){return`${V.BC}(${[e,s].join(",")})`}bc(e,s){return this.ops.push(z._bc(e,s)),this}static _duotone(e,s){return`${V.Duotone}(${[e,s].map(ge).join(",")})`}duotone(e,s){return this.ops.push(z._duotone(e,s)),this}static _flood(e){return`${V.Flood}(${ge(e)})`}flood(e){return this.ops.push(z._flood(e)),this}static _gradient2(e,s,i){return`${V.Gradient2}(${ge(e)},${ge(s)},${i})`}gradient2(e,s,i){return this.ops.push(z._gradient2(e,s,i)),this}static _gravity(e){return`${V.Gravity}(${ge(e)})`}gravity(e){return this.ops.push(z._gravity(e)),this}static _anchor(e,s){return`${V.Anchor}(${[e,s].join(",")})`}anchor(e,s){return this.ops.push(z._anchor(e,s)),this}static _smush(){return`${V.Smush}()`}smush(){return this.ops.push(z._smush()),this}static _dup(){return`${V.Dup}()`}dup(){return this.ops.push(z._dup()),this}static _swap(){return`${V.Swap}()`}swap(){return this.ops.push(z._swap()),this}static _new(){return`${V.New}()`}new(){return this.ops.push(z._new()),this}static _merge(e){return`${V.Merge}(${ge(e)})`}merge(e){return this.ops.push(z._merge(e)),this}static _boxmerge(e,s){const i=Object.entries(s).map(([a,n])=>a+":"+n).join(",");return`${V.BoxMerge}(${[ge(e),ge(i)].join(",")})`}boxmerge(e,s){return this.ops.push(z._boxmerge(e,s)),this}static _pluck(e){return`${V.Pluck}(${e})`}pluck(e){return this.ops.push(z._pluck(e)),this}static _tile(e,s){return`${V.Tile}(${[e,s].join(",")})`}tile(e,s){return this.ops.push(z._tile(e,s)),this}static _grid(e,s,i,a,n){return`${V.Grid}(${[e,s,i,a,n].join(",")})`}grid(e,s,i,a,n){return this.ops.push(z._grid(e,s,i,a,n)),this}static _format(...e){return`${V.Format}(${e.map(ge).join(",")})`}format(...e){return this.ops.push(z._format(...e)),this}static _quality(e){return`${V.Quality}(${e})`}quality(e){return this.ops.push(z._quality(e)),this}static _run(e){return`${V.Run}(${ge(e)})`}run(e){return this.ops.push(z._run(e)),this}}const Ns={secure_hls_stream:ve.HLS,secure_mp3_pls_stream:ve.MP3,secure_pls_stream:ve.AAC,secure_shoutcast_stream:ve.AAC},Do=["secure_hls_stream","secure_shoutcast_stream","secure_pls_stream","secure_mp3_pls_stream"],Xo=/File\d=(?<stream>.*)/g;function Qo(){const t=ke({seed:{currentIndex:0,ids:void 0,iterations:0,scanDuration:qe("7s"),stationStart:void 0,stations:[]},prefix:"player:resolver:scan:state.",type:"session"});return W({internalState:t,async load({api:s,logger:i,state:a,ads:n,time:o},r){const l={...r},{targeting:c,subscriptionType:u}=n;if(!Array.isArray(r.id)||r.id.length<3)throw x.new({code:L.InvalidStation,message:"Cannot scan fewer than three stations"});const y=t.get("ids");if(y&&us(y,r.id).length===0&&us(r.id,y).length===0)return a;t.clear();const g=await Promise.allSettled(r.id.map(p=>s.api.v3.livemeta.getStationMeta({params:{stationId:p}}).then(J("body")))).then(p=>p.map(f=>f.status==="rejected"?null:f.value)).then(p=>p.filter(j));t.set("stations",g),t.set("ids",g.map(({id:p})=>p)),t.set("scanDuration",r.scanDuration??qe("7s")),t.set("iterations",0),t.set("stationStart",void 0),j(c)&&j(g[0]?.ads)&&(c.InStream={...c.InStream,...Ii(c,{ads:g[0].ads,callLetters:g[0].callLetters,feeds:g[0].feeds,id:g[0].id,subscriptionType:u})});function m(p){const f=t.get("ids")?.filter(h=>h!==p),v=t.get("stations")?.filter(h=>h.id!==p);t.set("ids",f),t.set("stations",v)}const d=[];for(const p of g){const{description:f,feeds:v,id:h,name:w,streams:b}=p;if(N(b)||ne(b)){i.warn(`${We.MissingStreams} Station id: ${h}`),m(h);continue}const k=Do.filter(T=>b[T]).map(T=>({url:b[T],format:Ns[T],type:T})).filter(T=>!!T);if(k.length===0){i.warn(`${We.ValidStreams} Station id: ${h}`),m(h);continue}const S=es(),A=await k.reduce(async(T,P)=>{if(P.type!=="secure_pls_stream")try{const E=new URL(P.url);for(const[M,H]of Object.entries(c?.InStream??{}))H&&E.searchParams.set(M,String(H));return E.searchParams.set("ord",S),[...await T,{...P,url:E.toString()}]}catch{return T}try{const H=[...(await(await window.fetch(P.url)).text()).matchAll(Xo)].filter(B=>!!B.groups&&"stream"in B.groups).reduce((B,K)=>{try{const se=new URL(K.groups.stream);for(const[Ie,Ve]of Object.entries(c?.InStream??{}))Ve&&se.searchParams.set(Ie,String(Ve));se.searchParams.set("ord",S),B.push({url:se.toString(),format:Ns[P.type],type:P.type})}catch{}return B},[]);return[...await T,...H]}catch{return T}},Promise.resolve([]));if(A.length===0){i.warn(`${We.ResolvedStreams} Station id: ${h}`),m(h);continue}d.push({id:h,type:C.Stream,meta:{...p,...l.meta,image:z.fromCatalog({type:"live",id:h}).fit(150).quality(50).toString(),childOriented:v?.childOriented??!1,description:f,subtitle:w,stationType:_.Live},url:A[0].url,sources:Wt.parse(A.map(T=>({type:T.format,file:T.url})))})}if(d.length===0)throw x.new({code:L.MissingStreams});return l.meta={title:d[0].meta.title,image:z.fromCatalog({type:"live",id:d[0].id}).cover(200,200).quality(70).toString()},{...a,time:{...o,position:0},index:0,queue:d,station:l,repeat:je.No}},async next({state:s}){const{index:i,queue:a,station:n}=s;let r=t.get("iterations"),l=i+1<a.length?i+1:0;return l===0&&r<3&&(r+=1),r===3&&l===0&&(s.isScanning=!1,l=a.length-1),t.set("iterations",r),{...s,station:n,index:l}},async setError(s){return s instanceof De&&(s.code===L.AutoplayBlocked||s.code===L.InternalPlayerError||s.code===L.NetworkError||s.code===L.CriticalError)&&t.set("stationStart",void 0),s},async setMetadata({state:s}){const{index:i,queue:a}=s;return{type:D.Station,data:a[i].meta}},async setTime({ads:s,state:i}){const{stationStart:a,scanDuration:n}=t.deserialize();if(!s.current)if(a)if(a){const o={duration:Math.floor(n/1e3),position:a?Math.floor((Date.now()-a)/1e3):0},r=Date.now()-a;if(a&&r>t.get("scanDuration")&&i.isScanning)throw t.set("stationStart",void 0),{scanNext:!0};return{...i,...i.isScanning?{time:o}:{}}}else return{...i,time:{duration:0,position:0}};else return t.set("stationStart",Date.now()),{...i,...i.isScanning?{time:{duration:n/1e3,position:0}}:{}};return{...i,time:{duration:0,position:0}}},async stop(){return t.set("stationStart",void 0),O.Idle}})}function Yo(){const t=Ee({shuffled:[],unshuffled:[]});return W({async load({api:s,state:i},a){const n={...a};try{const[{artist:o},{tracks:r}]=await Promise.all([s.api.v3.artists.getArtistProfile({params:{id:n.id}}).then(J("body")),s.api.v3.catalog.getArtistTracks({params:{id:n.id},query:{limit:50,offset:0}}).then(J("body"))]);n.name=`${o.name} Top Songs`,n.meta={title:`${o.name} Top Songs`,image:`https://i.iheart.com/v3/catalog/artist/${o.artistId}?ops=cover(400,400)`};const{items:l}=await s.api.v2.playback.postStreams({body:{hostName:s.hostName,contentIds:r.map(m=>m.id),playedFrom:n.context.playedFrom,stationId:String(n.id),stationType:Y.RADIO}}).then(J("body"));if(l===void 0||l.length===0)throw x.new({code:L.MissingStreams});t.set("unshuffled",l.reduce((m,d)=>(d.streamUrl&&m.push({id:d.content?.id,meta:{...d.content,artistId:o.artistId,artistName:o.name,description:d.content?.albumName,image:d.content?.imagePath,subtitle:`${o.name} Top Songs`,title:d.content?.title?`${d.content?.title}${d.content?.version?` • ${d.content.version}`:""}`:void 0},reporting:d.reportPayload,type:C.Track,url:d.streamUrl}),m),[]));const c=t.get("shuffled"),u=t.get("unshuffled");t.set("unshuffled",i.shuffled?He(u):u);const y=i.shuffled?c:t.get("unshuffled");let g=n.seed?y.findIndex(m=>m.id===n.seed):0;return g=g===-1?0:g,{...i,index:g,queue:y,station:n}}catch(o){if(o instanceof De)throw o;if(o instanceof Vt){const r={requestPayload:await o.getRequestPayload(),requestUrl:await o.getRequestUrl(),responseErrors:await o.getResponseErrors()};throw x.new({code:L.ApiError,data:r})}else if(o instanceof Error)throw x.new({code:L.Generic,data:{stack:o.stack,cause:o.cause,message:o.message}});throw x.new({code:L.Generic})}},async next({state:s}){const{index:i,queue:a,station:n}=s,o=i===a.length-1?0:i+1;return{...s,index:o,station:{...n,seed:Number(a[o].id)}}},async previous({state:s}){const{index:i,queue:a}=s,n=i===0?a.length-1:i-1;return{...s,index:n,seed:Number(a[n].id)}},async setMetadata({state:s}){const{index:i,queue:a}=s;return{type:D.Track,data:a[i].meta}},async setShuffle({state:s},i){const{index:a,queue:n}=s,o=t.get("shuffled"),r=t.get("unshuffled");i&&t.set("shuffled",He(o));const l=i?o:r,c=l.findIndex(u=>u.id===n[a].id);return{...s,index:c,queue:l}}})}const Ko={[_.Album]:vo(),[_.Artist]:Mo(),[_.Favorites]:zo(),[_.Live]:Vo(),[_.Playlist]:Uo(),[_.PlaylistRadio]:Bo(),[_.Podcast]:Ho(),[_.Scan]:Qo(),[_.TopSongs]:Yo()};function Jo({index:t,metadata:e,queue:s,station:i,user:a}){switch(i.type){case _.Artist:return{stationId:`${_.Artist}|${i.id}`,stationName:i.name,stationType:_.Artist,stationSubtype:"radio"};case _.Album:return{stationId:`${_.Artist}|${e.artistId}`,stationName:e.artistName,stationType:_.Artist,stationSubid:`${_.Album}|${e?.albumId}`,stationSubname:e.albumName,stationSubtype:_.Album};case _.TopSongs:return{stationId:`${_.Artist}|${e.artistId}`,stationName:e.artistName,stationType:_.Artist,stationSubid:`top_songs|${i.id}`,stationSubname:i.name,stationSubtype:_.TopSongs};case _.Favorites:return{stationId:`my_favorites_radio|${i.id}`,stationName:e.subtitle,stationType:_.Favorites,stationSubtype:String(i.id)===a?.profileId?"my":"shared"};case _.Live:return{stationId:`${_.Live}|${e.id}`,stationName:e.name,stationType:_.Live};case _.Scan:return{stationId:`${_.Live}|${s[t].id}`,stationName:s[t].meta.name,stationType:_.Live};case _.PlaylistRadio:case _.Playlist:{const[n,o]=String(i.id).split("::");return{stationId:Ei({isCurated:e.isCurated,profileId:a?.profileId,playlistUserId:n,playlistId:o,playlistType:e.playlistType,userType:a?.subscriptionTier,isAnonymous:a?.registration?.type==="ANONYMOUS"}),stationName:i.name??e.subtitle??"",stationType:_.Playlist}}case _.Podcast:return{stationId:`${_.Podcast}|${e.podcastId}`,stationName:i.name,stationType:_.Podcast,stationSubid:`episode|${e.id}`,stationSubname:e.subtitle,stationSubtype:"episode"};default:return{stationId:`${i.type}|${i.id}`,stationName:i.name}}}function Pi({metadata:t,station:e,user:s}){switch(e.type){case _.Artist:return{stationId:`${_.Artist}|${e.id}`,stationName:t.artistName,stationType:_.Artist,stationSubtype:"radio",stationSubid:`song|${t.id}`,stationSubname:t.title};case _.Album:return{stationId:`${_.Album}|${t.albumId}`,stationName:t.albumName,stationType:_.Artist,stationSubid:`song|${t.id}`,stationSubname:t.title,stationSubtype:_.Album};case _.TopSongs:return{stationId:`top_songs|${e.id}`,stationName:e.name,stationType:_.Artist,stationSubid:`song|${t.id}`,stationSubname:t.title,stationSubtype:_.TopSongs};case _.Favorites:return{stationId:`my_favorites_radio|${e.id}`,stationName:t.subtitle,stationType:_.Favorites,stationSubid:`song|${t.id}`,stationSubname:t.title,stationSubtype:String(e.id)===s?.profileId?"my":"shared"};case _.PlaylistRadio:case _.Playlist:{const[i,a]=String(e.id).split("::");return{stationId:Ei({isCurated:t.isCurated,profileId:s?.profileId,playlistUserId:i,playlistId:a,playlistType:t.playlistType,userType:s?.subscriptionTier,isAnonymous:s?.registration?.type==="ANONYMOUS"}),stationName:e.name??t.subtitle,stationType:_.Playlist,stationSubid:`song|${t.id}`,stationSubname:t.title}}case _.Podcast:return{stationId:`${_.Podcast}|${t.podcastId}`,stationName:t.subtitle,stationType:_.Podcast,stationSubid:`episode|${t.id}`,stationSubname:t.description,stationSubtype:"episode"};default:return{stationId:`${e.type}|${e.id}`,stationName:t.title}}}function Ei({isCurated:t,profileId:e,playlistUserId:s,playlistId:i,playlistType:a,userType:n,isAnonymous:o}){if(a==="new4u")return`new_for_you_playlist|${e}`;let r="my_playlist";return t?o||n==="NONE"?r="playlist_radio":r="curated_playlist":e===s&&a!=="default"?r="user_playlist":e!==s&&(r="shared_user_playlist"),`${r}|${s}::${i}`}function Ke({analyticsState:t,eventType:e,followed:s,index:i,metadata:a,queue:n,station:o,user:r}){const l=e==="stream"?Jo({index:i,metadata:a,queue:n,station:o,user:r}):Pi({metadata:a,station:o,user:r});return{station:{asset:{id:l.stationId,name:l.stationName,...l.stationType&&{type:l.stationType},...l.stationSubtype&&{subtype:l.stationSubtype},...l.stationSubid&&{subid:l.stationSubid},...l.stationSubname&&{subname:l.stationSubname}},hadPreroll:t.hadPreroll,isSaved:s,playbackStartTime:t.playbackStartTime,playedFrom:o.context.playedFrom,sessionId:t.streamSessionId,startPosition:t.startPosition,streamInitTime:t.streamInitTime}}}function Zo({api:t,state:e,timeState:s,analytics:i,ads:a}){const n=Ee({isScanStation:!1,isStreamStart:!1,isTrackStart:!1,streamSessionId:"",streamInitTime:0,playbackStartTime:0,scanStopType:"auto_end",startPosition:0,trackSessionId:"",oldTrackSessionId:"",oldVolume:0,hadPreroll:!1}),o=async(d,p)=>{const f=i.getGlobalData().user;if(f?.registration?.type==="ANONYMOUS")return!1;switch(p){case _.Podcast:{const{status:v}=await t.api.v3.podcast.getIsFollowingPodcast({params:{podcastId:Number(d)},throwOnErrorStatus:!1});return v===200}case _.Artist:{const{status:v}=await t.api.v3.profiles.getIsArtistFollowed({params:{artistId:Number(d)},throwOnErrorStatus:!1});return v===204}case _.Live:{const{status:v}=await t.api.v3.profiles.getIsLiveStationFollowed({params:{liveStationId:Number(d)},throwOnErrorStatus:!1});return v===204}case _.Playlist:case _.PlaylistRadio:{const{status:v}=await t.api.v3.collection.getFollowStatus({params:{id:d?.toString().split("::")[1],userId:f?.profileId??""},throwOnErrorStatus:!1});return v===200}}},r=async()=>{if(!n.get("isStreamStart")){const d=i.getGlobalData().user,{station:p,metadata:f,queue:v,index:h}=e.deserialize();if(ee.info("Firing stream start",{station:p,metadata:f}),n.set("streamInitTime",Date.now()),n.set("queryId",p.context?.queryId),p&&f){const w=Ke({analyticsState:{playbackStartTime:n.get("playbackStartTime"),startPosition:n.get("startPosition"),streamInitTime:n.get("streamInitTime"),streamSessionId:n.get("streamSessionId"),hadPreroll:n.get("hadPreroll")},eventType:"stream",followed:await o(p.id?.toString(),p.type)??!1,index:h,metadata:f.data,queue:v,station:p,user:d});i.track({type:ue.enum.StreamStart,data:{...w,view:{pageName:p.context.pageName}}}),n.set("isStreamStart",!0)}}},l=async()=>{if(!n.get("isTrackStart")){const d=i.getGlobalData().user,{station:p,metadata:f,queue:v,index:h}=e.deserialize();if(p&&f){const w=n.get("oldTrackSessionId")===n.get("trackSessionId");if((f.type===D.Track||f.type===D.Episode)&&!w){const b=Ke({analyticsState:{playbackStartTime:n.get("playbackStartTime"),startPosition:n.get("startPosition"),streamInitTime:n.get("streamInitTime"),streamSessionId:n.get("streamSessionId"),hadPreroll:n.get("hadPreroll")},eventType:"track",followed:await o(p.id?.toString(),p.type)??!1,index:h,metadata:f.data,queue:v,station:p,user:d});n.set("oldTrackSessionId",n.get("trackSessionId")),i.track({type:ue.enum.TrackStart,data:{station:{...b.station,subSessionId:n.get("trackSessionId")}}}),n.set("isTrackStart",!0)}}}},c=async({endReason:d})=>{if(n.get("isStreamStart")){const p=i.getGlobalData().user,{history:f,index:v,queue:h,shuffled:w,station:b}=e.deserialize(),{station:k,item:S}=f?.filter(A=>A.item.type!==C.Event).at(-1)??{};if(ee.info("Firing stream end",{oldStation:k,station:b,item:S}),k&&S?.meta){const A=n.get("streamInitTime"),T=Ke({analyticsState:{playbackStartTime:n.get("playbackStartTime"),startPosition:n.get("startPosition"),streamInitTime:A,streamSessionId:n.get("streamSessionId"),hadPreroll:n.get("hadPreroll")},eventType:"stream",followed:await o(k.id?.toString(),k.type)??!1,index:v,metadata:S.meta,queue:h,station:k,user:p}),P=Math.floor((Date.now()-A)/1e3);let E;k.type===_.Podcast&&k.id!=null&&(E=await g(k.id.toString()));const{daySkipsRemaining:M,hourSkipsRemaining:H}=await y(P),B=n.get("queryId"),K=S.format;i.track({type:ue.enum.StreamEnd,data:{station:{...T.station,listenTime:P,hadPreroll:n.get("hadPreroll"),endReason:d,shuffleEnabled:w,exitSpot:a.get("current")?"ad":"music",offlineEnabled:"No Value",...qi({daySkipsRemaining:M,hourSkipsRemaining:H,completionRate:E,streamProtocol:K},j)},...B&&{search:{queryId:B}}}}),n.set("isStreamStart",!1)}}},u=async()=>{if(n.get("isTrackStart")){const d=i.getGlobalData().user,{history:p,index:f,queue:v,time:h}=e.deserialize(),{station:w,item:b}=p?.filter(k=>k.item.type!==C.Event).at(-1)??{};if(w&&b?.meta){const k=Ke({analyticsState:{playbackStartTime:n.get("playbackStartTime"),startPosition:n.get("startPosition"),streamInitTime:n.get("streamInitTime"),streamSessionId:n.get("streamSessionId"),hadPreroll:n.get("hadPreroll")},eventType:"track",followed:await o(w.id?.toString(),w.type)??!1,index:f,metadata:b.meta,queue:v,station:w,user:d}),S=h.position-n.get("startPosition");i.track({type:ue.enum.TrackEnd,data:{station:{...k.station,endReason:"new_station_start",listenTime:S>0?S:h.position,subSessionId:n.get("trackSessionId")}}}),n.set("isTrackStart",!1)}}},y=async d=>{const{history:p}=e.deserialize(),{item:f}=p?.filter(w=>w.item.type!==C.Event).at(-1)??{};if(f==null||f?.reporting==null)return{daySkipsRemaining:null,hourSkipsRemaining:null};const{daySkipsRemaining:v,hourSkipsRemaining:h}=await t.api.v3.playback.postReporting({body:{modes:[],offline:!1,playedDate:Date.now(),replay:!1,reportPayload:f?.reporting,secondsPlayed:d,stationId:String(f?.id),status:"SKIP"}}).then(J("body"));return{daySkipsRemaining:v,hourSkipsRemaining:h}},g=async d=>{const{body:p}=await t.api.v3.podcast.getRecentPlaybackStatus({params:{podcastId:d}});if(j(p)&&p.data.length>0&&p.data[0].secondsPlayed&&p.data[0].duration){const f=p.data[0].secondsPlayed/p.data[0]?.duration;return Number.parseFloat(f.toFixed(2))}return 0};return[W({initialize(){const{volume:d}=e.deserialize();n.set("streamSessionId",Te()),n.set("trackSessionId",Te()),n.set("oldVolume",d)},load(){const{index:d,queue:p}=e.deserialize();u(),c({endReason:"new_station_start"});const f=p[d]?.starttime??0;n.set("startPosition",Math.round(f)),n.set("streamSessionId",Te()),n.set("trackSessionId",Te()),n.set("hadPreroll",!1)},play(){i.setGlobalData({device:{isPlaying:!0}}),n.set("playbackStartTime",Date.now());const{station:d}=e.deserialize();d?.type===_.Scan?n.set("isScanStation",!0):n.set("isScanStation",!1)},pause(){i.setGlobalData({device:{isPlaying:!1}}),a.get("current")||c({endReason:"pause"})},async reload(d,{sourceError:p}){if(p){const{pageName:f,station:v,history:h,index:w,queue:b}=e.deserialize(),k=i.getGlobalData().user,{item:S}=h?.filter(E=>E.item.type!==C.Event).at(-1)??{},A=b[w].type,T=[C.Stream].includes(A)?"stream":"track",P=Ke({analyticsState:{playbackStartTime:n.get("playbackStartTime"),startPosition:n.get("startPosition"),streamInitTime:n.get("streamInitTime"),streamSessionId:n.get("streamSessionId"),hadPreroll:n.get("hadPreroll")},eventType:T,followed:await o(v.id.toString(),v.type)??!1,index:w,metadata:S?.meta??{},queue:b,station:v,user:k});await i.track({type:ue.enum.StreamFallback,data:{view:{pageName:f??""},station:{...P.station,fallbackErrorCode:p?.response?.code,fallbackErrorDescription:p?.response?.text}}})}},stop(d="stop"){const{pageName:p}=e.deserialize();i.setGlobalData({device:{isPlaying:!1}}),a.get("current")||(u(),c({endReason:d}),n.get("isScanStation")&&i.track({type:ue.enum.ScanStopped,data:{view:{pageName:p??""},scan:{stopType:"miniplayer"}}}))},adStart(){n.set("hadPreroll",!0)},beforeStart:()=>{r(),l()},fastForward(){const{metadata:d,pageName:p}=e.deserialize();if(d?.data?.podcastId&&p){const{time:f}=s.deserialize(),v={id:`${_.Podcast}|${d?.data?.podcastId}`,name:d?.data?.subtitle??"",subid:`${d?.type}|${d?.data?.id}`,subname:d?.data?.description??""};i.track({type:ue.enum.Forward30,data:{pageName:p??"",station:{asset:v,playheadPosition:f.position?.toFixed(2)},item:{asset:v}}})}},rewind(){const{metadata:d,pageName:p}=e.deserialize();if(d?.data?.podcastId&&p){const{time:f}=s.deserialize(),v={id:`${_.Podcast}|${d?.data?.podcastId}`,name:d?.data?.subtitle??"",subid:`${d?.type}|${d?.data?.id}`,subname:d?.data?.description??""};i.track({type:ue.enum.Back15,data:{pageName:p??"",station:{asset:v,playheadPosition:f.position?.toFixed(2)},item:{asset:v}}})}},next(d,p,f="next"){const{queue:v,index:h,station:w}=e.deserialize();w?.type===_.Scan?c({endReason:f}):u();const b=v[h]?.starttime??0;n.set("startPosition",Math.round(b)),n.set("oldTrackSessionId",""),n.set("trackSessionId",Te())},setScanning(d,{isScanning:p,skip:f}){const{history:v,station:h}=e.deserialize(),w=j(f)&&f===!0;if(!p&&!w){const{station:b}=v?.filter(k=>k.item.type!==C.Event).at(-1)??{};h?.type===_.Live&&b?.type===_.Scan&&i.track({type:ue.enum.ScanStopped,data:{view:{pageName:"home"},scan:{stopType:"auto_end"}}})}},setVolume(d){const{history:p,index:f,queue:v}=e.deserialize(),{station:h,item:w}=p?.filter(S=>S.item.type!==C.Event).at(-1)??{},{volume:b}=e.deserialize(),k=i.getGlobalData().user;if(h&&w?.meta){const S=Pi({metadata:{...h.meta,...w?.meta},station:h,user:k});i.track({type:ue.enum.VolumeChange,data:{station:{asset:{id:S.stationId,name:S.stationName,...S.stationSubid&&{subid:S.stationSubid?.toString(),subname:S.stationSubname}}},device:{oldVolume:Math.round(n.get("oldVolume")),newVolume:Math.round(b)}}})}n.set("oldVolume",d)}}),n]}function el(t=pt({enabled:!0,namespace:"@iheartradio/web.utilities:safe-interval"})){if(!globalThis.window)return t.warn("Don't use createSafeInterval on the server! Returning an emitter with no-ops"),W({has(i){return t.warn("Don't use createSafeInterval on the server"),!1},clear(i){return t.warn("Don't use createSafeInterval on the server"),!1},clearAll(){t.warn("Don't use createSafeInterval on the server")},set(i,a,n){return t.warn("Don't use createSafeInterval on the server"),-1},setLogger(i){t.warn("Don't use createSafeInterval on the server")},size(){return-1}});const e=new Map;let s=t;return W({has(i){const a=Symbol.for(i);return e.has(a)},clear(i){const a=Symbol.for(i);return e.has(a)||t.warn(`Attempting to clear interval: ${i} that has not been previously set`),globalThis.window.clearInterval(e.get(a)),e.delete(a)},clearAll(){s.warn("Clearing ALL intervals, be sure you want to do this");const i={};for(const[a,n]of e.entries())globalThis.window.clearInterval(n),i[a]=e.delete(a);return i},set(i,a,n){const o=Symbol.for(i);e.has(o)&&(s.warn(`Interval "${i}" already exists! Clearing and resetting...`),globalThis.window.clearInterval(e.get(o)),e.delete(o));const r=globalThis.window.setInterval(a,n);return e.set(o,r),r},setLogger(i){s=i},size(){return e.size}})}function Ni({artistId:t,artistName:e,trackId:s,trackName:i}){const a=Number(t)>0?Number(t):void 0,n=Number(s)>0?Number(s):void 0,o=a&&a>0?`https://i.iheart.com/v3/catalog/artist/${a}?ops=cover(400,400)`:"",r=n&&n>0?`https://i.iheart.com/v3/catalog/track/${n}?ops=cover(400,400)`:"";return{artistId:a,artistImage:o,artistName:e,description:e,image:r||o,subtitle:void 0,title:i,trackId:n,trackImage:r,trackName:i}}const re="live-meta",Rs="buffer-timeout",ye={[C.Stream]:"This stream is taking too long to load",[C.Track]:"This track is taking too long to load",[C.Episode]:"This is episode is taking too long to load",[C.Event]:"The player is taking too long to load"},tl={[_.Album]:`${ye[C.Track]}, trying the next track`,[_.Artist]:`${ye[C.Track]}, trying the next track`,[_.Favorites]:`${ye[C.Track]}, trying the next track`,[_.Live]:`${ye[C.Stream]}, please try again in a few moments`,[_.Playlist]:`${ye[C.Track]}, trying the next track`,[_.PlaylistRadio]:`${ye[C.Track]}, trying the next track`,[_.Podcast]:`${ye[C.Episode]}, trying the next episode`,[_.Scan]:`${ye[C.Stream]}, trying the next station`,[_.TopSongs]:`${ye[C.Track]}, trying the next track`},xe={Track:"Tracks are taking too long to load, stopping playback for now. Please try again in a few minutes",Stream:"Streams are taking too long to load, stopping playback for now. Please try again in a few minutes",Episode:"Episodes are taking too long to load, stopping playback for now. Please try again in a few minutes"},sl={[_.Album]:xe.Track,[_.Artist]:xe.Track,[_.Favorites]:xe.Track,[_.Live]:xe.Stream,[_.Playlist]:xe.Track,[_.PlaylistRadio]:xe.Track,[_.Podcast]:xe.Episode,[_.Scan]:xe.Stream,[_.TopSongs]:xe.Track},il={fatal:!1},nl=({amp:t,player:e,jwPlayer:s,logger:i,options:a,SafeInterval:n,SafeTimeout:o})=>{const{methods:r}=a,l=Number(e.getFeatures().get("playbackBufferTimeout")??7e3),{load:c,setStatus:u,setAdsStatus:y,setCurrentTrackMeta:g,getAdsStatus:m}=r;function d(h=il){const{fatal:w}=h;o.set(Rs,()=>{const b=e.getState().deserialize(),{station:k,queue:S,index:A}=b,{type:T}=k,P=S[A].type,M=T!==_.Live?tl[T]:ye[P];e.setMessage(M),T===_.Live||w?(e.stop(),w&&(e.setError(x.new({code:L.NetworkError,message:sl[T]})),i.error("Buffer timeout fatal, stopping playback",{message:M}))):(i.info("Buffer timeout reached, skipping to next item in queue",{message:M}),e.next(!0,M))},l)}function p(){o.clear(Rs)}return{jwPlayerEventHandlers:W({adBreakEnd(h){try{const b=new URL(h.tag).searchParams.get("type"),S=(b?b.includes(X.Preroll):e.getAds().get("current")?.type)?X.Preroll:X.Midroll;e.adComplete(S)}catch{e.adComplete(e.getAds().get("current")?.type)}},adClick(){u(O.Paused),y(R.Paused)},adError(h){let w;try{w=new URL(h.tag)}catch{const b=e.getAds().get("current")?.tag;b&&(w=new URL(b))}if(w){const b=w.searchParams.get("type"),k=b?b.includes(X.Preroll):e.getAds().get("current")?.type,{code:S,message:A}=k?x.Preroll:x.Midroll,T=x.new({code:S,message:A,data:h});e.setError(T),e.adEnd()}else{const b=x.new({code:L.Generic});e.setError(b),e.adEnd()}},adPlay(){u(O.Playing),y(R.Playing),p()},adRequest(){e.adRequest()},adSkipped(h){const b=new URL(h.tag).searchParams.get("type"),S=(b?b.includes(X.Preroll):e.getAds().get("current")?.type)?X.Preroll:X.Midroll;e.adComplete(S)},adStarted(h){e.adStart(h)},adTime(h){const{duration:w,position:b}=h;e.setTime({duration:Math.max(0,w),position:Math.max(0,b)})},autostartNotAllowed(h){const w=x.new({code:x.AutoplayBlocked.code,data:h});e.setError(w)},beforeComplete(){e.midroll()},beforePlay(){e.preroll()},buffer({newstate:h,reason:w}){const b=new Set(["stalled","error"]);new Set(["idle","playing","paused"]).has(h)?p():h==="buffering"?b.has(w)?b.has(w)&&d({fatal:!0}):(u(O.Buffering),d({fatal:!1})):b.has(w)&&d({fatal:!0})},error(h){return async w=>{const{isScanning:b,queue:k,index:S}=e.getState().deserialize(),A=b?k[S].meta.subtitle:void 0,T=x.new({code:b?x.InternalPlayerErrorDuringScan.code:x.InternalPlayerError.code,data:rt(w),meta:A}),P=kn.safeParse(w.sourceError);if(h.shouldRetry(w.code))if(h.retry(w.code,w)){await e.stop(T.message),e.setMessage("We've encountered an issue playing this station, trying again..."),e.getAds().set("skipNext",!0);let E;try{E=s.getPlaylistItem()?.sources?.at(0)?.type}catch(M){i.error(M instanceof Error?M.message:"Could not get current playlist item format",M)}await e.reload({exclude:E,...P.success?{sourceError:P.data}:{}}),await e.play()}else e.stop(T.message),e.setError(T);else e.setError(T);b&&(i.info("Skipping to next station in scan playback",{error:T}),e.next(!0,T.message))}},idle(){u(O.Idle),y(R.Idle)},async metadataCueParsed(h){const{station:w}=e.getState().deserialize();if(w.type===_.Live){i.info("Parsing metadata cue",{data:h},["META"]);const b=_n.safeParse(h);async function k(S,A){const T=await uo(S,t);if(T){const P=Ni(T);e.setMetadata({type:D.InStream,data:{...P,subtitle:A.subtitle,id:A.id,name:A.description}})}else{const P=new Error(`Received track ID: ${S} from metadata, but unable to locate track in catalog`);i.warn(P.message,{},["META"]);try{globalThis.window?.newrelic?.noticeError?.(P,{streamId:String(e.getState().get("station").id),TPID:String(S),ts:String(Date.now()),cue:JSON.stringify(h)})}catch{}e.setMetadata({type:D.Station,data:{...A}})}}if(b.success){i.info("Metadata cue parsed",{data:b.data},["META"]);const{queue:S,index:A}=e.getState().deserialize(),T=S[A].meta;if("TXXX"in b.data.metadata)b.data.metadata.TXXX.URL.song_spot!=="T"?await k(b.data.metadata.TXXX.URL.TPID,T):e.setMetadata({type:D.Station,data:{...T}});else if("WXXX"in b.data.metadata)b.data.metadata.WXXX.URL.song_spot!=="T"?await k(b.data.metadata.WXXX.URL.TPID,T):e.setMetadata({type:D.Station,data:{...T}});else if("COMM"in b.data.metadata){const{COMM:P}=b.data.metadata,E=$e(P)?P.ENG:P,M=await ho({COMM:E},i);if(M&&M.type==="companion")for(const H of M.data){const{companion:B,delay:K,identifier:se=String(Date.now()),previousAdMarkers:Ie,offsetTimeEvents:Ve}=H;i.info(`Setting Live Stream companion, ${se}`,{companion:B,delay:K,COMM:E,previousAdMarkers:Ie}),mo({liveInStreamAdPayload:B,player:e,logger:i,delay:K,identifier:se,offsetTimeEvents:Ve})}}else e.setMetadata({type:D.Station,data:{...T}})}else i.warn("Parsing metadata cue failed",{error:b.error.flatten(),data:h},["META"])}},pause(){u(O.Paused)},play(){u(O.Playing),y(R.Done),p(),e.beforeStart()},playAttemptFailed(h){const w=x.new({code:x.PlayAttemptFailed.code,data:h});e.setError(w)},ready(){const h=e.getState().deserialize(),{index:w,muted:b,queue:k,volume:S,time:A}=h,T=k[w];j(T)&&(k[w]={...T,starttime:A.position},c(h)),b?s.setMute(b):s.setVolume(S)},setupError(h){const w=x.new({code:x.InternalPlayerError.code,data:h});e.setError(w)},time({duration:h,position:w}){e.setTime({duration:h,position:w})},async adsManager(h){const{adsManager:w,videoElement:b}=h,k=e.getAds().get("anID");if(Yi(k))try{const S=new URLSearchParams(new URL(w.adTagUrl).search),A={anId:k,campId:S?.get("sz"),chanId:S?.get("iu"),env:e.getAds().get("env"),placementId:"Open Auction",pubOrder:"Video",pubId:"Direct",pubCreative:"Default Creative"};window.googleImaVansAdapter&&window.googleImaVansAdapter.init(window.google,w,b,A),i.info("adsManager",A)}catch(S){i.warn(S instanceof Error?S.message:JSON.stringify(S))}}}),visibilitychangeHandler:()=>{const h=e.getState().deserialize(),{station:w,queue:b,index:k,status:S}=h,A=b[k]?.meta,T=m()===R.Paused;document.visibilityState==="visible"&&T&&(i.info("Visibility change to visible, skipping ad break"),s.skipAdBreak()),document.visibilityState==="visible"&&w&&w.type===_.Live&&w.id&&A?(S!==O.Playing&&g({streamId:Number(w.id),stationMeta:A}),n.set(re,()=>g({streamId:Number(w.id),stationMeta:A}),5e3)):w.type===_.Live&&n.has(re)&&n.clear(re)}}};function al(t,e,s,i){const a=el(s),n=ci(s);let o=!0,r;const{api:l}=e;let c=!1;function u(){const{status:h}=t.getAds().deserialize();return!![R.Buffering,R.Playing,R.Paused,R.Streaming].includes(h)}async function y({streamId:h,stationMeta:w}){if(!u()){const b=await g({streamId:h}),k=b?.type??D.Station,S={...w,...b?.data};t.setMetadata({type:k,data:S})}}async function g({streamId:h}){if(!c){const w=await l.v3.livemeta.getCurrentTrackMeta({params:{streamId:h}}).then(({body:T})=>T).catch(async T=>{const{response:P}=T;if(P)switch(P.status){case 404:case 410:case 424:{a.has(re)&&a.clear(re),c=!0;break}case 422:{const M=await(await P.clone().blob()).text();try{return JSON.parse(M)}catch{a.has(re)&&a.clear(re),c=!0;break}}}});if(ne(w))return;const{artistId:b,artist:k,trackId:S,title:A}=w;if(b&&k&&S&&A&&Number(b)>-1&&Number(S)>-1){const T=Object.fromEntries(Object.entries(Ni({artistId:b,artistName:k,trackId:S,trackName:A})).reduce((P,[E,M])=>(ds(M)&&P.push([E,M]),P),[]));return{type:D.InStream,data:T}}}}function m(h){if(N(h?.station))return;const w=h.queue[h.index],b=new URL(w.url);b.searchParams.set("modTime",`${Date.now()/1e3}`);const k=w.type===C.Episode,S=h.station.type===_.Live?[fs.parse({sources:h.queue.reduce((A,T)=>{const P=new URL(T.url);return P.searchParams.set("modTime",`${Date.now()/1e3}`),T.format&&A.push({file:P.toString(),type:T.format}),A},[])})]:h.station.type===_.Scan?[fs.parse({sources:w.sources})]:[Tn.parse({file:b.toString(),preload:"auto",starttime:o||w.type===C.Episode?w.starttime:void 0,type:w.format})];r.setPlaybackRate(k?h.speed:ft.Normal),r.load(S),a.has(re)&&a.clear(re),h.station.type===_.Live?(a.set(re,()=>y({streamId:Number(w.id),stationMeta:w.meta}),5e3),c=!1):a.has(re)&&(a.clear(re),c=!0),o=!1}function d(){r.pause(),r.setMute(!1),r.off("seeked",d)}async function p(h){const w=r.getState();(w===O.Idle||w===O.Paused)&&(r.on("seeked",d),r.setMute(!0)),r.seek(h)}let f;return W({fastForward:p,async initialize(){if(N(globalThis?.window))return;try{await nn(()=>ds(globalThis.window.jwplayer))}catch{t.setError(x.new({code:L.CriticalError}));return}const h=globalThis.window?.document.querySelector("#jw-player"),w=h??globalThis.window?.document.createElement("div"),b=globalThis.window?.document.querySelector("#iheart-player-container"),k=b??globalThis.window?.document.createElement("div");t.getAds()?.get("env"),h||(w.id="jw-player"),b||(k.id="iheart-player-container",k.append(w),document.body.append(k)),r=window.jwplayer(w).setup({advertising:{client:"googima"},autostart:!1,controls:!1,file:"https://www.iheart.com/static/assets/blank.mp4",preload:"auto",responsive:!0,width:"100%",aspectratio:"16:9"});const{call:S}=an(E=>t.setStatus(E),{timing:"trailing",waitMs:100}),P=nl({amp:e,player:t,jwPlayer:r,logger:s,options:{methods:{load:m,setCurrentTrackMeta:y,setStatus:S,setAdsStatus:E=>t.getAds().set("status",E),getAdsStatus:()=>t.getAds().get("status")??R.Idle,isAdBreak:u}},SafeInterval:a,SafeTimeout:n});f=P.jwPlayerEventHandlers,r.on("adBreakEnd",f.adBreakEnd),r.on("adClick",f.adClick),r.on("adError",f.adError),r.on("adPlay",f.adPlay),r.on("adRequest",f.adRequest),r.on("adSkipped",f.adSkipped),r.on("adStarted",f.adStarted),r.on("adTime",f.adTime),r.on("autostartNotAllowed",f.autostartNotAllowed),r.on("beforeComplete",f.beforeComplete),r.on("buffer",f.buffer),r.on("error",f.error(i)),r.on("idle",f.idle),r.on("metadataCueParsed",f.metadataCueParsed),r.on("pause",f.pause),r.on("play",f.play),r.on("playAttemptFailed",f.playAttemptFailed),r.on("time",f.time),r.on("adsManager",f.adsManager),r.once("ready",f.ready),r.once("setupError",f.setupError),globalThis.window.document.addEventListener("visibilitychange",P.visibilitychangeHandler)},load:h=>{r.off("beforePlay",f.beforePlay),r.once("beforePlay",f.beforePlay),m(h)},loadAdXml(h,{xmlDoc:w}){r.loadAdXml(new XMLSerializer().serializeToString(w.documentElement))},next(h){N(h)||(m(h),r.play())},pause(){r.pause()},pauseAd(h){r.pauseAd(h)},play(h){switch(h){case O.Idle:{r.stop();break}case O.Paused:{r.pause();break}case O.Restart:{r.seek(0),t.play();break}default:{r.play();break}}},playAd(h){r.playAd(h)},previous(h){N(h)||(m(h),r.play())},rewind:p,seek:p,setMute(h){r.setMute(h)},setSpeed(h){r.setPlaybackRate(h)},setVolume(h){r.setMute(h===0),r.setVolume(h)},stop(){const{queue:h,index:w,station:b}=t.getState().deserialize(),k=h[w].meta;b?.type===_.Live&&(a.set(re,()=>y({streamId:Number(b?.id),stationMeta:k}),5e3),c=!1),r.stop()}})}function rl(t){return W({initialize(){document.addEventListener("keydown",s=>{if(s.target!==document.body||!Object.values(he).includes(s.key)||s.key!==he.Space&&!s.metaKey)return;s.preventDefault();const i=t.getState().get("volume");switch(s.key){case he.ArrowDown:{if(s.shiftKey){t.setVolume(0);break}t.setVolume(Math.max(0,i-10));break}case he.ArrowLeft:{if(s.shiftKey){t.rewind(15);break}t.previous();break}case he.ArrowRight:{if(s.shiftKey){t.fastForward(30);break}t.next();break}case he.ArrowUp:{if(s.shiftKey){t.setVolume(100);break}t.setVolume(Math.min(100,i+10));break}case he.M:{t.setMute();break}case he.S:{t.setShuffle();break}case he.Space:{t.play();break}}})}})}function Re(t,e){return{all(i,a,...n){const o=`${t}.${i}(`,r=n.map(y=>$e(y)||Et(y)||ns(y)?is(y):JSON.stringify(y)).join(", "),l=`) => ${$e(a)||Et(a)||ns(a)?is(a):a===void 0?"void":JSON.stringify(a)}`,c=[o,r,l].join("");if(c.toLowerCase().includes("time"))return;const u=c.toLowerCase().includes("error")?"error":"log";e[u](c,{arguments:n,method:i,result:a})}}}function ol({player:t,resolvers:e}){function s({index:a,queue:n,station:o}){if(N(navigator.mediaSession)||N(o))return;const r=n[a],l=r.type===C.Episode,c=r.type===C.Stream,u=e[o.type];navigator.mediaSession.setActionHandler("play",()=>t.play()),c?navigator.mediaSession.setActionHandler("stop",()=>t.stop):(navigator.mediaSession.setActionHandler("pause",t.pause),u.next!==void 0&&navigator.mediaSession.setActionHandler("nexttrack",()=>t.next(!1)),u.previous!==void 0&&navigator.mediaSession.setActionHandler("previoustrack",()=>t.previous(!1)),l&&(navigator.mediaSession.setActionHandler("seekbackward",()=>t.rewind(15)),navigator.mediaSession.setActionHandler("seekforward",()=>t.fastForward(30))))}return W({initialize:s,load:s,setMetadata(a){if(N(navigator.mediaSession)||N(a))return null;navigator.mediaSession.metadata=new MediaMetadata({album:a.data.subtitle,artist:a.data.description,title:a.data.title,artwork:[{src:a.data.image??""}]})}})}function ll({api:t,resolvers:e,state:s}){const i=Ee({elapsed:0,endReason:null,fetchedSkips:!1,previousPosition:0,report15Reported:!1,startReported:!1});function a({previousStation:r,currentStation:l}){return j(r)&&j(l)?lt(os(r,["id","type"]),os(l,["id","type"])):!1}function n({item:r,lastItem:l}){return N(l)?!1:lt(Je(r,["starttime","url"]),Je(l,["starttime","url"]))}return[W({async load(r,l){const{history:c}=s.deserialize(),u=c.at(-1)?.station;a({currentStation:l,previousStation:u})||i.serialize(i.seed)},async next(r,l){const{index:c,shuffled:u,station:y,queue:g}=s.deserialize(),m=c>0?g[c-1]:g.length>1?g.at(-1):null;if(i.get("startReported")&&j(y)&&j(m)&&[C.Track,C.Episode].includes(m.type)){i.set("endReason",l?"DONE":"SKIP"),i.set("startReported",!1);const{daySkipsRemaining:d,hourSkipsRemaining:p}=await t.api.v3.playback.postReporting({body:{modes:u&&j(e[y.type].setShuffle)?["SHUFFLED"]:[],offline:!1,playedDate:Date.now(),replay:!1,reportPayload:m.reporting,secondsPlayed:Math.round(i.get("elapsed")),stationId:String(y.id),status:l?"DONE":"SKIP"}}).then(J("body"));s.set("skips",Math.max(0,Math.min(p,d)))}},play(){const{history:r,index:l,queue:c,shuffled:u,station:y}=s.deserialize(),g=r.at(-2),m=g?.station,d=c[l],p=g?.item;if(j(d)&&j(y)&&[C.Track,C.Episode,C.Stream].includes(d.type)){if(d.type===C.Stream&&!n({item:d,lastItem:p})){t.api.v3.playback.postLiveStationReporting({body:{stationId:String(y.id),playedFrom:y.context.playedFrom,stationType:y.type}});return}j(m)&&!a({currentStation:y,previousStation:m})&&!i.get("startReported")&&j(p?.reporting)&&!n({item:d,lastItem:p})?(i.set("endReason","STATIONCHANGE"),t.api.v3.playback.postReporting({body:{modes:u&&j(e[m?.type].setShuffle)?["SHUFFLED"]:[],offline:!1,playedDate:Date.now(),replay:!1,reportPayload:p.reporting,secondsPlayed:Math.round(i.get("elapsed")),stationId:String(m.id),status:"STATIONCHANGE"}}),i.set("elapsed",0)):i.set("endReason",null),i.get("startReported")||(i.set("report15Reported",!1),i.set("elapsed",0),t.api.v3.playback.postReporting({body:{modes:u&&j(y?.type)&&j(e[y.type].setShuffle)?["SHUFFLED"]:[],offline:!1,playedDate:Date.now(),replay:!1,reportPayload:d.reporting,secondsPlayed:0,stationId:String(y?.id),status:"START"}}).then(f=>(s.set("skips",Math.max(0,Math.min(f?.body?.hourSkipsRemaining,f?.body?.daySkipsRemaining))),i.set("startReported",!0))).catch(f=>console.error("Failed to update royalty reporting",f)))}},seek(r){i.set("previousPosition",r)},async setTime({time:r}){const{index:l,shuffled:c,station:u,queue:y}=s.deserialize(),g=y[l],m=i.get("elapsed")+(r.position-i.get("previousPosition"));i.set("elapsed",m),i.set("previousPosition",r.position),i.get("startReported")&&!i.get("report15Reported")&&m>=15&&j(u)&&j(g)&&[C.Track,C.Episode].includes(g.type)&&(i.set("report15Reported",!0),t.api.v3.playback.postReporting({body:{modes:c&&j(e[u.type].setShuffle)?["SHUFFLED"]:[],offline:!1,playedDate:Date.now(),replay:!1,reportPayload:g.reporting,secondsPlayed:Math.round(m),stationId:String(u.id),status:"REPORT_15"}}))}}),i]}function cl(){if(globalThis.window===void 0)return!1;const t=new URL(window.location.href).searchParams.get("debug");return t?t.includes("true")||t.includes("playback"):!1}const Ft=U.createContext(null);function dl(){return U.use(Ft)}const Mt=U.createContext(null);function ul(){const t=U.use(Mt);return mt(t,"useAdsContext() must be used within AdsContext"),t}const zt=U.createContext(null);function pl(){return U.use(zt)}const jt=U.createContext(null);function ml(){const t=U.use(jt);return mt(t,"usePlaybackMessagesContext() must be used within MessagesContext"),t}const Lt=U.createContext(null);function fl(){const t=U.use(Lt);return mt(t,"usePlaybackState() must be used within StateContext"),t}const qt=U.createContext(null);function hl(){const t=U.use(qt);return mt(t,"usePlaybackTime() must be used within TimeContext"),t}function gl({analytics:t={},api:e,debug:s=cl(),logger:i=ee,resolvers:a}){const{player:n,errorCounter:o}=yo({api:e,logger:i,resolvers:a}),r=n.getAds(),l=n.getState(),c=n.getTime(),u=n.getMessages(),y=n.getFeatures(),g=al(n,e,i,o),m=rl(n),d=ol({player:n,resolvers:a}),[p]=ll({api:e,resolvers:a,state:l}),[f]=Zo({api:e,state:l,timeState:c,analytics:t,ads:r});if(n.subscribe(g),n.subscribe(m),n.subscribe(d),n.subscribe(p),n.subscribe(f),s){i.enable(),n.subscribe(Re("player",i)),g.subscribe(Re("player:subscription:jw-player",i)),m.subscribe(Re("player:subscription:keyboard-controls",i)),d.subscribe(Re("player:subscription:media-session",i)),p.subscribe(Re("player:subscription:royalty-reporting",i)),f.subscribe(Re("player:subscription:analytics",i)),r.subscribe({set(A,T,P){const E=`ads:subscription.set(${T}) => `,M=JSON.stringify(P),H=[E,M].join(""),B=H.toLowerCase().includes("error")?"error":"log";i[B](H,{arguments:M})}});for(const[A,T]of Object.entries(a))T.subscribe(Re(`player:resolver:${A}`,i))}else i.disable();const{errors:v,metadata:h,time:w,...b}=l.deserialize(),k={playbackBufferTimeout:7e3};function S({children:A,adsEnabled:T=!0,apiConfig:P,dfpInstanceId:E,environment:M="prod",featureFlags:H=k,pageName:B="home",subscriptionType:K="free",lsid:se="",anID:Ie=0}){const[Ve,wt]=U.useState(h),[Ri,bt]=U.useState(()=>r.deserialize()),[ts,St]=U.useState(()=>b),[xt,st]=U.useState(null),[ss,Xe]=U.useState(()=>c.deserialize().time),[Ci,_t]=U.useState(()=>u.deserialize());return U.useEffect(()=>{e.setConfig(P)},[P]),U.useEffect(()=>{y.serialize({...y.deserialize(),...H})},[H]),U.useEffect(()=>{r.serialize({...r.deserialize(),dfpInstanceId:E,env:M,enabled:T,subscriptionType:K,anID:Ie})},[E,M,T,K,Ie]),U.useEffect(()=>l.subscribe({serialize(fe,{errors:Z,metadata:ie,...Qe}){if(Et(Z)){const[nt]=Z.slice(-1);nt instanceof Error&&st([nt])}$e(ie)&&wt(ie),St(nt=>({...nt,...Qe}))},set(fe,Z,ie){switch(Z){case"errors":{Array.isArray(ie)&&st(ie.slice(-1));break}case"metadata":{wt(ie);break}case"time":{Xe(ie);break}default:{St(Qe=>({...Qe,[Z]:ie}));break}}}}),[st,wt,St,Xe,ts]),U.useEffect(()=>{l.serialize({...l.deserialize(),pageName:B,lsid:se,featureFlags:H})},[B,se,H]),U.useEffect(()=>r.subscribe({serialize(fe,Z){bt(ie=>({...ie,...Z}))},set(fe,Z,ie){bt(Qe=>({...Qe,[Z]:ie}))}}),[bt]),U.useEffect(()=>c.subscribe({serialize(fe,{time:Z}){$e(Z)&&Xe(Z)},set(fe,Z,ie){Xe(ie)}}),[ss,Xe]),U.useEffect(()=>u.subscribe({serialize(it,{messages:fe}){fe&&_t({messages:fe})},set(it,fe,Z){fe==="messages"&&Array.isArray(Z)&&_t({[fe]:Z})}}),[_t]),U.useEffect(()=>{N(xt)||st(null)},[xt]),_e.jsx(zt,{value:xt,children:_e.jsx(Lt,{value:ts,children:_e.jsx(Mt,{value:Ri,children:_e.jsx(qt,{value:ss,children:_e.jsx(Ft,{value:Ve,children:_e.jsx(jt,{value:Ci,children:A})})})})})})}return{PlaybackProvider:S,AdsContext:Mt,ErrorContext:zt,MessagesContext:jt,MetadataContext:Ft,player:n,StateContext:Lt,TimeContext:qt,useAds(){const A=ul();return U.useMemo(()=>({...A,adBreak:{[R.Buffering]:!0,[R.Paused]:!0,[R.Playing]:!0,[R.Streaming]:!0,[R.Done]:!1,[R.Idle]:!1}[A.status]}),[A])},useError(){return pl()},useMessage(){return ml()},useMetadata(){return dl()},usePlayer(){return n},useState(){return fl()},useTime(){return hl()},useMarkEpisodeAsPlayed(){return({action:A,episodeId:T})=>{const P=n.getState(),{queue:E,metadata:M}=P.deserialize();if(E&&!ne(E)){const H=E.find(B=>B.id===T);H&&M&&(A===$n?(H.meta.completed=!0,M.data.completed=!0):(H.meta.completed=!1,M.data.completed=!1),P.set("queue",E),P.set("metadata",M))}}}}}const{PlaybackProvider:Il,...Al}=gl({api:Mi,resolvers:Ko,analytics:$i});function Pl(t){return _e.jsx(Ui,{"aria-label":"Chevron Right",...t,children:_e.jsx("svg",{viewBox:"0 0 24 24",children:_e.jsx("path",{d:"M8.7743 6.3157c-.41912.41912-.41912 1.09616 0 1.51527l4.1697 4.16973-4.1697 4.1697c-.41912.4191-.41912 1.0961 0 1.5153.41912.4191 1.09616.4191 1.5153 0l4.9327-4.9328c.4191-.4191.4191-1.0961 0-1.5152l-4.9327-4.93275c-.40839-.40837-1.09618-.40837-1.5153.01075Z"})})})}function El(){const t=Vi();return{onItemSelected:U.useCallback(({action:s=ue.enum.ItemSelected,assets:i,contentId:a,contentTitle:n,context:o,globalStation:r,itemPosition:l,location:c,pageName:u,row:y=0,section:g,sectionPosition:m,tab:d,sectionId:p,tag:f})=>{t.track({type:ue.enum.ItemSelected,data:{action:s,...typeof i?.asset?.id=="string"?{station:{asset:{...i.asset,id:i.asset.id}}}:{},item:{asset:{...i.asset.id||"subid"in i.asset?{id:"subid"in i.asset&&i.asset.subid?i.asset.subid.toString():i.asset.id?.split("|")[1]}:{},name:"subname"in i.asset&&i.asset.subname?i.asset.subname:i.asset.name}},event:{location:c??`${u}|${g}|${o}`,type:o},view:{pageName:ls(u),sectionPosition:m,itemPosition:l,item:{column:l,row:y},section:{name:g,...p?{id:p}:{},...f?{tag:f}:{}},...d?{tab:ls(d)}:{},...a||n?{content:{id:a,title:n}}:{},...r?{station:{asset:r}}:{}}}})},[t])}}export{Se as A,ds as B,Pl as C,No as D,sn as E,us as F,Il as G,he as K,z as M,L as P,ve as Q,je as R,_ as S,Ue as V,an as a,O as b,Ee as c,de as d,ke as e,R as f,Le as g,X as h,Bt as i,qn as j,$n as k,kl as l,D as m,Yi as n,Nn as o,Al as p,C as q,Wt as r,ft as s,yo as t,El as u,gl as v,Fo as w,Ko as x,$s as y,nn as z};
//# sourceMappingURL=use-item-selected-BbUZv3TT.js.map
