import{j as E}from"./create-logger-DNtzi1_a.js";import{k as G,r as w}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{h as J}from"./amp-client-C2ZZL0mA.js";import{u as V}from"./http-error-DJhpcL-Y.js";import{M as F}from"./use-item-selected-BbUZv3TT.js";import{r as B,l as Q,v as U}from"./text-CLqYBJ6O.js";function X(...r){return V(Y,r)}var Y=(r,{min:o,max:n})=>o!==void 0&&r<o?o:n!==void 0&&r>n?n:r,C={},z;function Z(){if(z)return C;z=1;const r=/\s*([^,]\S*[^,](?:\s+[^,]+)?)\s*(?:,|$)/,o=(e,t,a)=>{if(e[a]=e[a]||{},e[a][t])throw new Error(`No more than one image candidate is allowed for a given descriptor: ${t}${a}`);e[a][t]=!0},n=e=>{if(e.fallback)throw new Error("Only one fallback image candidate is allowed");if(e.x[1])throw new Error("A fallback image is equivalent to a 1x descriptor, providing both is invalid.");e.fallback=!0},h=(e,t)=>{if(t.length===0)n(e);else if(t.length>1)throw new Error(`Image candidate may have no more than one descriptor, found ${t.length}: ${t.join(" ")}`)},c=(e,t,a)=>{if(Number.isNaN(e))throw new TypeError(`${a||e} is not a valid number`);switch(t){case"w":{if(e<=0)throw new Error("Width descriptor must be greater than zero");if(!Number.isInteger(e))throw new TypeError("Width descriptor must be an integer");break}case"x":{if(e<=0)throw new Error("Pixel density descriptor must be greater than zero");break}case"h":throw new Error("Height descriptor is no longer allowed");default:throw new Error(`Invalid srcset descriptor: ${a}`)}};C.parse=(e,{strict:t=!1}={})=>{const a=t?{}:void 0;return e.split(r).filter((s,u)=>u%2===1).map(s=>{const[u,...y]=s.trim().split(/\s+/),l={url:u};t&&h(a,y);for(const g of y){const i=g[g.length-1],f=Number.parseFloat(g.slice(0,-1));switch(t&&(c(f,i,g),o(a,f,i)),i){case"w":{l.width=f;break}case"h":{l.height=f;break}case"x":{l.density=f;break}}}return l})};const d=new Set(["width","height","density"]);return C.stringify=(e,{strict:t=!1}={})=>{const a=t?{}:null;return e.map(s=>{if(!s.url){if(t)throw new Error("URL is required");return""}const u=Object.keys(s).filter(l=>d.has(l));t&&h(a,u);const y=[s.url];for(const l of u){const g=s[l];let i;switch(l){case"width":{i="w";break}case"height":{i="h";break}case"density":{i="x";break}}const f=`${g}${i}`;t&&(c(g,i),o(a,g,i)),y.push(f)}return y.join(" ")}).join(", ")},C}var ee=Z();const te=G(ee),re=Object.freeze({Center:"center",North:"north",Northeast:"northeast",East:"east",Southeast:"southeast",South:"south",Southwest:"southwest",West:"west",Northwest:"northwest"}),se=(r,o)=>{switch(o.type){case"LOADED":return{...r,status:"loaded"};case"SUCCEEDED":return{...r,status:"loaded",width:o.payload.width,height:o.payload.height};case"FAILED":return{...r,status:"failed"};default:throw new TypeError("Unknown useImageReducer action type")}},ae=(r,o)=>{const{width:n=0,height:h=0}=o,[c,d]=w.useReducer(se,{width:n,height:h,status:"pending"}),e=w.useCallback(s=>{d({type:"SUCCEEDED",payload:{height:s.currentTarget.height,width:s.currentTarget.width}})},[]),t=w.useCallback(()=>{d({type:"FAILED"})},[]);return w.useEffect(()=>{c.status==="pending"&&r.current?.complete&&d({type:"SUCCEEDED",payload:{height:r.current.height,width:r.current.width}})},[r,c.status]),w.useMemo(()=>({status:c.status,height:c.height,width:c.width,onLoad:e,onError:t}),[c.status,c.height,c.width,e,t])};function _(r){return J(r)?Number(Math.floor(r).toFixed(0)):0}function oe({aspectRatio:r="1 / 1",cacheable:o=!1,density:n=1,format:h,gravity:c,height:d,quality:e,src:t,width:a}){const s=F.fromURL(t);o&&(s.cacheable=o),s.hasOp("gravity")||s.gravity(c),s.hasOp("format")||s.format(h),s.hasOp("quality")||s.quality(e);const u=_(a)*n,y=_(d)*n;if((u>0||y>0)&&(s.removeOps("fit"),s.fit(u,y)),!s.hasOp("ratio")){const[l,g]=r.split("/").reduce((i,f)=>[...i,f.trim()],[]);s.ratio(Number(l),Number(g))}return s.toString()}function ie(r){const{src:o,format:n,width:h}=r;return F.fromURL(o).format(n).quality(1).fit(X((h??200)*.5,{min:1,max:100}),0).toString()}class D extends TypeError{constructor(o){super(o)}}const ne=w.memo(function(o){let{alt:n,cacheable:h=!1,className:c,classNames:d,decoding:e="async",densities:t,format:a="webp",debugPlaceholder:s,gravity:u=re.Center,height:y,resolver:l=oe,loading:g="lazy",placeholder:i=!0,placeholderResolver:f=ie,quality:N=75,sizes:j,style:x,src:R,widths:k,width:W,aspectRatio:v,srcSet:L,...O}=o;const M=w.useRef(null),I=w.useRef(null),{height:m,status:$,width:p,onError:T,onLoad:q}=ae(I,{height:y,width:W});p&&m&&!v&&(v=`${Number(Number(p/m).toFixed(2))} / ${m/m}`);try{if(t&&t.length>0&&k&&k.length>0)throw new D('cannot specify both "densities" and "widths"');if(k&&k.length>0&&!j)throw new D('if declaring "widths", "sizes" must also be declared');const b=i&&typeof i=="string"?i:i===!0?f({aspectRatio:v,cacheable:h,density:1,format:a,gravity:u,height:m,quality:N,src:R,width:p}):null,H=b!==null||w.isValidElement(i),A=l({aspectRatio:v,cacheable:h,density:1,format:a,gravity:u,height:m,quality:N,src:R,width:p}),K=k&&k.length>0?[...k,p].sort().map(S=>({url:l({aspectRatio:v,cacheable:h,density:1,format:a,gravity:u,height:0,quality:N,src:R,width:S}),width:S})):(t??[1,2]).sort().map(S=>({url:l({aspectRatio:v,cacheable:h,density:S,format:a,gravity:u,height:m,quality:N,src:R,width:p}),density:S})),P=te.stringify(K);return H?E.jsxs("div",{className:d?.wrapper??c,"data-status":$,"data-test":"web.assets.image-wrapper",ref:M,style:{...x,display:"grid",gridTemplateAreas:'"img-container"',gridTemplateColumns:"1fr",gridTemplateRows:"auto"},children:[b?E.jsx("img",{alt:`${n} (thumbnail)`,className:d?.placeholder,"data-test":"web.assests.image-placeholder",decoding:"sync",loading:"eager",src:b,...m>0?{height:m}:{},...p>0?{width:p}:{},style:{...x,aspectRatio:"inherit",gridArea:"img-container",opacity:$!=="loaded"||s?1:0,transition:"opacity 0.3s",zIndex:-1,height:"100%",width:"100%"}}):i,E.jsx("img",{decoding:e,loading:g,...O,alt:n,className:d?.image,"data-test":"web.assets.image",onError:T,onLoad:q,ref:I,sizes:j,src:A,srcSet:L??P,style:{...x,aspectRatio:"inherit",gridArea:"img-container",opacity:$==="loaded"&&!s?1:0,transition:"opacity 0.3s",height:"100%",width:"100%"},...m>0?{height:m}:{},...p>0?{width:p}:{}})]}):E.jsx("img",{decoding:e,loading:g,...O,alt:n,className:d?.image,"data-test":"web.assets.image",onError:T,onLoad:q,ref:I,sizes:j,src:A,srcSet:L??P,style:x,...m>0?{height:m}:{},...p>0?{width:p}:{}})}catch(b){if(b instanceof D)throw new TypeError(b.message);return console.warn(b instanceof Error?b.message:JSON.stringify(b)),null}});var ce="_1ko5y2r0",he="_1ko5y2r1",le="_1ko5y2r2",de="_1ko5y2r4",ue="_1ko5y2r5";const ge=w.memo(function(o){const{aspectRatio:n,backgroundColor:h,css:c,...d}=o,{className:e,style:t}=B({aspectRatio:n,backgroundColor:h??Q(U.color.brandWhite,U.color.gray600),...c}),a={wrapper:[ce,e].join(" "),placeholder:[le,e].join(" "),image:[he,e].join(" ")};return E.jsx(ne,{classNames:a,style:t,...d})});ge.displayName="Image";const me=({children:r})=>E.jsx("div",{className:de,"data-test":"web.accomplice.Image-Loader",children:r});w.cloneElement(E.jsx(me,{}),void 0,E.jsx("div",{className:ue,"data-test":"web.accomplice.Image-Loader.Spinner"}));export{ge as I,ne as a,te as s,X as u};
//# sourceMappingURL=image-DSV20kzL.js.map
