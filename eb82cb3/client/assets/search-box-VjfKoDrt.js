import{a as R,j as g,v as C}from"./create-logger-DNtzi1_a.js";import{F as j,v as P}from"./text-CLqYBJ6O.js";import{S as T}from"./search-field-D2g1DS8T.js";import{a as F}from"./use-item-selected-BbUZv3TT.js";import{d as O,u as $,a as z,f as H,e as L,g as M,b as A,r as l}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{l as S}from"./http-error-DJhpcL-Y.js";import{$ as B}from"./index-B6aK0ntB.js";import{u as G,s as Q}from"./search-session-DBo5uf6q.js";import{u as U,s as W}from"./schemas-MQcYzkYq.js";import{u as _}from"./amp-client-C2ZZL0mA.js";import{u as J}from"./play-BQDnmloD.js";import{a as N,e as b}from"./create-analytics-DYSkN0SF.js";import{R as m}from"./request-info-Bv3SWXDS.js";function K(s){N.track({type:b.enum.Search,data:{...s.station&&{station:s.station},search:s.search}})}function V(s){N.track({type:b.enum.SearchSuccess,data:s})}function X({filter:s,index:c=0,queryId:o,searchTerm:i,sessionId:e,station:r,exitType:a=b.enum.ItemSelected}){K({search:{screen:"search",userSearchTerm:i,selectionCategory:s,queryId:o??"",selectionCategoryPosition:c,exitType:a,sessionId:e},...r&&{station:r}})}function me({filter:s,queryId:c,searchTerm:o,sessionId:i,station:e,type:r,section:a,row:n}){V({search:{sessionId:i,searchTerm:o,queryId:c},view:{pageName:"search",section:{name:a},filter:{name:s},item:{row:n,column:0}},event:{type:"search_bar"},asset:{type:r},station:{asset:{id:e.asset.id,name:e.asset.name,...e?.asset?.sub?{sub:{...e.asset.sub.id?{id:e.asset.sub.id}:{},...e.asset.sub.name?{name:e.asset.sub.name}:{}}}:{}}}})}const Y=F(({value:s,setSearchParams:c,state:o,anon:i})=>{c(e=>(s?(e.set("q",s),i&&e.set("a","1")):(e.delete("a"),e.delete("q"),e.delete("filter")),e),{replace:!0,state:o})},{timing:"trailing",waitMs:500});function fe(){const s=R.c(2),c=O();let o;e:{for(const a of c)if(a.handle&&a.handle.hideGlobalSearch===!0){o=!0;break e}o=!1}const e=!o;let r;return s[0]!==e?(r=g.jsx(Z,{showSearch:e}),s[0]=e,s[1]=r):r=s[1],r}function Z({showSearch:s}){const{filter:c,queryId:o,searchTerm:i}=$(),e=z(),{isAnonymous:r=!0}=_()??{},a=G(),n=H(),[p,y]=L(),t=M(),f=A(),k=l.useMemo(()=>t.state==="loading"&&t.location.pathname===n.pathname&&t.location.pathname==="/search"&&t.location.search!==n.search,[n.pathname,n.search,t.location?.pathname,t.location?.search,t.state]),[w,d]=l.useState(p.get("q")??i),v=l.useCallback(h=>{n.pathname===m.Search&&Y.call({value:h,setSearchParams:y,state:n.state,anon:r})},[n.pathname,n.state,y,r]),E=l.useCallback(h=>{d(h),v(h)},[v]),u=J(),I=l.useRef(null);l.useEffect(()=>{t.location?.pathname===m.Search&&S(t.location.state)&&t.location.state.searchOpen?a.set("open",!0):S(t.location)&&S(t.location.state?.searchSessionId)&&a.set("sessionId",t.location.state.searchSessionId)},[t.location,a]),l.useEffect(()=>{f==="POP"&&d(p.get("q")??"")},[f,p]),U(m.Search,()=>{x("Close"),d(""),I.current?.blur(),a.serialize({open:!1,start:!1,sessionId:C()})},a.get("open")||f==="POP"||f==="PUSH");const x=l.useCallback(h=>X({filter:c,index:0,queryId:o,searchTerm:i,exitType:h,sessionId:a.get("sessionId")}),[c,o,i,a]),q=l.useCallback(()=>{if(!a.get("open")){const h=C();a.serialize({...a.deserialize(),open:!0,sessionId:h}),Q({search:{sessionId:h},view:{pageName:u==="/"?"home":u},event:{location:"header"}})}a.get("sessionId")&&!a.get("start")&&(a.set("start",!0),W({search:{sessionId:a.get("sessionId")},view:{pageName:u==="/"?"home":u},event:{type:"search_bar",action:"click"}})),n.pathname!==m.Search&&e(B(m.Search),{state:{prevPage:n.pathname,searchSessionId:a.get("sessionId")}})},[n.pathname,e,u,a]);return g.jsx(j,{alignItems:"center",direction:"row",flexShrink:1,gap:"$32",justifyContent:s?"flex-start":"flex-end",marginRight:P.space[16],width:"100%",children:g.jsx(T,{"aria-label":"Search",isLoading:k,name:"q",onChange:E,onClear:()=>x("Clear"),onFocus:q,placeholder:"What do you want to listen to?",ref:I,value:w})})}export{fe as S,me as a,X as f};
//# sourceMappingURL=search-box-VjfKoDrt.js.map
