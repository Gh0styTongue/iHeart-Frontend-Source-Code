import{j as h,a as I}from"./create-logger-DNtzi1_a.js";import{c as N,e as L}from"./amp-client-C2ZZL0mA.js";import{a as p}from"./play-BQDnmloD.js";import{r as f}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{p as b}from"./slugify-CmQ1Aov3.js";import{e as _,M as S}from"./use-item-selected-BbUZv3TT.js";import{r as j,l as R}from"./http-error-DJhpcL-Y.js";import{v,f as O}from"./request-info-Bv3SWXDS.js";import{$}from"./useListData-CNxJNYqp.js";import{I as z}from"./text-CLqYBJ6O.js";import{u as M,e as k}from"./create-analytics-DYSkN0SF.js";const g=_({type:"local",seed:{},prefix:"ihr:presets"}),V={ARTIST:"artist",COLLECTION:"playlist",FAVORITES:"station",LIVE:"station",PODCAST:"podcast"},X=({isInDrawer:e,isOpen:t})=>t?v.NOW_PLAYING:e?v.MINI_PLAYER:v.PRESETS_MENU,ee=e=>j(e)&&R(e.analytics),x=(e,t)=>{Array.from({length:15},(r,s)=>s).map(r=>g.remove(String(r))),g.serialize(e,t)};function F({id:e,title:t,type:r,position:s}){const a=g.deserialize(),i=Object.keys(a);if(i.length===15)return p({kind:"error",text:`Your presets are full. Remove one to add this ${V[r]}`}),{success:!1};if(Object.values(a).find(o=>o.id===e&&o.type===r))return p({kind:"info",text:`${t} has already been added to your presets`}),{success:!1};if(s){if(s&&!i.includes(s))return x({...a,[String(s)]:{id:e,type:r,title:t}},()=>p({kind:"success",text:`${t} added to presets`})),{success:!0};if(s&&i.includes(s))return p({kind:"error",text:`There was an issue adding ${t} to your presets. Please try again`}),{success:!1}}else{const o=Array.from({length:15},(n,u)=>u).find((n,u)=>!i.includes(String(u)));if(o!==void 0)return x({...a,[String(o)]:{id:e,type:r,title:t}},()=>p({kind:"success",text:`${t} added to presets`})),{success:!0,index:o}}return{success:!1}}function te({analyticsCallback:e,id:t,imageUrl:r,position:s,presetListData:a,title:i,type:c}){const{success:d,index:o}=F({id:t,title:i,type:c,position:s}),n=s?Number.parseInt(s):o;d&&(a.remove(n),a.insert(n,{id:t,index:String(n),type:c,title:i,imageUrl:r}),e?.())}function U({title:e,position:t}){const r=g.deserialize();return Object.keys(r).includes(String(t))?(delete r[t],x(r,()=>p({kind:"success",text:`${e} removed from presets`})),{success:!0}):(p({kind:"error",text:`There was an issue removing ${e} from your presets. Please try again.`}),{success:!1})}function se({analyticsCallback:e,id:t,position:r,presetListData:s,title:a}){const{success:i}=U({title:a,position:r});i&&(s.remove(t),s.insert(Number.parseInt(r),{id:Number(r),index:r}),e?.())}function re({presetData:e,movedId:t,newPosition:r,oldPosition:s}){const a={},i=[...e.items].filter(d=>d.id!==t),c=e.items[Number(s)];i.splice(r,0,c);for(const[d,o]of i.entries()){const n=String(d);o?.imageUrl&&(a[n]={...o,index:n}),o?.id&&e.update(o.id,{...o,index:n})}x(a)}const ne=({id:e,type:t,imageUrl:r})=>t?t!=="COLLECTION"?S.fromCatalog({id:String(e),type:t.toLowerCase()}).ratio(1,1).resize(150).toString():r?S.fromURL(r).ratio(1,1).resize(150).toString():`${O}?ops=gravity("center"),ratio(1,1)`:void 0,w=e=>Array.from({length:15},(t,r)=>{const s=String(r);return e?.[s]?{...e[s],index:s}:{id:Number(s),index:s}}),C=f.createContext({presetListData:[],hasFetchedPresets:!1,presetsLength:0});function ae(){const e=f.useContext(C);return N(e,"'usePresetsContext()' must be used within PresetsProvider"),e}const oe=({children:e})=>{const t=$({initialItems:w()}),r=f.useRef(!1),s=L(),[a,i]=f.useState(!1),c=f.useCallback(async()=>await s.api.v3.profiles.getPresets().then(b("body")).then(b("presets")).then(n=>{if(n){const u=w(n);x(n);for(const[m,l]of t.items.entries())l.id!==u[m].id&&t.update(l.id,u[m])}return i(!0),n}).catch(()=>(console.warn("Failed to fetch presets"),null)),[s.api.v3.profiles,t]),d=f.useCallback(async({presets:n})=>await s.api.v3.profiles.putPresets({body:{presets:n}}).then(u=>u.body).catch(()=>(console.warn("Failed to put presets"),null)),[s.api.v3.profiles]);f.useEffect(()=>{!r.current&&s.hasCredentials&&c()},[c,s.hasCredentials]),f.useEffect(()=>g.subscribe({serialize:async(n,u,m)=>{const l=Object.entries(u).reduce((P,[T,y])=>{if(y){const{id:E,type:A}=y;return{...P,[T]:{id:E,type:A}}}else return P},{});try{r.current&&await d({presets:l}),r.current=!0,m?.()}catch{p({kind:"warning",title:"Oops!",text:"Your presets are saved to the browser, but we failed to synchronize them to the server. This data may be lost in future sessions."})}}}),[s,c,d,t]);const o=f.useMemo(()=>({presetListData:t,hasFetchedPresets:a,presetsLength:t.items.filter(n=>"imageUrl"in n).length}),[t,a]);return h.jsx(C.Provider,{value:o,children:e})};function ie(e){return h.jsx(z,{"aria-label":"Preset",...e,children:h.jsxs("svg",{viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("path",{d:"M3 4.5C3 3.67157 3.67157 3 4.5 3H8V8.00023H3V4.5Z"}),h.jsx("path",{d:"m9.9998 3h3.5c0.8284 0 1.5 0.67157 1.5 1.5v3.5002h-5v-5.0002z"}),h.jsx("path",{d:"m3 10h5v5.0002h-3.5c-0.82843 0-1.5-0.6716-1.5-1.5v-3.5002z"}),h.jsx("path",{d:"m9.9998 10h5v3.5002c0 0.8284-0.6716 1.5-1.5 1.5h-3.5v-5.0002z"})]})})}function ce(){const e=I.c(7),t=M();let r;e[0]!==t?(r=d=>{const{pageName:o,location:n,station:u,item:m,globalStation:l}=d;t.track({type:k.enum.PresetAdded,data:{view:{pageName:o,...l?{station:{asset:l}}:{}},event:{location:n},station:{asset:u},item:{asset:m}}})},e[0]=t,e[1]=r):r=e[1];const s=r;let a;e[2]!==t?(a=d=>{const{pageName:o,location:n,station:u,item:m,globalStation:l}=d;t.track({type:k.enum.PresetRemoved,data:{view:{pageName:o,...l?{station:{asset:l}}:{}},event:{location:n},station:{asset:u},item:{asset:m}}})},e[2]=t,e[3]=a):a=e[3];const i=a;let c;return e[4]!==s||e[5]!==i?(c={trackAddPreset:s,trackRemovePreset:i},e[4]=s,e[5]=i,e[6]=c):c=e[6],c}export{V as C,ie as P,ae as a,te as b,X as c,se as d,oe as e,ne as g,ee as h,re as m,ce as u};
//# sourceMappingURL=track-presets-D7gwFWnr.js.map
