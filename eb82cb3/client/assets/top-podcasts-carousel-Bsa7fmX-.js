import{a as A,j as b}from"./create-logger-DNtzi1_a.js";import{a as K}from"./select-field-D0C0OudW.js";import{u as $,M as Y,S as E}from"./use-item-selected-BbUZv3TT.js";import{u as q,e as R,r as N}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{b as F}from"./create-analytics-DYSkN0SF.js";import{l as I,b as h}from"./http-error-DJhpcL-Y.js";import{e as D,m as G,g as O,t as M}from"./amp-client-C2ZZL0mA.js";import{t as B}from"./track-click-bvirfrjt.js";import{j as _,b as Q}from"./play-DDtWrYBn.js";import{C as W,a as z}from"./card-carousel-CZ58soqk.js";import{C as H}from"./carousel-select-1oL4h9zB.js";import{a as V}from"./content-card-CR0n9yPy.js";import{R as J}from"./ranked-content-card-CfhjQS7V.js";import{m as X,h as Z,A as ee}from"./request-info-Bv3SWXDS.js";import{u as te}from"./is-mobile-BqLxbqHZ.js";import{P as v}from"./index-DKKUGGYL.js";import{u as se}from"./useQuery-BQpwwpuc.js";import{u as oe}from"./webapi-client-DOa4NTc_.js";import{l as ae}from"./use-apps-flyer-CIIIQYDX.js";import{g as ie}from"./use-query-podcast-categories-D17s7Wih.js";import{d as re}from"./urls-o6i5CSG-.js";const T="all",U="podcast-category",k="rankers-top-podcasts";async function ne({amp:n,country:e=O.Enum.US,locale:i="en-US",signal:t,time:s,category:p=T,webapiClient:a}){const y=async()=>{try{const l=await ie({country:e,locale:i,signal:t,time:s,webapiClient:a}),d=_(l?.find(c=>{const m=_(c);return m&&Number(m)===Number(p)}));return I(d)&&d!==T?{data:(await n.api.v3.podcast.getPodcastCategory({params:{id:d},query:{limit:10}}))?.body.podcasts.map(r=>({id:r.id,imageUrl:r.imageUrl,slug:r.slug,subtitle:r.subtitle,title:r.title}))??[],category:d,categories:l}:{data:(await a.request(a.queries.leads({locale:i,query:{subscription:[{tags:["collections/popular-podcasts",`countries/${e}`]}]}}))).leads.reduce((r,o)=>{if(o?.catalog?.id){const u=o.link?.urls?.web&&URL.canParse(o.link.urls.web)?new URL(o.link.urls.web).pathname:void 0,f=u?u.split("/").filter(C=>C!=="").at(-1)?.replace(`-${o.catalog.id}`,""):void 0;return[...r,{id:Number(o.catalog?.id)||0,imageUrl:o.img_uri??"",slug:f??"",subtitle:o.subtitle??"",title:o.title??""}]}return r},[]).slice(0,10),category:T,categories:l}}catch(l){return ae.error(l?.message,{error:l}),{data:[],category:T,categories:[]}}};return s===void 0?y():s(k,y)}function le({country:n=O.Enum.US,locale:e="en-US",category:i=T,time:t}){const s=oe(),p=D();return se({placeholderData:a=>a,queryKey:[n,e,k,i],queryFn:({signal:a})=>ne({amp:p,country:n,locale:e,category:i,signal:a,time:t,webapiClient:s}),staleTime:G("30m")})}const ce="All Categories",de="by-category",x="Top Podcasts";function ue(n){const e=A.c(19),{onSelectionChange:i,pageName:t,selectedCategory:s,stateKey:p,categories:a}=n,[,y]=R(),[l,d]=N.useState(!1);let c;e[0]!==a||e[1]!==t||e[2]!==s||e[3]!==i||e[4]!==y||e[5]!==p?(c=C=>{if(!h(C)&&M(C)&&C!==s?.toString()){const P=a.find(S=>_(S)===C)?.title||ce;B({pageName:t,sectionName:F(x),filterType:"category",filterSelection:P,location:"filter"}),y(S=>(S.set(U,C.toString()),S),{replace:!0,preventScrollReset:!0,state:{stateKey:p}}),i(C)}},e[0]=a,e[1]=t,e[2]=s,e[3]=i,e[4]=y,e[5]=p,e[6]=c):c=e[6];const m=c;let g;e[7]===Symbol.for("react.memo_cache_sentinel")?(g={key:T,label:"All Categories",value:T},e[7]=g):g=e[7];let r;e[8]!==a?(r=[g,...a.reduce(pe,[])],e[8]=a,e[9]=r):r=e[9];let o;e[10]!==s?(o=s?.toString(),e[10]=s,e[11]=o):o=e[11];let u;e[12]===Symbol.for("react.memo_cache_sentinel")?(u=()=>d(!1),e[12]=u):u=e[12];let f;return e[13]!==l||e[14]!==m||e[15]!==s||e[16]!==r||e[17]!==o?(f=b.jsx(H,{"aria-label":"podcast-categories","data-test":"podcast-categories",defaultSelectedKey:s,isOpen:l,items:r,name:"podcastCategories",onBlur:u,onOpenChange:d,onSelectionChange:m,sectionTitle:x,children:me},o),e[13]=l,e[14]=m,e[15]=s,e[16]=r,e[17]=o,e[18]=f):f=e[18],f}function me(n){return b.jsx(K,{textValue:n.label,children:n.label},n.key)}function pe(n,e){const i=_(e);return!h(i)&&!h(e.title)&&n.push({key:i,label:e.title,value:i}),n}function ge(n){const e=A.c(25),{pageName:i,podcast:t,index:s,sectionPosition:p}=n,{onItemSelected:a}=$(),y=te();let l;e[0]!==i?(l={pageName:i,playedFrom:1004,eventLocation:Z.CAROUSEL,sectionName:x},e[0]=i,e[1]=l):l=e[1];const d=l,c=Number(t?.id);let m;e[2]!==d||e[3]!==c?(m={id:c,context:d},e[2]=d,e[3]=c,e[4]=m):m=e[4];const{playing:g}=v.usePodcastPlay(m),r=Number(t?.id),o=t&&"slug"in t?t.slug:"";let u;e[5]!==r||e[6]!==o?(u=re({podcastId:r,slug:o}),e[5]=r,e[6]=o,e[7]=u):u=e[7];const f=u;let C;e[8]!==s||e[9]!==a||e[10]!==i||e[11]!==t.id||e[12]!==t.title||e[13]!==p?(C=()=>{a({pageName:i,section:"top_podcasts",context:ee.Carousel,itemPosition:s,sectionPosition:p,assets:{asset:{id:`${E.Podcast}|${t?.id}`,name:t?.title??"",type:E.Podcast}}})},e[8]=s,e[9]=a,e[10]=i,e[11]=t.id,e[12]=t.title,e[13]=p,e[14]=C):C=e[14];const P=C;let S;return e[15]!==d||e[16]!==s||e[17]!==y||e[18]!==P||e[19]!==g||e[20]!==t.id||e[21]!==t.slug||e[22]!==t.title||e[23]!==f?(S=t.id?b.jsx(z,{children:L=>{const{isFocused:j,isHovered:w}=L;return b.jsx(J,{isFocused:j,isHovered:w,href:f,image:b.jsx(V,{alt:t?.title??"",css:{boxShadow:"$elevation1"},decoding:s===0?"sync":"auto",index:s,src:Y.fromCatalog({type:"podcast",id:t.id}),width:y?70:140}),imageButton:b.jsx(v.Podcast,{context:d,goToNowPlaying:"onPlay",id:Number(t?.id),name:t?.title??"",onPress:P,podcastSlug:Q(t.slug,t.id),size:48}),isActive:g,linesForTitle:2,onNavigation:P,rank:s+1,title:t?.title??""})}}):null,e[15]=d,e[16]=s,e[17]=y,e[18]=P,e[19]=g,e[20]=t.id,e[21]=t.slug,e[22]=t.title,e[23]=f,e[24]=S):S=e[24],S}const $e=n=>{const e=A.c(20),{sectionPosition:i}=n,{pageName:t}=q(),[s]=R();let p;e[0]!==s?(p=s.get(U)??T,e[0]=s,e[1]=p):p=e[1];const[a,y]=N.useState(p),l=X();let d;e[2]!==l.environment.countryCode||e[3]!==l.environment.locale||e[4]!==a?(d={country:l.environment.countryCode,locale:l.environment.locale,category:a},e[2]=l.environment.countryCode,e[3]=l.environment.locale,e[4]=a,e[5]=d):d=e[5];const{data:c,isFetching:m}=le(d);if(h(c)||h(c.categories))return null;let g;e[6]!==c.data?(g=c.data.filter(fe).map(Ce),e[6]=c.data,e[7]=g):g=e[7];const r=g;let o;e[8]!==t||e[9]!==c.categories||e[10]!==a?(o=b.jsx(ue,{categories:c.categories,onSelectionChange:y,pageName:t,selectedCategory:a,stateKey:de}),e[8]=t,e[9]=c.categories,e[10]=a,e[11]=o):o=e[11];let u;e[12]!==t||e[13]!==i?(u=C=>{const{index:P,podcast:S}=C;return b.jsx(ge,{index:P,pageName:t,podcast:S,sectionPosition:i},S.id)},e[12]=t,e[13]=i,e[14]=u):u=e[14];let f;return e[15]!==m||e[16]!==r||e[17]!==o||e[18]!==u?(f=b.jsx(W,{isLoading:m,items:r,kind:"ranker",title:o,children:u}),e[15]=m,e[16]=r,e[17]=o,e[18]=u,e[19]=f):f=e[19],f};function fe(n){return I(n)}function Ce(n,e){return{podcast:n,id:n.id,index:e}}export{$e as T};
//# sourceMappingURL=top-podcasts-carousel-Bsa7fmX-.js.map
