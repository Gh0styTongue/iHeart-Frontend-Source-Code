import{c as w,b as U,j,L as x}from"./create-logger-DNtzi1_a.js";import{e as E,a as G}from"./create-analytics-DYSkN0SF.js";import{z as h,a as O,B as L,D as B,p as C,f as R,b as z,S as N,w as q}from"./use-item-selected-BbUZv3TT.js";import{r as u,d as F,e as K}from"./chunk-QMGIS6GS-CFDD2jAw.js";import{n as b}from"./chunk-VCYTMP4D-Dtug6Gx1.js";import{k as V,u as H}from"./amp-client-C2ZZL0mA.js";import{u as J}from"./is-mobile-BqLxbqHZ.js";import{u as Q,m as W}from"./request-info-Bv3SWXDS.js";import{l as X,b as Y}from"./http-error-DJhpcL-Y.js";const Z=({logger:t})=>{let e=!1;return w({async initialize(i){const a=i?.pubId;if(i?.enabledBidders.includes("amazon")??!1){t.info("Initializing Amazon Header Bidder");try{await h(()=>!!globalThis.window.apstagLOADED),e=!0}catch{return}}else t.info("Amazon Header Bidder not enabled");e&&a&&!b(a)&&(t.info("Calling apstag.init"),globalThis.window.apstag?.init({pubID:a,adServer:"googletag"}))},async fetchBids(i=[]){if(e){t.info("Fetching Amazon Header bids");const a=[];for(const n of i){const l=n.getSizes().reduce((m,d)=>(m.push([d.width,d.height]),m),[]);a.push({slotID:n.getSlotElementId(),slotName:n.getAdUnitPath(),sizes:l})}return a.length===0?(t.warn("No valid slots passed to Amazon fetchBids"),!1):new Promise(n=>{globalThis.window.apstag?.fetchBids({slots:a,timeout:5e3},()=>{globalThis.window.apstag?.setDisplayBids(),t.info("Amazon Header bids set"),n(!0)})})}else return t.warn("Amazon Header Bidder not ready!"),!1}})},ee=({logger:t})=>{let e=!1;return w({async initialize(i){if(i.enabledBidders.includes("liveRamp")){t.info("Initializing LiveRamp Header Bidder");try{await h(()=>!!globalThis.window.ats),e=!0,t.info("LiveRamp Header Bidder initialized")}catch(n){t.warn("Unable to initialize LiveRamp Header Bidder",{error:n})}}if(e&&!b(i.email)&&i.emailHashes&&!b(i.emailHashes)){const{email:n,emailHashes:l}=i;t.info("LiveRamp ats.start()"),window.ats?.start({placementID:2102,storageType:"localStorage",logging:"error",email:n,emailHashes:l})}}})},te=({logger:t})=>{let e=!1;return w({async initialize(i){if(i.enabledBidders.includes("rubicon")){t.info("Initializing Rubicon Header Bidder");try{await h(()=>!!globalThis.window.pbjs),e=!0,t.info("Rubicon Header Bidder initialized")}catch(n){t.warn("Unable to initialize Rubicon Header Bidder",{error:n})}}},async fetchBids(i=[]){return b(i)||!e?(t.warn("Unable to fetch Rubicon bids!"),!1):(t.info("Fetching Rubicon header bids"),new Promise(a=>{globalThis.window.pbjs?.que.push(()=>{globalThis.window.pbjs?.rp.requestBids({callback:()=>{t.info("Rubicon header bids fetched"),a(!0)},gptSlotObjects:i})})}))}})},ie=({logger:t})=>{let e=!1;const i=[Z({logger:t}),ee({logger:t}),te({logger:t})];return w({async initialize(a){t.info("Initializing Header Bidding"),a.privacyOptOut&&(e=!0),e?t.info("Privacy opt out enabled, skipping header bidding"):(await Promise.allSettled(i.map(n=>n.initialize(a))),t.info("Header Bidding initialized"))},async fetchBids(a){e?t.info("Privacy opt out enabled, skipping header bids fetching"):(t.info("Header Bidding - fetching bids..."),await Promise.allSettled(i.map(n=>n.fetchBids?.(a))),t.info("Header Bidding - bids fetched"))}})},ae=({logger:t})=>w({async initialize(){return globalThis.window?(await h(()=>globalThis.window?.googletag?.defineSlot!==void 0),t.info("GPT Initialized"),!0):!1},async defineSlot(e,i,a){t.info(`Registering new slot for container: ${a}`);const n=globalThis.window?.googletag?.defineSlot?.(e,i,a);if(n&&!b(n)){t.info(`Slot "${n.getSlotId()}" registered for container: ${a}`,{slot:n});const l=globalThis.window?.googletag?.pubads;typeof l=="function"?n.addService(l()):t.warn("pubads is not a function and cannot be called.")}else t.warn(`Unable to register slot for container: ${a}`);return n},async destroySlots(e){const i=e?.map(a=>a.getSlotElementId())??[];if(i.length>0){t.info(`Destroying slots: ${i.join(", ")}`);for(const a of i){const n=globalThis.window.document.querySelector(`#${a}`);n&&n.dataset&&(n.dataset.show="false")}return globalThis.window?.googletag?.destroySlots(e)}else return t.warn("destroySlots called but no registered slots matched!"),!1},async enableServices(){return globalThis.window?.googletag?.enableServices()},async openConsole(){return globalThis.window?.googletag?.openConsole()},async addEventListener(e,i){return t.info(`Registering event listener for event: ${e}`),globalThis.window?.googletag?.pubads?.().addEventListener(e,i)},async getSlotIdMap(){return globalThis.window?.googletag?.pubads?.().getSlotIdMap()},async getSlots(){return globalThis.window?.googletag?.pubads?.().getSlots()},async removeEventListener(e,i){return t.info(`Removing event listener for event: ${e}`),globalThis.window?.googletag?.pubads?.().removeEventListener(e,i)},async clear(e){return globalThis.window?.googletag?.pubads?.().clear(e)},async clearCategoryExclusions(){return globalThis.window?.googletag?.pubads?.().clearCategoryExclusions()},async clearTargeting(e){return globalThis.window?.googletag?.pubads?.().clearTargeting(e)},async collapseEmptyDivs(e){return globalThis.window?.googletag?.pubads?.().collapseEmptyDivs(e)},async disableInitialLoad(){return globalThis.window?.googletag?.pubads?.().disableInitialLoad()},async enableLazyLoad(e){return globalThis.window?.googletag?.pubads?.().enableLazyLoad(e)},async enableSingleRequest(){return globalThis.window?.googletag?.pubads?.().enableSingleRequest()},async enableVideoAds(){return globalThis.window?.googletag?.pubads?.().enableVideoAds()},async get(e){return globalThis.window?.googletag?.pubads?.().get(e)},async getAttributeKeys(){return globalThis.window?.googletag?.pubads?.().getAttributeKeys()},async getCorrelator(){return globalThis.window?.googletag?.pubads?.().getCorrelator()},async getImaContent(){return globalThis.window?.googletag?.pubads?.().getImaContent()},async getTagSessionCorrelator(){return globalThis.window?.googletag?.pubads?.().getTagSessionCorrelator()},async getVideoContent(){return globalThis.window?.googletag?.pubads?.().getVideoContent()},async getTargeting(e){return globalThis.window?.googletag?.pubads?.().getTargeting(e)},async getTargetingKeys(){return globalThis.window?.googletag?.pubads?.().getTargetingKeys()},async isInitialLoadDisabled(){return globalThis.window?.googletag?.pubads?.().isInitialLoadDisabled()},async isSRA(){return globalThis.window?.googletag?.pubads?.().isSRA()},pubadsReady(){return!!globalThis.window?.googletag?.pubadsReady},async refresh(e,i){return globalThis.window?.googletag?.pubads?.().refresh(e,i)},async set(e,i){return globalThis.window?.googletag?.pubads?.().set(e,i)},async setCategoryExclusion(e){return globalThis.window?.googletag?.pubads?.().setCategoryExclusion(e)},async setCentering(e){return globalThis.window?.googletag?.pubads?.().setCentering(e)},async setForceSafeFrame(e){return globalThis.window?.googletag?.pubads?.().setForceSafeFrame(e)},async setImaContent(e,i){return globalThis.window?.googletag?.pubads?.().setImaContent(e,i)},async setLocation(e){return globalThis.window?.googletag?.pubads?.().setLocation(e)},async setPrivacySettings(e){return globalThis.window?.googletag?.pubads?.().setPrivacySettings(e)},async setPublisherProvidedId(e){return globalThis.window?.googletag?.pubads?.().setPublisherProvidedId(e)},async setSafeFrameConfig(e){return globalThis.window?.googletag?.pubads?.().setSafeFrameConfig(e)},async setTargeting(e,i){return globalThis.window?.googletag?.pubads?.().setTargeting(e,i)},async setVideoContent(e,i){return globalThis.window?.googletag?.pubads?.().setVideoContent(e,i)}});class ne{#e;#t;#i;#a;constructor(e){this.#e=new Set,this.#t=new Set,this.#a=!1,e&&(this.#i=e)}registerSlot(){const e=Symbol();return this.#e.add(e),this.#i?.info(`Registering slot in SlotRegistry, # of registered slots: ${this.#e.size}`),e}addSlot(e){this.#t.add(e),this.#i?.info(`Adding slot "${e}" to SlotRegistry, # of added slots: ${this.#t.size}`)}unregisterSlot(e){this.#e.delete(e),this.#i?.info(`Unregistering slot from SlotRegistry, # of registered slots: ${this.#e.size}`)}removeSlot(e){this.#t.delete(e),this.#i?.info(`Removing slot "${e}" from SlotRegistry, # of added slots: ${this.#t.size}`)}get registeredSize(){return this.#i?.info(`SlotRegistry registeredSize: ${this.#e.size}`),this.#e.size}get addedSize(){return this.#i?.info(`SlotRegistry addedSize: ${this.#t.size}`),this.#t.size}get isTakeover(){return this.#a}set isTakeover(e){this.#a=e}}const D=u.createContext({enabled:!1}),se=({logger:t})=>async e=>{const i=e.slot.getSlotElementId(),n=globalThis.document.querySelector(`#${i}`)?.querySelector("iframe");if(n)try{await h(()=>n?.dataset.loadComplete==="true"||n?.dataset.isSafeframe==="true",5e3),t.info(`Slot Render Ended: ${i}`,e)}catch{return t.warn(`Slot Render Ended Timeout: ${i}`,e)}},{call:oe}=O(async(t,e)=>{const{slot:i,serviceName:a}=e,n=i.getSizes()?.[0];return t({type:E.enum.DisplayAdImpression,data:{ad:{advertiserId:i?.getResponseInformation()?.advertiserId??0,targeting:i?.getTargetingMap(),campaignId:i?.getResponseInformation()?.campaignId??0,clickthroughUrl:i?.getClickUrl(),client:"googima",creativeId:i?.getResponseInformation()?.creativeId??0,lineItemId:i?.getResponseInformation()?.lineItemId??0,position:i?.getSlotElementId(),serviceName:a,size:{width:typeof n=="object"&&"width"in n?n.width:0,height:typeof n=="object"&&"height"in n?n.height:0},tag:i?.getContentUrl()?.toString(),viewable:globalThis.window?.document?.visibilityState==="visible"?1:0}}})},{timing:"trailing",waitMs:1e3}),re=({analytics:t,logger:e=U({enabled:!1,level:x.Info,namespace:"web.ads",pretty:!0})})=>{const i=new ne(e);if(L(globalThis.window?.location)){const o=new URL(globalThis.window.location.href).searchParams.get("debug");(o==="true"||o==="ads")&&e.enable()}const a=ae({logger:e}),n=ie({logger:e}),l=se({logger:e}),m=(s,o)=>{e.error("GoogleAds error",{error:s}),t.track({type:E.enum.DisplayAdError,data:{ad:{error:s.message,...o}}})},d=s=>{const o=s.slot.getSlotElementId();e.info(`Slot Onload: "${o}"`),oe(t.track,s),c.slotOnLoad(o)},f=new Map;let p={};const c=w({async initialize(s){await a.initialize(),await n.initialize(s),e.info("Google Ads Initialized")},async ready(){return a.pubadsReady()},async addSlot(s,o,r,g){if(globalThis.document.querySelector(`#${r}`)){const y=await a.defineSlot(s,o,r);if(y){if(e.info("Slot Added",y),g&&!b(g)){for(const[T,I]of Object.entries(g))y.setTargeting(T,I);e.info(`Targeting added for slot: "${y.getSlotId()}"`,{slotTargeting:g}),e.info(`Slot displayed for slot: "${y.getSlotId()}"`,{}),i.addSlot(r),i.addedSize===i.registeredSize&&c.refresh()}}else m(new Error("Slot not added"),{position:r})}else e.warn(`Unable to find div element with id: ${r}`)},async removeSlot(s){const o=(await a.getSlots())?.find(r=>r.getSlotElementId()===s);if(o){const r=await a.destroySlots([o]);return i.removeSlot(s),r?e.info("Slot removed",{slot:o}):e.warn(`Unable to remove slot for div "${s}"`),s}},async receiveTargeting(s){if(V(s,p))e.info("Targeting not changed, skipping.");else{e.info("Setting targeting",{targeting:s}),p=s,f.clear();for(const[o,r]of Object.entries(s))o==="childDirected"?(e.info(`Setting privacy settings, childDirectedTreatment: ${String(r)}`),typeof r=="boolean"&&await a.setPrivacySettings({childDirectedTreatment:r})):f.set(o,String(r))}},async refresh(){const s=await a.getSlots();if(s.length>0)if(s.map(r=>r.getSlotElementId()).length>0){f.set("ts",String(Date.now())),f.set("ord",String(Math.floor(Math.random()*Date.now()))),e.info("Setting GPT Targeting"),await a.clearTargeting();for(const[r,g]of f.entries())await a.setTargeting(r,g);await n.fetchBids(s),e.info("Refreshing slots"),await a.refresh(s)}else e.warn("No slots to refresh");else e.warn("No slots to refresh")},slotOnLoad:async s=>s,async start(){globalThis.window&&(e.info("GoogleAds.start()"),await a.enableLazyLoad({fetchMarginPercent:0,renderMarginPercent:0,mobileScaling:1}),await a.disableInitialLoad(),await a.enableSingleRequest(),await a.setPrivacySettings({restrictDataProcessing:!0}),await a.addEventListener("slotRenderEnded",l),await a.addEventListener("slotOnload",d),await a.enableServices(),await h(()=>a.pubadsReady()))},async stop(){e.info("GoogleAds.stop()"),a.removeEventListener("slotRenderEnded",l),a.removeEventListener("slotOnload",d)},async visibilityChange(){const s=globalThis.window?.document?.visibilityState;e.info(`Document visibility changed to ${s}`),s==="visible"&&(i.isTakeover?e.info("Document visible - takeover is active, skipping refresh"):(e.info("Document visible, refreshing ads..."),c.refresh()))},async click(s){const o=(await a.getSlots())?.find(v=>v.getSlotElementId()===s.target.id);if(!o)return;const r=o.getServices().at(0)?.getName(),g=o.getSizes().at(0);t.track({type:E.enum.DisplayAdClick,data:{ad:{advertiserId:o.getResponseInformation()?.advertiserId??0,targeting:o.getTargetingMap(),campaignId:o.getResponseInformation()?.campaignId??0,clickthroughUrl:o.getClickUrl(),client:"googima",creativeId:o?.getResponseInformation()?.creativeId??0,lineItemId:o?.getResponseInformation()?.lineItemId??0,position:o?.getSlotElementId(),serviceName:r??"",size:{width:typeof g=="object"&&"width"in g?g.width:0,height:typeof g=="object"&&"height"in g?g.height:0},tag:o?.getContentUrl()?.toString(),viewable:globalThis.window?.document?.visibilityState==="visible"?1:0}}})}});return{GoogleAds:c,slotOnloadEventHandler:d,GoogleAdsProvider:({children:s,headerBiddingConfig:o,enabled:r=!0})=>(u.useMemo(()=>{L(globalThis.window)&&!c.initialized&&r?(e.info("Ads enabled, initializing GoogleAds"),c.initialize(o)):r||e.info("Ads not enabled, skipping GoogleAds.initialize")},[o,r]),u.useEffect(()=>{if(r&&!a.pubadsReady())return e.info("Ads enabled, starting GoogleAds"),globalThis.window.addEventListener("visibilitychange",c.visibilityChange),c.start(),()=>{c.stop(),globalThis.window.removeEventListener("visibilitychange",c.visibilityChange)};e.info("Ads not enabled, skipping GoogleAds.start")},[r]),j.jsx(D.Provider,{value:u.useMemo(()=>({enabled:r}),[r]),children:s})),setIsTakeover:s=>{i.isTakeover=s},useDisplayAdsContext:()=>u.useContext(D),useSlotRegistry:()=>{u.useEffect(()=>{const s=i.registerSlot();return()=>{i.unregisterSlot(s)}},[])}}},{GoogleAdsProvider:Ae,GoogleAds:S,setIsTakeover:Ee,useDisplayAdsContext:Le,useSlotRegistry:Ce}=re({analytics:G});function ke(t,e){const{type:i,payload:a}=e;switch(i){case"display_ad":return t.display==="ad"?t:{...t,display:"ad"};case"display_companion":return t.display==="companion"?t:{...t,display:"companion"};case"display_none":return t.display==="none"?t:{...t,display:"none"};case"set_companion":{const{shouldDisplay:n}=t;return{...t,display:a===null?n?"ad":"none":"companion",companionAd:a}}case"set_slot":{const{slot:n}=t;return{...t,slot:a,previousSlotId:n?.slotId}}}}function Pe({display:t,displayAdsEnabled:e}){return{display:t&&e?"ad":"none",companionAd:null,slot:void 0,shouldDisplay:t&&e}}const De=async({adUnitPath:t,targeting:e,ccrpos:i,size:a,slotId:n,prevSlotId:l})=>{l&&await S.removeSlot(l),await S.receiveTargeting(e),await S.addSlot(t,a,n,{ccrpos:i})},Be=async t=>{await S.removeSlot(t)};function He(t=4){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let i="";const a=new Uint8Array(t);crypto.getRandomValues(a);for(const n of a)i+=e[n%e.length];return i}const $e=t=>{S.click(t.nativeEvent)},le=["deviceType","locale","profileId","visitNum","ccrmarket"],de=["aw_0_1st.playlistid","aw_0_1st.ihmgenre","aw_0_1st.playlisttype","ccrcontent2","pageformat","pagemarket","ccrcontent3","ccrformat","section"],ce=["playedFrom","provider","seed"],ge=["ccrcontent1","env","ord","ts","CCRPOS"],ue=["amznbid","m_mv","m_gv","m_data","m_safety"],fe=[...le,...de,...ce,...ge,...ue],pe=B(t=>{const e=new Map;for(const i of t)if(i.data)for(const[a,n]of Object.entries(i.data))fe.includes(a)&&e.set(a,n);return Object.fromEntries(e.entries())}),Me=()=>{const t=u.useRef(H()),e=pe(F()),i=C.useState(),{locale:a}=Q(),n=J(),[l,m]=K(),d=i.queue?.[0],{playlistid:f,ihmgenre:p,playlisttype:c,seed:s}=u.useMemo(()=>({playlistid:e["aw_0_1st.playlistid"],ihmgenre:e["aw_0_1st.ihmgenre"],playlisttype:e["aw_0_1st.playlisttype"],seed:e.seed}),[e]);return u.useMemo(()=>{const o=i.station?.context.playedFrom??0,r=i.station?.type?.toLowerCase(),g=d?.meta?.format,v=d?.meta?.market,y=n?"mobile":"desktop",T=t.current?.profileId,I=((d?.meta?.childOriented||!!d?.meta?.ageLimit)&&t.current?.isAnonymous)??!1,$=s??i.station?.seed,M={childDirected:I,deviceType:y,locale:a,profileId:T,visitNum:e.visitNum,"aw_0_1st.playlistid":f,"aw_0_1st.ihmgenre":p,"aw_0_1st.playlisttype":c,ccrcontent2:r,pageformat:e.pageformat,pagemarket:e.pagemarket,ccrcontent3:e.ccrcontent3,ccrformat:g,ccrmarket:v,section:e.section,playedFrom:o,provider:"cc",seed:$,ccrcontent1:e.ccrcontent1,env:l.get("env")??"listen"};return Object.fromEntries(Object.entries(M).reduce((k,[_,P])=>(L(P)&&k.push([_,P]),k),[]))},[p,f,c,n,d?.meta?.format,d?.meta?.market,d?.meta?.childOriented,d?.meta?.ageLimit,i.station?.context,i.station?.type,i.station?.seed,s,e.ccrcontent1,e.ccrcontent3,e.section,e.pageformat,e.pagemarket,e.visitNum,a,l])},me={Hero:"2013",LeftNav:"2000",Inline:"2014"},ye=B(t=>{if(!t)return"";const e=t.find(i=>i.isPrimary);return e?.name==="DIGITAL-NAT"?"DIGITALCHANNELS":e?.name??""});function A(t){return t===me.Inline?"n":void 0}const _e=({ccrpos:t})=>{const e=u.useRef(W()),i=C.useState(),a=C.useAds(),n=u.useRef(e.current.ads.dfpInstanceId),l=u.useMemo(()=>`/${[n.current,"ccr.ihr",["ihr4",A(t)].filter(Boolean).join(".")].filter(Boolean).join("/")}`,[t]);return u.useMemo(()=>{const m=i.queue,d=i.index,f=i.station?.type,p=m?.[d]?.meta,c=ye(p?.markets),s=p?.callLetters,o=p?.provider;return[R.Paused,R.Playing].includes(a.status)||i.status===z.Idle&&a.status===R.Buffering?null:[z.Playing,z.Buffering].includes(i.status)?f?.toLowerCase()!==N.Live?`/${[n.current,["ccr.ihr",A(t)].filter(Boolean).join("."),"customtalk"].filter(Boolean).join("/")}`:q({provider:o,callLetters:s,market:c,dfpInstanceId:n.current,postfix:A(t)})??l:l},[i.queue,i.index,i.station?.type,i.status,a.status,l,t])},Ue=t=>{const e=H();return{display:u.useMemo(()=>!(!Y(e)&&(e.subscription?.type==="PREMIUM"||e.subscription?.type==="PLUS"))&&X(t)&&t,[e,t])}};export{me as C,S as G,$e as a,Le as b,Ce as c,_e as d,ke as e,Pe as f,Me as g,He as h,De as i,Ae as j,Be as r,Ee as s,Ue as u};
//# sourceMappingURL=use-display-ad-BA-nEzAS.js.map
